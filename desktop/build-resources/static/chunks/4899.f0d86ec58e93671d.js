"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4899],{6889:(e,a,s)=>{s.d(a,{A:()=>t});let t=(0,s(7401).A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},4857:(e,a,s)=>{s.d(a,{A:()=>t});let t=(0,s(7401).A)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])},4505:(e,a,s)=>{s.d(a,{A:()=>t});let t=(0,s(7401).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},1773:(e,a,s)=>{s.d(a,{A:()=>t});let t=(0,s(7401).A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},1556:(e,a,s)=>{s.d(a,{A:()=>t});let t=(0,s(7401).A)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]])},5686:(e,a,s)=>{s.d(a,{A:()=>t});let t=(0,s(7401).A)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},4899:(e,a,s)=>{s.r(a),s.d(a,{default:()=>k});var t,r=s(5155),l=s(2115),n=s(814),i=s(4505),c=s(7581),d=s(6889),o=s(1594),m=s(6336),h=s(1556),u=s(2970),x=s(1773),p=s(7401);let y=(0,p.A)("cloud-off",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.782 5.782A7 7 0 0 0 9 19h8.5a4.5 4.5 0 0 0 1.307-.193",key:"yfwify"}],["path",{d:"M21.532 16.5A4.5 4.5 0 0 0 17.5 10h-1.79A7.008 7.008 0 0 0 10 5.07",key:"jlfiyv"}]]),b=(0,p.A)("file-archive",[["path",{d:"M13.659 22H18a2 2 0 0 0 2-2V8a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 14 2H6a2 2 0 0 0-2 2v11.5",key:"4pqfef"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 12v-1",key:"1ej8lb"}],["path",{d:"M8 18v-2",key:"qcmpov"}],["path",{d:"M8 7V6",key:"1nbb54"}],["circle",{cx:"8",cy:"20",r:"2",key:"ckkr5m"}]]);var g=s(4857),j=s(5686);let f=null===(t=window.desktop)||void 0===t?void 0:t.isDesktop;function k(){let[e,a]=(0,l.useState)(!0),[s,t]=(0,l.useState)([]),[p,k]=(0,l.useState)(null),[N,v]=(0,l.useState)(!1),[w,A]=(0,l.useState)(""),[E,S]=(0,l.useState)([]),[M,L]=(0,l.useState)(null),[R,z]=(0,l.useState)(null),C=(0,l.useCallback)(async e=>{try{var s;a(!0);let r=new URLSearchParams;e&&r.set("storeId",e),r.set("limit","50");let l=await fetch("/api/cloud-backups?".concat(r.toString()));if(!l.ok)throw Error("Error al cargar backups");let n=await l.json();t(n.backups||[]);let i=new Map;null===(s=n.backups)||void 0===s||s.forEach(e=>{i.set(e.storeId,e.storeName)}),S(Array.from(i.entries()).map(e=>{let[a,s]=e;return{id:a,name:s}}))}catch(e){console.error("Error loading cloud backups:",e),n.oR.error("Error al cargar backups de la nube")}finally{a(!1)}},[]),D=(0,l.useCallback)(async()=>{if(f)try{let e=await window.desktop.cloudSync.getStats();k(e)}catch(e){console.error("Error loading sync stats:",e)}},[]);(0,l.useEffect)(()=>{C(),D();let e=setInterval(()=>{D()},3e4);return()=>clearInterval(e)},[C,D]);let I=async()=>{if(!f){n.oR.error("Solo disponible en la versi\xf3n Desktop");return}v(!0);try{let e=await window.desktop.cloudSync.syncNow();e.success?e.synced>0?n.oR.success("Sincronizados ".concat(e.synced," backups")):e.failed>0?n.oR.warning("".concat(e.failed," backups fallidos. Ver detalles en estado local.")):n.oR.info("Todos los backups ya est\xe1n sincronizados"):n.oR.error(e.errors.join(", ")||"Error en sincronizaci\xf3n"),await C(w),await D()}catch(e){n.oR.error(e.message||"Error al sincronizar")}finally{v(!1)}},F=async()=>{if(f)try{let e=await window.desktop.cloudSync.resetFailed();e>0?(n.oR.success("".concat(e," archivos listos para reintentar")),await D()):n.oR.info("No hay archivos fallidos")}catch(e){n.oR.error(e.message||"Error")}},T=async e=>{L(e.id);try{let a=await fetch("/api/cloud-backups/request-download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({backupId:e.id})});if(!a.ok)throw Error("Error al obtener URL de descarga");let s=await a.json(),t=document.createElement("a");t.href=s.downloadUrl,t.download="backup_".concat(e.storeName,"_").concat(e.exportedAt.split("T")[0],".zip"),document.body.appendChild(t),t.click(),document.body.removeChild(t),n.oR.success("Descarga iniciada")}catch(e){n.oR.error(e.message||"Error al descargar")}finally{L(null)}},V=async e=>{if(confirm('\xbfEliminar backup de "'.concat(e.storeName,'" del ').concat(new Date(e.exportedAt).toLocaleDateString(),"?"))){z(e.id);try{if(!(await fetch("/api/cloud-backups/".concat(e.id),{method:"DELETE"})).ok)throw Error("Error al eliminar");n.oR.success("Backup eliminado"),await C(w)}catch(e){n.oR.error(e.message||"Error al eliminar")}finally{z(null)}}},B=e=>new Date(e).toLocaleString("es-PE",{dateStyle:"short",timeStyle:"short"}),H=e=>{switch(e){case"AVAILABLE":return(0,r.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"Disponible"});case"UPLOADING":return(0,r.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:"Subiendo..."});case"FAILED":return(0,r.jsx)("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:"Error"});case"DELETED":return(0,r.jsx)("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded-full",children:"Eliminado"});default:return(0,r.jsx)("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full",children:e})}};return e?(0,r.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,r.jsx)(i.A,{className:"w-6 h-6 animate-spin text-blue-600 mr-2"}),(0,r.jsx)("span",{className:"text-gray-600",children:"Cargando backups de la nube..."})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[f&&p&&(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(c.A,{className:"w-5 h-5 text-blue-600"}),(0,r.jsx)("span",{className:"font-medium",children:"Estado Local"})]}),(0,r.jsxs)("div",{className:"flex gap-3 text-sm",children:[(0,r.jsxs)("span",{className:"text-orange-600",children:[(0,r.jsx)(d.A,{className:"w-4 h-4 inline mr-1"}),"Pendientes: ",p.pending]}),(0,r.jsxs)("span",{className:"text-red-600",children:[(0,r.jsx)(o.A,{className:"w-4 h-4 inline mr-1"}),"Fallidos: ",p.failed]}),(0,r.jsxs)("span",{className:"text-green-600",children:[(0,r.jsx)(m.A,{className:"w-4 h-4 inline mr-1"}),"Sincronizados: ",p.done]})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[p.failed>0&&(0,r.jsxs)("button",{onClick:F,className:"px-3 py-1.5 bg-orange-100 text-orange-700 rounded-lg text-sm font-medium hover:bg-orange-200 transition-colors flex items-center gap-1",children:[(0,r.jsx)(h.A,{className:"w-4 h-4"}),"Reintentar Fallidos"]}),(0,r.jsx)("button",{onClick:I,disabled:N,className:"px-4 py-1.5 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors flex items-center gap-1 disabled:opacity-50",children:N?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.A,{className:"w-4 h-4 animate-spin"}),"Sincronizando..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.A,{className:"w-4 h-4"}),"Sincronizar Ahora"]})})]})]})}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-800",children:"Backups en la Nube"}),E.length>0&&(0,r.jsxs)("select",{value:w,onChange:e=>{A(e.target.value),C(e.target.value)},className:"border border-gray-300 rounded-lg px-3 py-1.5 text-sm",children:[(0,r.jsx)("option",{value:"",children:"Todas las tiendas"}),E.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsx)("button",{onClick:()=>C(w),className:"text-gray-600 hover:text-gray-800 transition-colors",title:"Actualizar lista",children:(0,r.jsx)(x.A,{className:"w-5 h-5"})})]}),0===s.length?(0,r.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-lg border border-dashed border-gray-300",children:[(0,r.jsx)(y,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),(0,r.jsx)("p",{className:"text-gray-600 font-medium",children:"No hay backups en la nube"}),(0,r.jsx)("p",{className:"text-gray-500 text-sm mt-1",children:f?"Los backups locales se sincronizar\xe1n autom\xe1ticamente cuando haya internet.":"Los backups se sincronizan desde la versi\xf3n Desktop."})]}):(0,r.jsx)("div",{className:"space-y-3",children:s.map(e=>(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-sm transition-shadow",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(b,{className:"w-10 h-10 text-purple-500"}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"font-medium text-gray-800",children:e.storeName}),H(e.status)]}),(0,r.jsxs)("div",{className:"text-sm text-gray-500 mt-1 flex items-center gap-3",children:[(0,r.jsxs)("span",{children:[(0,r.jsx)(d.A,{className:"w-3 h-3 inline mr-1"}),B(e.exportedAt)]}),(0,r.jsxs)("span",{children:[e.sizeMb.toFixed(2)," MB"]}),(0,r.jsxs)("span",{className:"font-mono text-xs text-gray-400",children:[e.sha256.substring(0,8),"..."]})]})]})]}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:"AVAILABLE"===e.status&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>T(e),disabled:M===e.id,className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors disabled:opacity-50",title:"Descargar",children:M===e.id?(0,r.jsx)(i.A,{className:"w-5 h-5 animate-spin"}):(0,r.jsx)(g.A,{className:"w-5 h-5"})}),(0,r.jsx)("button",{onClick:()=>V(e),disabled:R===e.id,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50",title:"Eliminar",children:R===e.id?(0,r.jsx)(i.A,{className:"w-5 h-5 animate-spin"}):(0,r.jsx)(j.A,{className:"w-5 h-5"})})]})})]})},e.id))}),(0,r.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-6",children:(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)(o.A,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),(0,r.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,r.jsx)("p",{className:"font-medium mb-1",children:"Acerca de Cloud Backups"}),(0,r.jsxs)("ul",{className:"list-disc list-inside space-y-1",children:[(0,r.jsx)("li",{children:"Los backups locales se sincronizan autom\xe1ticamente cuando hay internet"}),(0,r.jsx)("li",{children:"Se detectan duplicados por SHA-256 para evitar subir el mismo archivo"}),(0,r.jsxs)("li",{children:["Los backups se eliminan autom\xe1ticamente despu\xe9s de ",30," d\xedas (configurable)"]}),(0,r.jsx)("li",{children:'Para restaurar, descarga el backup y usa la opci\xf3n "Restaurar a Nueva Tienda"'})]})]})]})})]})}}}]);