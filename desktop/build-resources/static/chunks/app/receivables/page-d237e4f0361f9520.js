(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2],{6841:(e,t,a)=>{Promise.resolve().then(a.bind(a,6481))},4857:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7401).A)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])},6481:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var s=a(5155),r=a(2115),l=a(814),n=a(4857),c=a(9445);function d(){let[e,t]=(0,r.useState)([]),[a,d]=(0,r.useState)(!0),[i,o]=(0,r.useState)("OPEN"),[x,m]=(0,r.useState)(!1),[h,p]=(0,r.useState)(null),[g,u]=(0,r.useState)(""),[b,y]=(0,r.useState)("CASH"),[j,N]=(0,r.useState)(""),[v,f]=(0,r.useState)(!1),[w,C]=(0,r.useState)(!1);(0,r.useEffect)(()=>{S()},[i]);let S=async()=>{try{d(!0);let e=await fetch("/api/receivables?status=".concat(i));if(!e.ok)throw Error("Error al cargar");let a=await e.json();t(a.receivables)}catch(e){console.error("Error loading receivables:",e),l.oR.error("Error al cargar cuentas por cobrar")}finally{d(!1)}},k=e=>{p(e),u(e.balance.toString()),y("CASH"),N(""),m(!0)},E=async()=>{if(!h)return;let e=parseFloat(g);if(isNaN(e)||e<=0){l.oR.error("Ingresa un monto v\xe1lido");return}if(e>h.balance){l.oR.error("El monto excede el saldo pendiente");return}try{f(!0);let t=await fetch("/api/receivables/".concat(h.id,"/pay"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e,method:b,notes:j||null})});if(!t.ok){let e=await t.json();throw Error(e.message)}let a=(await t.json()).receivable.balance;0===a?l.oR.success("\xa1Cuenta pagada completamente!"):l.oR.success("Pago registrado. Saldo restante: S/ ".concat(a.toFixed(2))),m(!1),S()}catch(e){console.error("Error processing payment:",e),l.oR.error(e.message||"Error al procesar pago")}finally{f(!1)}};return a&&0===e.length?(0,s.jsx)(c.A,{storeName:"Cuentas por Cobrar",children:(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"text-gray-500",children:"Cargando..."})})}):(0,s.jsx)(c.A,{storeName:"Cuentas por Cobrar",children:(0,s.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,s.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Cuentas por Cobrar"}),(0,s.jsx)("p",{className:"text-gray-600 text-sm mt-1",children:"Gesti\xf3n de ventas FIADO y pagos"})]}),(0,s.jsxs)("button",{onClick:()=>{window.open("/api/reports/export/receivables?status=".concat(i),"_blank")},className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[(0,s.jsx)(n.A,{className:"w-4 h-4"}),"Exportar CSV"]})]}),(0,s.jsx)("div",{className:"flex gap-2 mb-6 border-b",children:[{value:"OPEN",label:"Abiertas",color:"orange"},{value:"PAID",label:"Pagadas",color:"green"},{value:"CANCELLED",label:"Canceladas",color:"gray"}].map(e=>(0,s.jsx)("button",{onClick:()=>o(e.value),className:"px-4 py-2 font-medium border-b-2 transition-colors ".concat(i===e.value?"border-".concat(e.color,"-600 text-").concat(e.color,"-600"):"border-transparent text-gray-500 hover:text-gray-700"),children:e.label},e.value))}),"OPEN"===i&&(0,s.jsx)("div",{className:"mb-6 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-orange-700",children:"Total Pendiente de Cobro"}),(0,s.jsxs)("div",{className:"text-2xl font-bold text-orange-900",children:["S/ ",e.reduce((e,t)=>e+t.balance,0).toFixed(2)]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("div",{className:"text-sm text-orange-700",children:"Cuentas Abiertas"}),(0,s.jsx)("div",{className:"text-2xl font-bold text-orange-900",children:e.length})]})]})}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cliente"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Ticket"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fecha"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Monto Original"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Saldo"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Estado"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),(0,s.jsxs)("tbody",{className:"divide-y divide-gray-200",children:[e.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:e.customer.name}),e.customer.phone&&(0,s.jsx)("div",{className:"text-sm text-gray-500",children:e.customer.phone})]}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["#",e.sale.saleNumber]}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.sale.createdAt).toLocaleDateString("es-PE")}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["S/ ",e.originalAmount.toFixed(2)]}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.balance>0?(0,s.jsxs)("span",{className:"font-medium text-red-600",children:["S/ ",e.balance.toFixed(2)]}):(0,s.jsx)("span",{className:"text-gray-400",children:"S/ 0.00"})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("OPEN"===e.status?"bg-orange-100 text-orange-800":"PAID"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:"OPEN"===e.status?"Abierta":"PAID"===e.status?"Pagada":"Cancelada"})}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:["OPEN"===e.status&&(0,s.jsx)("button",{onClick:()=>k(e),className:"text-blue-600 hover:text-blue-800 mr-3 font-medium",children:"Cobrar"}),e.payments.length>0&&(0,s.jsx)("button",{onClick:()=>{p(e),C(!0)},className:"text-gray-600 hover:text-gray-800",children:"Ver Pagos"})]})]},e.id)),0===e.length&&(0,s.jsx)("tr",{children:(0,s.jsxs)("td",{colSpan:7,className:"px-6 py-8 text-center text-gray-500",children:["No hay cuentas ","OPEN"===i?"abiertas":"PAID"===i?"pagadas":"canceladas"]})})]})]})}),x&&h&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-md p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Registrar Pago"}),(0,s.jsxs)("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"Cliente"}),(0,s.jsx)("div",{className:"font-medium",children:h.customer.name}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 mt-2",children:["Ticket #",h.sale.saleNumber]}),(0,s.jsxs)("div",{className:"text-sm text-red-600 font-medium mt-1",children:["Saldo pendiente: S/ ",h.balance.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Monto a cobrar (S/)"}),(0,s.jsx)("input",{type:"number",step:"0.01",value:g,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border rounded-lg",autoFocus:!0}),(0,s.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,s.jsx)("button",{onClick:()=>u((h.balance/2).toFixed(2)),className:"text-xs px-2 py-1 bg-gray-100 rounded hover:bg-gray-200",children:"50%"}),(0,s.jsx)("button",{onClick:()=>u(h.balance.toString()),className:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200",children:"Total"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"M\xe9todo de pago"}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2",children:["CASH","YAPE","PLIN","CARD"].map(e=>(0,s.jsx)("button",{onClick:()=>y(e),className:"py-2 px-3 rounded-lg border font-medium text-sm ".concat(b===e?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 text-gray-700 hover:border-gray-300"),children:e},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notas (opcional)"}),(0,s.jsx)("textarea",{value:j,onChange:e=>N(e.target.value),className:"w-full px-3 py-2 border rounded-lg",rows:2,placeholder:"Ej: Abono parcial..."})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,s.jsx)("button",{onClick:()=>m(!1),className:"flex-1 py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50",disabled:v,children:"Cancelar"}),(0,s.jsx)("button",{onClick:E,className:"flex-1 py-2 px-4 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",disabled:v,children:v?"Procesando...":"Registrar Pago"})]})]})}),w&&h&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-2xl p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Historial de Pagos"}),(0,s.jsxs)("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[(0,s.jsx)("div",{className:"font-medium",children:h.customer.name}),(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["Ticket #",h.sale.saleNumber]})]}),(0,s.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:h.payments.map(e=>(0,s.jsx)("div",{className:"border rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"font-medium text-lg",children:["S/ ",e.amount.toFixed(2)]}),(0,s.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:new Date(e.createdAt).toLocaleString("es-PE")}),(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["Por: ",e.createdBy]}),e.notes&&(0,s.jsx)("div",{className:"text-sm text-gray-500 mt-1 italic",children:e.notes})]}),(0,s.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:e.method})]})},e.id))}),(0,s.jsx)("button",{onClick:()=>C(!1),className:"w-full mt-4 py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cerrar"})]})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[814,8173,9121,9445,8441,1517,7358],()=>t(6841)),_N_E=e.O()}]);