(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5812],{2843:(e,t,a)=>{Promise.resolve().then(a.bind(a,2771))},6046:(e,t,a)=>{"use strict";var s=a(6658);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},2771:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var s=a(5155),r=a(2115),l=a(6046),n=a(814);function c(){let e=(0,l.useRouter)(),[t,a]=(0,r.useState)([]),[c,i]=(0,r.useState)(!0),[o,d]=(0,r.useState)(""),[x,m]=(0,r.useState)(!1),[u,h]=(0,r.useState)(!1),[p,y]=(0,r.useState)({name:"",phone:"",dni:"",notes:""});(0,r.useEffect)(()=>{g()},[]);let g=async()=>{try{i(!0);let e=await fetch("/api/customers?activeOnly=false");if(!e.ok)throw Error("Error al cargar clientes");let t=await e.json();a(t.customers)}catch(e){console.error("Error loading customers:",e),n.oR.error("Error al cargar clientes")}finally{i(!1)}},b=async()=>{try{i(!0);let e=new URLSearchParams;o&&e.set("search",o),e.set("activeOnly","false");let t=await fetch("/api/customers?".concat(e));if(!t.ok)throw Error("Error al buscar");let s=await t.json();a(s.customers)}catch(e){n.oR.error("Error al buscar clientes")}finally{i(!1)}},f=async e=>{if(e.preventDefault(),!p.name.trim()){n.oR.error("El nombre es obligatorio");return}try{h(!0);let e=await fetch("/api/customers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(!e.ok){let t=await e.json();throw Error(t.message)}n.oR.success("Cliente creado exitosamente"),m(!1),y({name:"",phone:"",dni:"",notes:""}),g()}catch(e){console.error("Error creating customer:",e),n.oR.error(e.message||"Error al crear cliente")}finally{h(!1)}},j=async(e,t)=>{try{if(!(await fetch("/api/customers/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({active:!t})})).ok)throw Error("Error al actualizar");n.oR.success(t?"Cliente desactivado":"Cliente activado"),g()}catch(e){n.oR.error("Error al actualizar cliente")}},N=o?t.filter(e=>{var t,a;return e.name.toLowerCase().includes(o.toLowerCase())||(null===(t=e.phone)||void 0===t?void 0:t.includes(o))||(null===(a=e.dni)||void 0===a?void 0:a.includes(o))}):t;return c&&0===t.length?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"text-gray-500",children:"Cargando clientes..."})}):(0,s.jsxs)("div",{className:"p-8 max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"Clientes"}),(0,s.jsx)("button",{onClick:()=>m(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"+ Nuevo Cliente"})]}),(0,s.jsxs)("div",{className:"mb-6 flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:o,onChange:e=>d(e.target.value),onKeyDown:e=>"Enter"===e.key&&b(),placeholder:"Buscar por nombre, tel\xe9fono o DNI...",className:"flex-1 border rounded-lg px-4 py-2"}),(0,s.jsx)("button",{onClick:b,className:"bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700",children:"Buscar"}),(0,s.jsx)("button",{onClick:()=>{d(""),g()},className:"bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500",children:"Limpiar"})]}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cliente"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tel\xe9fono"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"DNI"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Deudas Abiertas"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Saldo Total"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Estado"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),(0,s.jsxs)("tbody",{className:"divide-y divide-gray-200",children:[N.map(t=>(0,s.jsxs)("tr",{className:t.active?"":"bg-gray-50",children:[(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:t.name}),t.notes&&(0,s.jsx)("div",{className:"text-sm text-gray-500",children:t.notes})]}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.phone||"-"}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.dni||"-"}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:t.openReceivablesCount>0?(0,s.jsx)("span",{className:"text-orange-600 font-medium",children:t.openReceivablesCount}):(0,s.jsx)("span",{className:"text-gray-400",children:"0"})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:t.totalBalance>0?(0,s.jsxs)("span",{className:"text-red-600 font-medium",children:["S/ ",t.totalBalance.toFixed(2)]}):(0,s.jsx)("span",{className:"text-gray-400",children:"S/ 0.00"})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat(t.active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:t.active?"Activo":"Inactivo"})}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[(0,s.jsx)("button",{onClick:()=>e.push("/customers/".concat(t.id)),className:"text-blue-600 hover:text-blue-800 mr-3",children:"Ver"}),(0,s.jsx)("button",{onClick:()=>j(t.id,t.active),className:t.active?"text-red-600 hover:text-red-800":"text-green-600 hover:text-green-800",children:t.active?"Desactivar":"Activar"})]})]},t.id)),0===N.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:7,className:"px-6 py-8 text-center text-gray-500",children:"No se encontraron clientes"})})]})]})}),x&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Nuevo Cliente"}),(0,s.jsxs)("form",{onSubmit:f,children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Nombre ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:p.name,onChange:e=>y({...p,name:e.target.value}),className:"w-full border rounded-lg px-3 py-2",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tel\xe9fono"}),(0,s.jsx)("input",{type:"text",value:p.phone,onChange:e=>y({...p,phone:e.target.value}),className:"w-full border rounded-lg px-3 py-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DNI"}),(0,s.jsx)("input",{type:"text",value:p.dni,onChange:e=>y({...p,dni:e.target.value}),className:"w-full border rounded-lg px-3 py-2",maxLength:8})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notas"}),(0,s.jsx)("textarea",{value:p.notes,onChange:e=>y({...p,notes:e.target.value}),className:"w-full border rounded-lg px-3 py-2",rows:3})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{m(!1),y({name:"",phone:"",dni:"",notes:""})},className:"flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400",disabled:u,children:"Cancelar"}),(0,s.jsx)("button",{type:"submit",className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50",disabled:u,children:u?"Creando...":"Crear Cliente"})]})]})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[814,8441,1517,7358],()=>t(2843)),_N_E=e.O()}]);