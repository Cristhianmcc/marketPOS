(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9117],{3742:(e,t,a)=>{Promise.resolve().then(a.bind(a,2158))},6889:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7401).A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},4857:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7401).A)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])},3466:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7401).A)("file-check",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]])},4505:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7401).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},5603:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7401).A)("printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]])},8283:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7401).A)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},3950:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7401).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},2158:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>A});var s=a(5155),r=a(2115),l=a(6046),o=a(9445),n=a(3666),i=a(853),c=a(5603),d=a(814),x=a(7401);let u=(0,x.A)("file",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]]);var m=a(6889),p=a(8283),h=a(3466);let g=(0,x.A)("file-x",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m14.5 12.5-5 5",key:"b62r18"}],["path",{d:"m9.5 12.5 5 5",key:"1rk7el"}]]);var y=a(3950);function b(e){let{status:t,sunatCode:a,sunatMessage:r}=e,l=(()=>{switch(t){case"DRAFT":return{label:"Borrador",icon:u,className:"bg-gray-100 text-gray-700 border-gray-300"};case"SIGNED":return{label:"Firmado",icon:m.A,className:"bg-yellow-100 text-yellow-700 border-yellow-300"};case"SENT":return{label:"Enviado",icon:p.A,className:"bg-blue-100 text-blue-700 border-blue-300"};case"ACCEPTED":return{label:"Aceptado",icon:h.A,className:"bg-green-100 text-green-700 border-green-300"};case"REJECTED":return{label:"Rechazado",icon:g,className:"bg-red-100 text-red-700 border-red-300"};case"ERROR":return{label:"Error",icon:y.A,className:"bg-orange-100 text-orange-700 border-orange-300"};default:return{label:"Desconocido",icon:y.A,className:"bg-gray-100 text-gray-700 border-gray-300"}}})(),o=l.icon;return(0,s.jsxs)("div",{className:"inline-flex flex-col gap-1",children:[(0,s.jsxs)("div",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium border ".concat(l.className),children:[(0,s.jsx)(o,{className:"w-3.5 h-3.5"}),l.label]}),a&&r&&(0,s.jsxs)("div",{className:"text-xs text-gray-600",title:r,children:[a,": ",r.length>30?r.slice(0,30)+"...":r]})]})}var j=a(4505);let f=(0,x.A)("rotate-cw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);var N=a(4857),v=a(4081);function w(e){let{saleId:t,documentId:a,status:l,hasXml:o,hasCdr:n,userRole:i,paymentMethod:c,onActionComplete:x}=e,[u,m]=(0,r.useState)(!1),[h,g]=(0,r.useState)(!1),[y,b]=(0,r.useState)(!1),[w,A]=(0,r.useState)("BOLETA"),[C,k]=(0,r.useState)("DNI"),[E,T]=(0,r.useState)(""),[R,S]=(0,r.useState)(""),[P,D]=(0,r.useState)(""),[M,U]=(0,r.useState)("");if("FIADO"===c)return null;let F=async()=>{if(!E||!R){d.oR.error("Completa todos los campos obligatorios");return}g(!0);try{let e=await fetch("/api/sunat/emit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({saleId:t,docType:w,customerDocType:C,customerDocNumber:E,customerName:R,customerAddress:P||void 0,customerEmail:M||void 0})}),a=await e.json();if(!e.ok){d.oR.error(a.error||"Error al emitir comprobante");return}d.oR.success("Comprobante creado y encolado para env\xedo a SUNAT"),m(!1),null==x||x()}catch(e){console.error("Error emitting:",e),d.oR.error("Error de red al emitir comprobante")}finally{g(!1)}},O=async()=>{if(a){b(!0);try{let e=await fetch("/api/sunat/documents/".concat(a,"/retry"),{method:"POST"}),t=await e.json();if(!e.ok){d.oR.error(t.error||"Error al reintentar env\xedo");return}d.oR.success("Reintento encolado. El worker procesar\xe1 el env\xedo."),null==x||x()}catch(e){console.error("Error retrying:",e),d.oR.error("Error de red al reintentar env\xedo")}finally{b(!1)}}},z=async e=>{if(a)try{let t="/api/sunat/documents/".concat(a,"/download?type=").concat(e);window.open(t,"_blank"),d.oR.success("Descargando ".concat(e.toUpperCase(),"..."))}catch(e){console.error("Error downloading:",e),d.oR.error("Error al descargar archivo")}};return(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[!a&&(0,s.jsxs)("button",{onClick:()=>m(!0),className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors",children:[(0,s.jsx)(p.A,{className:"w-3.5 h-3.5"}),"Emitir"]}),a&&("ERROR"===l||"REJECTED"===l)&&(0,s.jsxs)("button",{onClick:O,disabled:y,className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white bg-orange-600 rounded hover:bg-orange-700 transition-colors disabled:opacity-50",children:[y?(0,s.jsx)(j.A,{className:"w-3.5 h-3.5 animate-spin"}):(0,s.jsx)(f,{className:"w-3.5 h-3.5"}),"Reintentar"]}),a&&o&&(0,s.jsxs)("button",{onClick:()=>z("xml"),className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 rounded hover:bg-gray-200 transition-colors",children:[(0,s.jsx)(N.A,{className:"w-3.5 h-3.5"}),"XML"]}),a&&n&&"ACCEPTED"===l&&(0,s.jsxs)("button",{onClick:()=>z("cdr"),className:"inline-flex items-center gap-1.5 px-3.5 py-1.5 text-xs font-medium text-green-700 bg-green-100 rounded hover:bg-green-200 transition-colors",children:[(0,s.jsx)(v.A,{className:"w-3.5 h-3.5"}),"CDR"]}),u&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6 max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Emitir Comprobante SUNAT"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Comprobante"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>A("BOLETA"),className:"flex-1 px-3 py-2 text-sm rounded border ".concat("BOLETA"===w?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"),children:"BOLETA"}),(0,s.jsx)("button",{type:"button",onClick:()=>A("FACTURA"),disabled:"CASHIER"===i,className:"flex-1 px-3 py-2 text-sm rounded border ".concat("FACTURA"===w?"bg-blue-600 text-white border-blue-600":"CASHIER"===i?"bg-gray-100 text-gray-400 border-gray-300 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"),children:"FACTURA"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Documento"}),(0,s.jsx)("select",{value:C,onChange:e=>k(e.target.value),disabled:"FACTURA"===w,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",children:"FACTURA"===w?(0,s.jsx)("option",{value:"RUC",children:"RUC"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("option",{value:"DNI",children:"DNI"}),(0,s.jsx)("option",{value:"CE",children:"Carnet de Extranjer\xeda"}),(0,s.jsx)("option",{value:"PASAPORTE",children:"Pasaporte"})]})})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["N\xfamero de ",C]}),(0,s.jsx)("input",{type:"text",value:E,onChange:e=>T(e.target.value),placeholder:"RUC"===C?"20123456789":"12345678",maxLength:"RUC"===C?11:20,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"FACTURA"===w?"Raz\xf3n Social":"Nombre Completo"}),(0,s.jsx)("input",{type:"text",value:R,onChange:e=>S(e.target.value),placeholder:"FACTURA"===w?"MI EMPRESA S.A.C.":"Juan P\xe9rez",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"})]}),"FACTURA"===w&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Direcci\xf3n ",(0,s.jsx)("span",{className:"text-gray-500",children:"(opcional)"})]}),(0,s.jsx)("input",{type:"text",value:P,onChange:e=>D(e.target.value),placeholder:"Av. Principal 123, Lima",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Email ",(0,s.jsx)("span",{className:"text-gray-500",children:"(opcional)"})]}),(0,s.jsx)("input",{type:"email",value:M,onChange:e=>U(e.target.value),placeholder:"cliente@ejemplo.com",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,s.jsx)("button",{onClick:F,disabled:h,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 flex items-center justify-center gap-2",children:h?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.A,{className:"w-4 h-4 animate-spin"}),"Emitiendo..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.A,{className:"w-4 h-4"}),"Emitir"]})}),(0,s.jsx)("button",{onClick:()=>m(!1),disabled:h,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 disabled:opacity-50",children:"Cancelar"})]})]})})]})}function A(){let e=(0,l.useRouter)(),[t,a]=(0,r.useState)([]),[x,u]=(0,r.useState)(!0),[m,p]=(0,r.useState)(""),[h,g]=(0,r.useState)(""),[y,j]=(0,r.useState)(""),[f,N]=(0,r.useState)(null),[v,A]=(0,r.useState)(!1),[C,k]=(0,r.useState)(null),[E,T]=(0,r.useState)(""),[R,S]=(0,r.useState)(""),[P,D]=(0,r.useState)({}),[M,U]=(0,r.useState)(!1);(0,r.useEffect)(()=>{O(),F(),z()},[]);let F=async()=>{try{let e=await fetch("/api/sunat/settings/status");if(e.ok){let t=await e.json();U(t.enabled&&t.configured)}}catch(e){console.error("Error checking SUNAT status:",e)}},O=async()=>{try{let e=await fetch("/api/auth/me");if(e.ok){let t=await e.json();T(t.user.role),S(t.user.id)}}catch(e){console.error("Error loading user info:",e)}},z=async()=>{try{let e=new URLSearchParams;m&&e.append("query",m),h&&e.append("from",h),y&&e.append("to",y);let t=await fetch("/api/sales?".concat(e.toString())),s=await t.json();a(s.sales||[]),M&&s.sales&&L(s.sales.map(e=>e.id))}catch(e){console.error("Error fetching sales:",e)}finally{u(!1)}},L=async e=>{let t={};await Promise.all(e.map(async e=>{try{let a=await fetch("/api/sunat/by-sale/".concat(e));if(a.ok){let s=await a.json();t[e]=s}}catch(t){console.error("Error fetching document for sale ".concat(e,":"),t)}})),D(t)},I=e=>{if(0===e.total&&0===e.subtotal)return!1;if("OWNER"===E)return!0;if("CASHIER"===E){let a=t.filter(e=>e.total>0).sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime());return a.length>0&&a[0].id===e.id}return!1},V=e=>{k(e),A(!0)},H=async()=>{if(C){N(C.id),A(!1);try{let e=await fetch("/api/sales/".concat(C.id,"/cancel"),{method:"POST"}),t=await e.json();if(!e.ok){d.oR.error(t.message||"Error al anular venta");return}d.oR.success("Venta anulada correctamente"),z()}catch(e){d.oR.error("Error de red al anular venta")}finally{N(null),k(null)}}},B=e=>({CASH:"Efectivo",YAPE:"Yape",PLIN:"Plin",CARD:"Tarjeta"})[e]||e;return(0,s.jsxs)(o.A,{storeName:"Historial de Ventas",children:[(0,s.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[v&&C&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-md w-full mx-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Confirmar Anulaci\xf3n"}),(0,s.jsxs)("p",{className:"text-gray-600 mb-6",children:["\xbfSeguro que deseas anular el ticket ",C.saleNumber,"?",(0,s.jsx)("br",{}),(0,s.jsx)("strong",{children:"Esta acci\xf3n no se puede deshacer."})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:H,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Anular Venta"}),(0,s.jsx)("button",{onClick:()=>{A(!1),k(null)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"Cancelar"})]})]})}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,s.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),z()},className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Buscar por N\xb0 de Ticket"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"text",value:m,onChange:e=>p(e.target.value),placeholder:"Ej: V-001",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"}),(0,s.jsx)(i.A,{className:"absolute left-3 top-2.5 w-5 h-5 text-gray-400"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Desde"}),(0,s.jsx)("input",{type:"date",value:h,onChange:e=>g(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hasta"}),(0,s.jsx)("input",{type:"date",value:y,onChange:e=>j(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Buscar"}),(m||h||y)&&(0,s.jsx)("button",{type:"button",onClick:()=>{p(""),g(""),j(""),setTimeout(z,0)},className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors",children:"Limpiar"})]})]})}),(0,s.jsx)("div",{className:"overflow-x-auto",children:x?(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):0===t.length?(0,s.jsx)("div",{className:"text-center py-12 text-gray-500",children:"No se encontraron ventas"}):(0,s.jsxs)("table",{className:"w-full table-auto",children:[(0,s.jsxs)("colgroup",{children:[(0,s.jsx)("col",{style:{width:"5%"}})," ",(0,s.jsx)("col",{style:{width:"8%"}})," ",(0,s.jsx)("col",{style:{width:"5%"}})," ",(0,s.jsx)("col",{style:{width:"5%"}})," ",(0,s.jsx)("col",{style:{width:"5%"}})," ",(0,s.jsx)("col",{style:{width:"5%"}})," ",(0,s.jsx)("col",{style:{width:"5%"}})," ",(0,s.jsx)("col",{style:{width:"6%"}})," ",(0,s.jsx)("col",{style:{width:"7%"}})," ",(0,s.jsx)("col",{style:{width:"5%"}})," ",(0,s.jsx)("col",{style:{width:"8%"}})," ",(0,s.jsx)("col",{style:{width:"5%"}})," ",M&&(0,s.jsx)("col",{style:{width:"14%"}})," ",(0,s.jsx)("col",{style:{width:M?"17%":"20%"}})," "]}),(0,s.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"N\xb0"}),(0,s.jsx)("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fecha"}),(0,s.jsx)("th",{className:"px-2 py-3 text-right text-xs font-medium text-blue-600 uppercase",children:"2x1"}),(0,s.jsx)("th",{className:"px-2 py-3 text-right text-xs font-medium text-purple-600 uppercase",children:"Categ"}),(0,s.jsx)("th",{className:"px-2 py-3 text-right text-xs font-medium text-orange-600 uppercase",children:"Volumen"}),(0,s.jsx)("th",{className:"px-2 py-3 text-right text-xs font-medium text-yellow-600 uppercase",children:"Lleva+"}),(0,s.jsx)("th",{className:"px-2 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Desc."}),(0,s.jsx)("th",{className:"px-2 py-3 text-right text-xs font-medium text-green-600 uppercase",children:"Cup\xf3n"}),(0,s.jsx)("th",{className:"px-2 py-3 text-right text-xs font-medium text-gray-700 uppercase",children:"Total"}),(0,s.jsx)("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Pago"}),(0,s.jsx)("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cajero"}),(0,s.jsx)("th",{className:"px-2 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Estado"}),M&&(0,s.jsx)("th",{className:"px-2 py-3 text-center text-xs font-medium text-indigo-600 uppercase",children:"SUNAT"}),(0,s.jsx)("th",{className:"px-2 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-200",children:t.map(t=>{var a,r,l,o,i,d,x,u,m;let p=0===t.total&&0===t.subtotal;return(0,s.jsxs)("tr",{className:"hover:bg-gray-50 ".concat(p?"bg-red-50":""),children:[(0,s.jsx)("td",{className:"px-2 py-3 text-sm font-medium text-gray-900",children:t.saleNumber}),(0,s.jsx)("td",{className:"px-2 py-3 text-xs text-gray-600",children:new Date(t.createdAt).toLocaleString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).replace(",","")}),(0,s.jsx)("td",{className:"px-2 py-3 text-xs text-right text-blue-600",children:t.promotionsTotal&&t.promotionsTotal>0?(0,s.jsxs)("span",{children:["-",(0,n.up)(t.promotionsTotal)]}):(0,s.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,s.jsx)("td",{className:"px-2 py-3 text-xs text-right text-purple-600 font-medium",children:t.categoryPromotionsTotal&&t.categoryPromotionsTotal>0?(0,s.jsxs)("span",{children:["-",(0,n.up)(t.categoryPromotionsTotal)]}):(0,s.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,s.jsx)("td",{className:"px-2 py-3 text-xs text-right text-orange-600 font-medium",children:t.volumePromotionsTotal&&t.volumePromotionsTotal>0?(0,s.jsxs)("span",{children:["-",(0,n.up)(t.volumePromotionsTotal)]}):(0,s.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,s.jsx)("td",{className:"px-2 py-3 text-xs text-right text-yellow-600 font-medium",children:t.nthPromotionsTotal&&t.nthPromotionsTotal>0?(0,s.jsxs)("span",{children:["-",(0,n.up)(t.nthPromotionsTotal)]}):(0,s.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,s.jsx)("td",{className:"px-2 py-3 text-xs text-right text-gray-600",children:t.discountTotal>0?(0,s.jsxs)("span",{children:["-",(0,n.up)(t.discountTotal)]}):(0,s.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,s.jsx)("td",{className:"px-2 py-3 text-xs text-right",children:t.couponCode&&t.couponDiscount&&t.couponDiscount>0?(0,s.jsxs)("div",{className:"flex flex-col items-end",children:[(0,s.jsxs)("span",{className:"text-green-700 font-medium",children:["-",(0,n.up)(t.couponDiscount)]}),(0,s.jsx)("span",{className:"text-xs text-gray-500",children:t.couponCode})]}):(0,s.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,s.jsx)("td",{className:"px-2 py-3 text-sm text-right font-semibold text-gray-900",children:p?(0,s.jsx)("span",{className:"text-red-600 line-through",children:"S/ 0.00"}):(0,n.up)(t.total)}),(0,s.jsx)("td",{className:"px-2 py-3 text-xs text-gray-600",children:B(t.paymentMethod)}),(0,s.jsx)("td",{className:"px-2 py-3 text-xs text-gray-600 truncate",children:t.user.name}),(0,s.jsx)("td",{className:"px-2 py-3 text-center",children:(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium ".concat(p?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:p?"ANULADA":"ACTIVA"})}),M&&(0,s.jsx)("td",{className:"px-2 py-3",children:(null===(a=P[t.id])||void 0===a?void 0:a.hasDocument)&&P[t.id].document?(0,s.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,s.jsx)(b,{status:P[t.id].document.status,sunatCode:P[t.id].document.sunatCode,sunatMessage:P[t.id].document.sunatMessage}),(0,s.jsx)("span",{className:"text-xs text-gray-600",children:P[t.id].document.fullNumber})]}):(0,s.jsx)("div",{className:"text-xs text-gray-400 text-center",children:"Sin comprobante"})}),(0,s.jsx)("td",{className:"px-3 py-3",children:(0,s.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,s.jsxs)("div",{className:"flex gap-1.5 justify-center",children:[(0,s.jsxs)("button",{onClick:()=>e.push("/receipt/".concat(t.id)),className:"inline-flex items-center gap-1 px-2.5 py-1.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-xs",children:[(0,s.jsx)(c.A,{className:"w-3.5 h-3.5"}),"Ver"]}),I(t)&&(0,s.jsx)("button",{onClick:()=>V(t),disabled:f===t.id,className:"px-2.5 py-1.5 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:bg-gray-400 transition-colors text-xs whitespace-nowrap",children:f===t.id?"Anulando...":"Anular"})]}),M&&!p&&(0,s.jsx)(w,{saleId:t.id,documentId:null===(l=P[t.id])||void 0===l?void 0:null===(r=l.document)||void 0===r?void 0:r.id,status:null===(i=P[t.id])||void 0===i?void 0:null===(o=i.document)||void 0===o?void 0:o.status,hasXml:null===(x=P[t.id])||void 0===x?void 0:null===(d=x.document)||void 0===d?void 0:d.hasXml,hasCdr:null===(m=P[t.id])||void 0===m?void 0:null===(u=m.document)||void 0===u?void 0:u.hasCdr,userRole:E,paymentMethod:t.paymentMethod,onActionComplete:()=>L([t.id])})]})})]},t.id)})})]})})]})]}),(0,s.jsx)(d.l$,{position:"top-right",richColors:!0})]})}},3666:(e,t,a)=>{"use strict";function s(e){if(null==e||isNaN(e))return"S/ 0.00";let t="string"==typeof e?parseFloat(e):e;return"S/ ".concat(t.toFixed(2))}a.d(t,{up:()=>s})}},e=>{var t=t=>e(e.s=t);e.O(0,[814,8173,9121,9445,8441,1517,7358],()=>t(3742)),_N_E=e.O()}]);