(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3446],{3933:(e,s,a)=>{Promise.resolve().then(a.bind(a,6826))},8867:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(7401).A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},3473:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(7401).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},6826:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>m});var t=a(5155),r=a(2115),n=a(9445),l=a(3473),c=a(767),o=a(8867),i=a(5686),d=a(814),x=a(3666);function m(){let[e,s]=(0,r.useState)([]),[a,m]=(0,r.useState)(!0),[u,p]=(0,r.useState)(!1),[h,g]=(0,r.useState)(!1),[y,j]=(0,r.useState)(""),[b,N]=(0,r.useState)("PERCENT"),[f,v]=(0,r.useState)(""),[C,w]=(0,r.useState)(""),[E,k]=(0,r.useState)(""),[A,R]=(0,r.useState)(""),[S,D]=(0,r.useState)("");(0,r.useEffect)(()=>{T()},[]);let T=async()=>{try{let e=await fetch("/api/coupons");if(e.ok){let a=await e.json();s(a)}}catch(e){console.error("Error fetching coupons:",e),d.oR.error("Error al cargar cupones")}finally{m(!1)}},P=async()=>{if(!y.trim()){d.oR.error("Ingresa un c\xf3digo de cup\xf3n");return}if(!f||0>=parseFloat(f)){d.oR.error("Ingresa un valor v\xe1lido");return}if("PERCENT"===b&&parseFloat(f)>100){d.oR.error("El porcentaje no puede ser mayor a 100");return}if(E&&A&&new Date(A)<=new Date(E)){d.oR.error("La fecha de fin debe ser posterior a la de inicio");return}g(!0);try{let e=await fetch("/api/coupons",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:y.trim().toUpperCase(),type:b,value:parseFloat(f),minTotal:C?parseFloat(C):null,startsAt:E||null,endsAt:A||null,maxUses:S?parseInt(S):null})}),s=await e.json();if(!e.ok){d.oR.error(s.message||"Error al crear cup\xf3n");return}d.oR.success("Cup\xf3n creado exitosamente"),p(!1),M(),T()}catch(e){console.error("Error creating coupon:",e),d.oR.error("Error al crear cup\xf3n")}finally{g(!1)}},F=async(e,s)=>{try{if(!(await fetch("/api/coupons/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({active:!s})})).ok){d.oR.error("Error al actualizar cup\xf3n");return}d.oR.success(s?"Cup\xf3n desactivado":"Cup\xf3n activado"),T()}catch(e){console.error("Error updating coupon:",e),d.oR.error("Error al actualizar cup\xf3n")}},U=async(e,s)=>{if(confirm("\xbfEliminar cup\xf3n ".concat(s,"?")))try{if(!(await fetch("/api/coupons/".concat(e),{method:"DELETE"})).ok){d.oR.error("Error al eliminar cup\xf3n");return}d.oR.success("Cup\xf3n eliminado"),T()}catch(e){console.error("Error deleting coupon:",e),d.oR.error("Error al eliminar cup\xf3n")}},M=()=>{j(""),N("PERCENT"),v(""),w(""),k(""),R(""),D("")},I=e=>!!e&&new Date(e)<new Date,O=e=>!!e&&new Date(e)>new Date;return a?(0,t.jsx)(n.A,{children:(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"text-gray-500",children:"Cargando cupones..."})})}):(0,t.jsxs)(n.A,{children:[(0,t.jsx)(d.l$,{position:"top-right"}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Cupones de Descuento"}),(0,t.jsxs)("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:[(0,t.jsx)(l.A,{className:"w-5 h-5"}),"Nuevo Cup\xf3n"]})]}),0===e.length?(0,t.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[(0,t.jsx)("p",{className:"text-gray-600",children:"No hay cupones creados"}),(0,t.jsx)("button",{onClick:()=>p(!0),className:"mt-4 text-green-600 hover:text-green-700 font-medium",children:"Crear primer cup\xf3n"})]}):(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map(e=>(0,t.jsxs)("div",{className:"border rounded-lg p-4 ".concat(e.active?"border-green-200 bg-green-50":"border-gray-200 bg-gray-50"),children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:e.code}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsx)("span",{className:"text-xs px-2 py-0.5 rounded ".concat(e.active?"bg-green-100 text-green-700":"bg-gray-200 text-gray-600"),children:e.active?"Activo":"Inactivo"}),I(e.endsAt)&&(0,t.jsx)("span",{className:"text-xs px-2 py-0.5 rounded bg-red-100 text-red-700",children:"Expirado"}),O(e.startsAt)&&(0,t.jsx)("span",{className:"text-xs px-2 py-0.5 rounded bg-yellow-100 text-yellow-700",children:"Pendiente"})]})]}),(0,t.jsx)("button",{onClick:()=>F(e.id,e.active),className:"p-1.5 rounded ".concat(e.active?"text-gray-600 hover:bg-gray-200":"text-green-600 hover:bg-green-100"),title:e.active?"Desactivar":"Activar",children:e.active?(0,t.jsx)(c.A,{className:"w-4 h-4"}):(0,t.jsx)(o.A,{className:"w-4 h-4"})})]}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Descuento:"}),(0,t.jsx)("span",{className:"font-semibold text-gray-900",children:"PERCENT"===e.type?"".concat(e.value,"%"):(0,x.up)(e.value)})]}),e.minTotal&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"M\xednimo:"}),(0,t.jsx)("span",{className:"font-medium text-gray-900",children:(0,x.up)(e.minTotal)})]}),e.maxUses&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Usos:"}),(0,t.jsxs)("span",{className:"font-medium text-gray-900",children:[e.usesCount," / ",e.maxUses]})]}),!e.maxUses&&e.usesCount>0&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Usos:"}),(0,t.jsxs)("span",{className:"font-medium text-gray-900",children:[e.usesCount," (ilimitado)"]})]}),e.startsAt&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Inicia:"}),(0,t.jsx)("span",{className:"font-medium text-gray-900",children:new Date(e.startsAt).toLocaleDateString("es-PE")})]}),e.endsAt&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Expira:"}),(0,t.jsx)("span",{className:"font-medium text-gray-900",children:new Date(e.endsAt).toLocaleDateString("es-PE")})]})]}),(0,t.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200 flex justify-end",children:(0,t.jsxs)("button",{onClick:()=>U(e.id,e.code),className:"flex items-center gap-1 px-3 py-1.5 text-sm text-red-600 hover:bg-red-50 rounded",children:[(0,t.jsx)(i.A,{className:"w-4 h-4"}),"Eliminar"]})})]},e.id))})]}),u&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-md p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Crear Cup\xf3n"}),(0,t.jsx)("button",{onClick:()=>{p(!1),M()},className:"text-gray-400 hover:text-gray-600",children:(0,t.jsx)(c.A,{className:"w-5 h-5"})})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C\xf3digo *"}),(0,t.jsx)("input",{type:"text",value:y,onChange:e=>j(e.target.value.toUpperCase()),placeholder:"NAVIDAD10",className:"w-full px-3 py-2 border border-gray-300 rounded-md",maxLength:20})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Descuento *"}),(0,t.jsxs)("select",{value:b,onChange:e=>N(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[(0,t.jsx)("option",{value:"PERCENT",children:"Porcentaje (%)"}),(0,t.jsx)("option",{value:"AMOUNT",children:"Monto Fijo (S/)"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor *"}),(0,t.jsx)("input",{type:"number",value:f,onChange:e=>v(e.target.value),placeholder:"PERCENT"===b?"10":"5.00",step:"PERCENT"===b?"1":"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"PERCENT"===b?"Porcentaje de descuento (0-100)":"Monto en soles"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Compra M\xednima (opcional)"}),(0,t.jsx)("input",{type:"number",value:C,onChange:e=>w(e.target.value),placeholder:"0.00",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha Inicio"}),(0,t.jsx)("input",{type:"date",value:E,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha Fin"}),(0,t.jsx)("input",{type:"date",value:A,onChange:e=>R(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"M\xe1ximo de Usos (opcional)"}),(0,t.jsx)("input",{type:"number",value:S,onChange:e=>D(e.target.value),placeholder:"Ilimitado",min:"1",className:"w-full px-3 py-2 border border-gray-300 rounded-md"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Dejar vac\xedo para usos ilimitados"})]})]}),(0,t.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,t.jsx)("button",{onClick:()=>{p(!1),M()},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50",children:"Cancelar"}),(0,t.jsx)("button",{onClick:P,disabled:h,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50",children:h?"Creando...":"Crear Cup\xf3n"})]})]})})]})}},3666:(e,s,a)=>{"use strict";function t(e){if(null==e||isNaN(e))return"S/ 0.00";let s="string"==typeof e?parseFloat(e):e;return"S/ ".concat(s.toFixed(2))}a.d(s,{up:()=>t})}},e=>{var s=s=>e(e.s=s);e.O(0,[814,8173,9121,9445,8441,1517,7358],()=>s(3933)),_N_E=e.O()}]);