(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4807],{464:(e,t,r)=>{Promise.resolve().then(r.bind(r,9830))},9830:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>L});var s=r(5155),a=r(2115),o=r(1594),n=r(3950),l=r(853),i=r(8474),c=r(2792),d=r(3473),u=r(767),m=r(9445),x=r(8761),p=r(4505);let h=(0,a.memo)(function(e){let{onAddProduct:t,disabled:r=!1}=e,[o,n]=(0,a.useState)([]),[l,c]=(0,a.useState)(!0),[d,u]=(0,a.useState)(null),[m,x]=(0,a.useState)(!1);(0,a.useEffect)(()=>{x(!0),h()},[]);let h=async()=>{try{c(!0),u(null);let e=await fetch("/api/pos/quick-sell?limit=8");if(!e.ok)throw Error("Error al cargar productos r\xe1pidos");let t=await e.json();n(t)}catch(e){console.error("[QuickSellGrid] Error:",e),u("Error al cargar productos r\xe1pidos")}finally{c(!1)}};return m&&(l||0!==o.length)&&!d?l?(0,s.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:(0,s.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,s.jsx)(p.A,{className:"w-6 h-6 animate-spin text-gray-400"})})}):(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)(i.A,{className:"w-5 h-5 text-gray-600"}),(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:"Productos R\xe1pidos"}),(0,s.jsx)("span",{className:"text-xs text-gray-500 ml-auto",children:"Click para agregar al carrito"})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 md:gap-3",children:o.map(e=>{let a=null!==e.stock&&e.stock<=0,o=null!==e.stock&&e.stock>0&&e.stock<=5,n=r||a;return(0,s.jsxs)("button",{onClick:()=>!n&&t(e.id),disabled:n,className:"\n                relative flex flex-col items-center gap-2 p-3 md:p-4 rounded-lg border-2 \n                transition-all duration-150 min-h-[120px] md:min-h-[140px]\n                ".concat(n?"bg-gray-50 border-gray-200 cursor-not-allowed opacity-60":"bg-white border-gray-300 hover:border-green-500 hover:shadow-md active:scale-95 cursor-pointer touch-manipulation","\n              "),children:[(0,s.jsx)("div",{className:"w-14 h-14 md:w-16 md:h-16 rounded-lg bg-gradient-to-br from-green-50 to-green-100 flex items-center justify-center overflow-hidden",children:e.imageUrl?(0,s.jsx)("img",{src:e.imageUrl,alt:e.name,className:"w-full h-full object-cover"}):(0,s.jsx)("span",{className:"text-2xl md:text-3xl font-bold text-green-700",children:e.name.charAt(0).toUpperCase()})}),(0,s.jsx)("div",{className:"w-full text-center",children:(0,s.jsx)("p",{className:"text-sm md:text-base font-medium text-gray-900 line-clamp-2 leading-tight",children:e.name})}),(0,s.jsxs)("div",{className:"text-base md:text-lg font-bold text-green-600",children:["S/ ",Number(e.price).toFixed(2)]}),o&&!a&&(0,s.jsx)("div",{className:"absolute top-1 right-1 bg-yellow-500 text-white text-xs font-semibold px-2 py-1 rounded-full",children:e.stock}),a&&(0,s.jsx)("div",{className:"absolute top-1 right-1 bg-red-500 text-white text-xs font-semibold px-2 py-1 rounded-full",children:"Sin stock"}),!n&&(0,s.jsx)("div",{className:"absolute bottom-1 right-1 bg-green-500 text-white rounded-full p-1.5",children:(0,s.jsx)(i.A,{className:"w-4 h-4"})})]},e.id)})})]}):null});var g=r(5381),b=r(1719),f=r(5471),y=r(6527),v=r(5686),N=r(6233),j=r(3666),w=r(5565);let k=new Map;function C(e){let{productMasterId:t,storeProductId:r,currentQuantity:o,currentUnitId:n,onUnitChange:l}=e,[i,c]=(0,a.useState)(!1),[d,u]=(0,a.useState)(!0),[m,x]=(0,a.useState)([]),[p,h]=(0,a.useState)(null);if((0,a.useEffect)(()=>{(async()=>{if(k.has(t)){let e=k.get(t);e&&(x(e.units),h(e.baseUnit)),u(!1);return}try{var e;let r=await fetch("/api/pos/units?productMasterId=".concat(t));if(!r.ok)throw Error("Error");let s=await r.json();if(!s.enabled){k.set(t,null),u(!1);return}let a=s.baseUnit?{id:s.baseUnit.id,code:s.baseUnit.code,name:s.baseUnit.name,symbol:s.baseUnit.symbol||s.baseUnit.code,factor:1,allowsDecimals:null!==(e=s.baseUnit.allowDecimals)&&void 0!==e&&e,isBase:!0}:null,o=(s.availableUnits||[]).map(e=>{var t;return{id:e.id,code:e.code,name:e.name,symbol:e.symbol||e.code,factor:e.factor,allowsDecimals:null!==(t=e.allowsDecimals)&&void 0!==t&&t,isBase:!1}}),n=a?[a,...o]:o;k.set(t,{units:n,baseUnit:a}),x(n),h(a)}catch(e){k.set(t,null)}finally{u(!1)}})()},[t]),d||m.length<=1)return null;let f=m.find(e=>e.id===n)||p,y=e=>{c(!1);let t=o*e.factor;l(r,o,e.id,t,e.factor,e.code)};return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{onClick:()=>c(!i),className:"flex items-center gap-1 px-2 py-1 text-xs bg-indigo-50 dark:bg-indigo-950/30 text-indigo-700 dark:text-indigo-300 rounded hover:bg-indigo-100 dark:hover:bg-indigo-900/40 transition-colors",children:[(0,s.jsx)(g.A,{className:"w-3 h-3"}),(0,s.jsx)("span",{children:(null==f?void 0:f.symbol)||"UN"}),(0,s.jsx)(b.A,{className:"w-3 h-3"})]}),i&&(0,s.jsx)("div",{className:"absolute z-50 mt-1 left-0 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg min-w-[140px]",children:m.map(e=>(0,s.jsxs)("button",{onClick:()=>y(e),className:"w-full px-3 py-2 text-left text-xs flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 ".concat((null==f?void 0:f.id)===e.id?"bg-indigo-50 dark:bg-indigo-900/20 text-indigo-700 dark:text-indigo-300":"text-gray-700 dark:text-gray-300"),children:[(0,s.jsx)("span",{className:"font-medium",children:e.symbol}),(0,s.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:e.isBase?"(base)":"\xd7".concat(e.factor)})]},e.id))})]})}let P=(0,a.memo)(function(e){let{cart:t,onUpdateQuantity:r,onRemoveItem:a,onClearCart:o,onApplyDiscount:n,onFinalizeSale:l,appliedCoupon:c,onRemoveCoupon:m,processing:x,advancedUnitsEnabled:p=!1,onUpdateItemUnit:h}=e,b=t.reduce((e,t)=>e+Number(t.storeProduct.price)*t.quantity,0),k=t.reduce((e,t)=>{let r=Number(t.storeProduct.price)*t.quantity,s=0;return t.discountType&&t.discountValue&&("PERCENT"===t.discountType?s+=r*t.discountValue/100:s+=t.discountValue),t.promotionDiscount&&(s+=t.promotionDiscount),t.categoryPromoDiscount&&(s+=t.categoryPromoDiscount),t.volumePromoDiscount&&(s+=t.volumePromoDiscount),t.nthPromoDiscount&&(s+=t.nthPromoDiscount),e+s},0),P=(null==c?void 0:c.discount)||0,A=Math.max(0,b-k-P),S=t.reduce((e,t)=>e+t.quantity,0);return(0,s.jsxs)("div",{className:"hidden md:flex md:flex-col h-full w-96 bg-surface-light dark:bg-surface-dark border-l border-border-light dark:border-border-dark",children:[(0,s.jsxs)("div",{className:"px-6 py-4 border-b border-border-light dark:border-border-dark shrink-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-text-main dark:text-white",children:"Carrito"}),t.length>0&&(0,s.jsx)("button",{onClick:o,className:"text-sm text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 font-medium transition-colors",children:"Vaciar"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-text-secondary dark:text-gray-400",children:[(0,s.jsx)(i.A,{className:"w-4 h-4"}),(0,s.jsxs)("span",{children:[S," ",1===S?"producto":"productos"]})]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:0===t.length?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[(0,s.jsx)("div",{className:"w-20 h-20 rounded-full bg-background-light dark:bg-background-dark border-2 border-dashed border-border-light dark:border-border-dark flex items-center justify-center mb-4",children:(0,s.jsx)(i.A,{className:"w-10 h-10 text-text-secondary dark:text-gray-500"})}),(0,s.jsx)("p",{className:"text-sm font-semibold text-text-main dark:text-white mb-1",children:"Carrito vac\xedo"}),(0,s.jsx)("p",{className:"text-xs text-text-secondary dark:text-gray-400",children:"Selecciona productos para comenzar"})]}):(0,s.jsx)("div",{className:"space-y-3",children:t.map(e=>{var t,o;let l=Number(e.storeProduct.price)*e.quantity,c=l;e.discountType&&e.discountValue&&("PERCENT"===e.discountType?c-=l*e.discountValue/100:c-=e.discountValue),e.promotionDiscount&&(c-=e.promotionDiscount),e.categoryPromoDiscount&&(c-=e.categoryPromoDiscount),e.volumePromoDiscount&&(c-=e.volumePromoDiscount),e.nthPromoDiscount&&(c-=e.nthPromoDiscount);let u=e.discountType||e.promotionName||e.categoryPromoName||e.volumePromoName||e.nthPromoName||e.sellUnitPriceApplied;return(0,s.jsxs)("div",{className:"flex gap-3 p-3 rounded-lg bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark",children:[(0,s.jsx)("div",{className:"relative w-16 h-16 rounded-lg bg-surface-light dark:bg-surface-dark overflow-hidden flex-shrink-0",children:e.storeProduct.product.imageUrl?(0,s.jsx)(w.default,{src:e.storeProduct.product.imageUrl,alt:e.storeProduct.product.name,fill:!0,className:"object-cover"}):(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,s.jsx)(i.A,{className:"w-6 h-6 text-text-secondary/30 dark:text-gray-600"})})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("h3",{className:"font-semibold text-sm text-text-main dark:text-white line-clamp-2 mb-1",children:e.storeProduct.product.name}),e.storeProduct.product.brand&&(0,s.jsx)("p",{className:"text-xs text-text-secondary dark:text-gray-400 truncate mb-2",children:e.storeProduct.product.brand}),u&&(0,s.jsxs)("div",{className:"mb-2 space-y-1",children:[e.promotionName&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-xs text-purple-600 dark:text-purple-400 bg-purple-50 dark:bg-purple-950/30 px-2 py-0.5 rounded",children:[(0,s.jsx)(f.A,{className:"w-3 h-3"}),(0,s.jsx)("span",{className:"truncate",children:e.promotionName})]}),e.categoryPromoName&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-xs text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-950/30 px-2 py-0.5 rounded",children:[(0,s.jsx)(f.A,{className:"w-3 h-3"}),(0,s.jsx)("span",{className:"truncate",children:e.categoryPromoName})]}),e.volumePromoName&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-xs text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-950/30 px-2 py-0.5 rounded",children:[(0,s.jsx)(f.A,{className:"w-3 h-3"}),(0,s.jsx)("span",{className:"truncate",children:e.volumePromoName})]}),e.nthPromoName&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-xs text-pink-600 dark:text-pink-400 bg-pink-50 dark:bg-pink-950/30 px-2 py-0.5 rounded",children:[(0,s.jsx)(f.A,{className:"w-3 h-3"}),(0,s.jsx)("span",{className:"truncate",children:e.nthPromoName})]}),e.discountType&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-xs text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-950/30 px-2 py-0.5 rounded",children:[(0,s.jsx)(f.A,{className:"w-3 h-3"}),(0,s.jsxs)("span",{className:"truncate",children:["Desc: ","PERCENT"===e.discountType?"".concat(e.discountValue,"%"):(0,j.up)(e.discountValue||0)]})]}),e.sellUnitPriceApplied&&e.unitCodeUsed&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-xs text-green-700 dark:text-green-400 bg-green-50 dark:bg-green-950/30 px-2 py-0.5 rounded",children:[(0,s.jsx)(g.A,{className:"w-3 h-3"}),(0,s.jsxs)("span",{className:"truncate",children:["Precio ",e.unitCodeUsed,": ",(0,j.up)(e.sellUnitPriceApplied)]})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-surface-light dark:bg-surface-dark rounded-lg border border-border-light dark:border-border-dark",children:[(0,s.jsx)("button",{onClick:()=>r(e.storeProduct.id,-1),className:"p-1.5 hover:bg-background-light dark:hover:bg-background-dark rounded-l-lg transition-colors",children:(0,s.jsx)(y.A,{className:"w-4 h-4 text-text-secondary dark:text-gray-400"})}),(0,s.jsx)("span",{className:"px-2 text-sm font-semibold text-text-main dark:text-white min-w-[2rem] text-center",children:null!==(t=e.quantityOriginal)&&void 0!==t?t:e.quantity}),(0,s.jsx)("button",{onClick:()=>r(e.storeProduct.id,1),className:"p-1.5 hover:bg-background-light dark:hover:bg-background-dark rounded-r-lg transition-colors",children:(0,s.jsx)(d.A,{className:"w-4 h-4 text-text-secondary dark:text-gray-400"})})]}),p&&h&&(0,s.jsx)(C,{productMasterId:e.storeProduct.product.id,storeProductId:e.storeProduct.id,currentQuantity:null!==(o=e.quantityOriginal)&&void 0!==o?o:e.quantity,currentUnitId:e.unitIdUsed,onUnitChange:h}),(0,s.jsx)("button",{onClick:()=>a(e.storeProduct.id),className:"p-1.5 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/20 rounded-lg transition-colors",children:(0,s.jsx)(v.A,{className:"w-4 h-4"})})]}),p&&e.conversionFactorUsed&&1!==e.conversionFactorUsed&&(0,s.jsxs)("div",{className:"mt-1 flex items-center gap-1 text-xs text-indigo-600 dark:text-indigo-400 bg-indigo-50 dark:bg-indigo-950/30 px-2 py-1 rounded",children:[(0,s.jsx)(g.A,{className:"w-3 h-3"}),(0,s.jsxs)("span",{children:[e.quantityOriginal," ",e.unitCodeUsed||"UN"," → ",e.quantityBase," base"]})]}),(0,s.jsxs)("div",{className:"mt-2 text-right",children:[u&&(0,s.jsx)("p",{className:"text-xs text-text-secondary dark:text-gray-400 line-through",children:(0,j.up)(l)}),(0,s.jsx)("p",{className:"text-sm font-bold text-primary",children:(0,j.up)(c)})]}),!e.discountType&&(0,s.jsx)("button",{onClick:()=>n(e.storeProduct.id),className:"w-full mt-2 py-1.5 text-xs text-primary hover:bg-primary/10 rounded-lg transition-colors font-medium",children:"+ Aplicar descuento"})]})]},e.storeProduct.id)})})}),t.length>0&&(0,s.jsxs)("div",{className:"px-6 py-4 border-t border-border-light dark:border-border-dark space-y-4 shrink-0",children:[c&&(0,s.jsxs)("div",{className:"flex items-center justify-between bg-yellow-50 dark:bg-yellow-950/30 p-3 rounded-lg border border-yellow-200 dark:border-yellow-900/50",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(f.A,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-xs text-yellow-600 dark:text-yellow-400 font-medium",children:["Cup\xf3n: ",c.code]}),(0,s.jsxs)("p",{className:"text-sm font-semibold text-yellow-700 dark:text-yellow-300",children:["-",(0,j.up)(c.discount)]})]})]}),(0,s.jsx)("button",{onClick:m,className:"p-1.5 text-yellow-600 dark:text-yellow-400 hover:bg-yellow-100 dark:hover:bg-yellow-950/50 rounded transition-colors",children:(0,s.jsx)(u.A,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-text-secondary dark:text-gray-400",children:"Subtotal"}),(0,s.jsx)("span",{className:"font-semibold text-text-main dark:text-white",children:(0,j.up)(b)})]}),(k>0||P>0)&&(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-red-600 dark:text-red-400",children:"Descuentos"}),(0,s.jsxs)("span",{className:"font-semibold text-red-600 dark:text-red-400",children:["-",(0,j.up)(k+P)]})]}),(0,s.jsx)("div",{className:"h-px bg-border-light dark:bg-border-dark"}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-lg font-bold text-text-main dark:text-white",children:"Total"}),(0,s.jsx)("span",{className:"text-2xl font-bold text-primary",children:(0,j.up)(A)})]})]}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsx)("button",{onClick:l,disabled:x||0===t.length,className:"w-full h-12 bg-primary hover:bg-primary-hover text-white font-semibold rounded-xl shadow-sm hover:shadow-md transition-all duration-200 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:x?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),(0,s.jsx)("span",{children:"Procesando..."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(N.A,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"Cobrar"})]})})})]})]})});function A(e){let{isOpen:t,onClose:r,cart:a,onUpdateQuantity:o,onRemoveItem:n,onClearCart:l,onApplyDiscount:c,onFinalizeSale:m,appliedCoupon:x,onRemoveCoupon:p,processing:h,advancedUnitsEnabled:b=!1}=e,N=a.reduce((e,t)=>e+Number(t.storeProduct.price)*t.quantity,0),w=a.reduce((e,t)=>{let r=Number(t.storeProduct.price)*t.quantity,s=0;return t.discountType&&t.discountValue&&("PERCENT"===t.discountType?s+=r*t.discountValue/100:s+=t.discountValue),t.promotionDiscount&&(s+=t.promotionDiscount),t.categoryPromoDiscount&&(s+=t.categoryPromoDiscount),t.volumePromoDiscount&&(s+=t.volumePromoDiscount),t.nthPromoDiscount&&(s+=t.nthPromoDiscount),e+s},0),k=(null==x?void 0:x.discount)||0,C=Math.max(0,N-w-k);return(0,s.jsxs)(s.Fragment,{children:[t&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:r}),(0,s.jsxs)("div",{className:"\n          fixed bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-2xl z-50\n          transform transition-transform duration-300 ease-out\n          max-h-[85vh] flex flex-col\n          lg:hidden\n          ".concat(t?"translate-y-0":"translate-y-full","\n        "),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b sticky top-0 bg-white rounded-t-2xl",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(i.A,{className:"w-5 h-5 text-emerald-600"}),(0,s.jsxs)("h2",{className:"text-lg font-bold text-gray-900",children:["Carrito (",a.length,")"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[a.length>0&&(0,s.jsx)("button",{onClick:l,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors","aria-label":"Limpiar carrito",children:(0,s.jsx)(v.A,{className:"w-5 h-5"})}),(0,s.jsx)("button",{onClick:r,className:"p-2 text-gray-500 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Cerrar",children:(0,s.jsx)(u.A,{className:"w-5 h-5"})})]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:0===a.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(i.A,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-500",children:"Carrito vac\xedo"})]}):a.map(e=>{var t;let r=Number(e.storeProduct.price)*e.quantity,a=r;e.discountType&&e.discountValue&&("PERCENT"===e.discountType?a-=r*e.discountValue/100:a-=e.discountValue),e.promotionDiscount&&(a-=e.promotionDiscount),e.categoryPromoDiscount&&(a-=e.categoryPromoDiscount),e.volumePromoDiscount&&(a-=e.volumePromoDiscount),e.nthPromoDiscount&&(a-=e.nthPromoDiscount);let l=e.discountType||e.promotionName||e.categoryPromoName||e.volumePromoName||e.nthPromoName;return(0,s.jsxs)("div",{className:"bg-white border rounded-xl p-4 shadow-sm",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900 text-base leading-tight",children:e.storeProduct.product.name}),e.storeProduct.product.brand&&(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-0.5",children:e.storeProduct.product.brand}),(0,s.jsxs)("p",{className:"text-sm text-emerald-600 font-medium mt-1",children:[(0,j.up)(Number(e.storeProduct.price))," \xd7 ",e.quantity]})]}),(0,s.jsx)("button",{onClick:()=>n(e.storeProduct.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center","aria-label":"Eliminar",children:(0,s.jsx)(v.A,{className:"w-5 h-5"})})]}),l&&(0,s.jsxs)("div",{className:"mb-3 space-y-1",children:[e.promotionName&&(0,s.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-purple-600 bg-purple-50 px-2 py-1 rounded",children:[(0,s.jsx)(f.A,{className:"w-3.5 h-3.5"}),(0,s.jsx)("span",{children:e.promotionName})]}),e.categoryPromoName&&(0,s.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded",children:[(0,s.jsx)(f.A,{className:"w-3.5 h-3.5"}),(0,s.jsx)("span",{children:e.categoryPromoName})]}),e.volumePromoName&&(0,s.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-orange-600 bg-orange-50 px-2 py-1 rounded",children:[(0,s.jsx)(f.A,{className:"w-3.5 h-3.5"}),(0,s.jsx)("span",{children:e.volumePromoName})]}),e.nthPromoName&&(0,s.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-pink-600 bg-pink-50 px-2 py-1 rounded",children:[(0,s.jsx)(f.A,{className:"w-3.5 h-3.5"}),(0,s.jsx)("span",{children:e.nthPromoName})]}),e.discountType&&(0,s.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-red-600 bg-red-50 px-2 py-1 rounded",children:[(0,s.jsx)(f.A,{className:"w-3.5 h-3.5"}),(0,s.jsxs)("span",{children:["Desc. manual: ","PERCENT"===e.discountType?"".concat(e.discountValue,"%"):(0,j.up)(e.discountValue||0)]})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:()=>o(e.storeProduct.id,-1),className:"w-11 h-11 flex items-center justify-center bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors","aria-label":"Disminuir",children:(0,s.jsx)(y.A,{className:"w-5 h-5 text-gray-700"})}),(0,s.jsxs)("span",{className:"w-12 text-center font-semibold text-lg",children:[null!==(t=e.quantityOriginal)&&void 0!==t?t:e.quantity,e.unitCodeUsed&&b&&(0,s.jsx)("span",{className:"ml-1 text-xs text-gray-500",children:e.unitCodeUsed})]}),(0,s.jsx)("button",{onClick:()=>o(e.storeProduct.id,1),className:"w-11 h-11 flex items-center justify-center bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg transition-colors","aria-label":"Aumentar",children:(0,s.jsx)(d.A,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"text-right",children:[l&&(0,s.jsx)("p",{className:"text-xs text-gray-400 line-through",children:(0,j.up)(r)}),(0,s.jsx)("p",{className:"text-lg font-bold text-gray-900",children:(0,j.up)(a)})]})]}),b&&e.unitCodeUsed&&e.quantityBase!==e.quantityOriginal&&(0,s.jsxs)("div",{className:"mt-2 flex items-center gap-1 text-xs text-indigo-600 bg-indigo-50 px-2 py-1 rounded",children:[(0,s.jsx)(g.A,{className:"w-3 h-3"}),(0,s.jsxs)("span",{children:["→ ",e.quantityBase," ",e.storeProduct.product.unitType]})]}),!e.discountType&&(0,s.jsx)("button",{onClick:()=>c(e.storeProduct.id),className:"w-full mt-3 py-2 text-sm text-emerald-600 hover:bg-emerald-50 rounded-lg transition-colors",children:"+ Aplicar descuento"})]},e.storeProduct.id)})}),a.length>0&&(0,s.jsxs)("div",{className:"border-t bg-gray-50 p-4 space-y-3",children:[x&&(0,s.jsxs)("div",{className:"flex items-center justify-between bg-yellow-50 p-3 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(f.A,{className:"w-4 h-4 text-yellow-600"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-xs text-yellow-600 font-medium",children:["Cup\xf3n: ",x.code]}),(0,s.jsxs)("p",{className:"text-sm font-semibold text-yellow-700",children:["-",(0,j.up)(x.discount)]})]})]}),(0,s.jsx)("button",{onClick:p,className:"p-1.5 text-yellow-600 hover:bg-yellow-100 rounded transition-colors",children:(0,s.jsx)(u.A,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Subtotal:"}),(0,s.jsx)("span",{className:"font-medium",children:(0,j.up)(N)})]}),(w>0||k>0)&&(0,s.jsxs)("div",{className:"flex justify-between text-sm text-red-600",children:[(0,s.jsx)("span",{children:"Descuentos:"}),(0,s.jsxs)("span",{className:"font-medium",children:["-",(0,j.up)(w+k)]})]}),(0,s.jsxs)("div",{className:"flex justify-between text-lg font-bold pt-2 border-t",children:[(0,s.jsx)("span",{className:"text-gray-900",children:"Total:"}),(0,s.jsx)("span",{className:"text-emerald-600",children:(0,j.up)(C)})]})]}),(0,s.jsx)("button",{onClick:m,disabled:h||0===a.length,className:"w-full py-4 bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-bold rounded-xl transition-colors text-lg shadow-lg",children:h?"Procesando...":"Finalizar Venta"})]})]})]})}var S=r(739),E=r(4081);function T(e){let{userRole:t,paymentMethod:r,onChange:o}=e,[n,l]=(0,a.useState)(!1),[i,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(!0),[m,x]=(0,a.useState)(!1),[p,h]=(0,a.useState)("BOLETA"),[g,b]=(0,a.useState)("DNI"),[f,y]=(0,a.useState)(""),[v,N]=(0,a.useState)(""),[j,w]=(0,a.useState)(""),[k,C]=(0,a.useState)("");return((0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/sunat/settings/status");if(e.ok){let s=await e.json();if(l(s.enabled&&s.configured),s.enabled&&s.configured){let e=await fetch("/api/sunat/preferences");if(e.ok){let s=await e.json();c(s),s.autoEmitBoleta&&"FIADO"!==r&&(x(!0),h("BOLETA")),"BOLETA"===s.defaultDocType?(x(!0),h("BOLETA")):"FACTURA"===s.defaultDocType&&s.allowFactura&&"CASHIER"!==t&&(x(!0),h("FACTURA"))}}}}catch(e){console.error("Error checking SUNAT status:",e)}finally{u(!1)}})()},[r,t]),(0,a.useEffect)(()=>{if(m&&n){let e="FACTURA"===p?"RUC":g;o({enabled:!0,docType:p,customerDocType:e,customerDocNumber:f,customerName:v,customerAddress:j,customerEmail:k})}else o({enabled:!1,docType:null,customerDocType:"",customerDocNumber:"",customerName:""})},[m,p,g,f,v,j,k,n]),(0,a.useEffect)(()=>{"FACTURA"===p?b("RUC"):b("DNI")},[p]),"FIADO"!==r&&n)?d?(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Cargando..."}):(0,s.jsxs)("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-200",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",id:"wantComprobante",checked:m,onChange:e=>x(e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,s.jsxs)("label",{htmlFor:"wantComprobante",className:"text-sm font-medium text-blue-800 flex items-center gap-1.5",children:[(0,s.jsx)(S.A,{className:"w-4 h-4"}),"Comprobante SUNAT"]})]}),m&&(0,s.jsxs)("div",{className:"mt-3 space-y-2.5 pt-3 border-t border-blue-200",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)("button",{type:"button",onClick:()=>h("BOLETA"),className:"flex-1 px-2 py-1.5 text-xs rounded border font-medium ".concat("BOLETA"===p?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"),children:[(0,s.jsx)(S.A,{className:"w-3 h-3 inline mr-1"}),"BOLETA"]}),(0,s.jsxs)("button",{type:"button",onClick:()=>h("FACTURA"),disabled:"CASHIER"===t,className:"flex-1 px-2 py-1.5 text-xs rounded border font-medium ".concat("FACTURA"===p?"bg-blue-600 text-white border-blue-600":"CASHIER"===t?"bg-gray-100 text-gray-400 border-gray-300 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"),title:"CASHIER"===t?"Solo OWNER puede emitir FACTURA":"",children:[(0,s.jsx)(E.A,{className:"w-3 h-3 inline mr-1"}),"FACTURA"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-[10px] font-medium text-gray-600 mb-0.5",children:"FACTURA"===p?"RUC":"Tipo Doc"}),"FACTURA"===p?(0,s.jsx)("input",{type:"text",value:"RUC",disabled:!0,className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded bg-gray-100"}):(0,s.jsxs)("select",{value:g,onChange:e=>b(e.target.value),className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500",children:[(0,s.jsx)("option",{value:"DNI",children:"DNI"}),(0,s.jsx)("option",{value:"CE",children:"CE"}),(0,s.jsx)("option",{value:"PASAPORTE",children:"Pasaporte"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-[10px] font-medium text-gray-600 mb-0.5",children:"N\xfamero"}),(0,s.jsx)("input",{type:"text",value:f,onChange:e=>y(e.target.value),placeholder:"RUC"===g?"20123456789":"12345678",maxLength:"RUC"===g?11:"DNI"===g?8:20,className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-[10px] font-medium text-gray-600 mb-0.5",children:"FACTURA"===p?"Raz\xf3n Social":"Nombre"}),(0,s.jsx)("input",{type:"text",value:v,onChange:e=>N(e.target.value),placeholder:"FACTURA"===p?"EMPRESA S.A.C.":"Juan P\xe9rez",className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"})]}),"FACTURA"===p&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-[10px] font-medium text-gray-600 mb-0.5",children:["Direcci\xf3n ",(0,s.jsx)("span",{className:"text-gray-400",children:"(opcional)"})]}),(0,s.jsx)("input",{type:"text",value:j,onChange:e=>w(e.target.value),placeholder:"Av. Principal 123",className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"})]})]})]}):null}var R=r(814),D=r(6046),F=r(5273);function I(e){return e.quantity*e.storeProduct.price}function U(e){var t;return null!==(t=e.promotionDiscount)&&void 0!==t?t:0}function O(e){var t;return null!==(t=e.categoryPromoDiscount)&&void 0!==t?t:0}function M(e){var t,r;if(!e.discountType||!e.discountValue)return 0;let s=I(e),a=U(e),o=O(e),n=null!==(t=e.volumePromoDiscount)&&void 0!==t?t:0,l=null!==(r=e.nthPromoDiscount)&&void 0!==r?r:0;return"PERCENT"===e.discountType?Math.round((s-a-o-n-l)*e.discountValue/100*100)/100:e.discountValue}function V(e){return e.reduce((e,t)=>e+M(t),0)}function q(e,t,r){var s;return e.reduce((e,t)=>e+function(e){var t,r;let s=I(e),a=U(e),o=O(e);return s-a-o-(null!==(t=e.volumePromoDiscount)&&void 0!==t?t:0)-(null!==(r=e.nthPromoDiscount)&&void 0!==r?r:0)-M(e)}(t),0)-t-(null!==(s=null==r?void 0:r.discount)&&void 0!==s?s:0)}function L(){let[e,t]=(0,a.useState)(""),[r,p]=(0,a.useState)([]),[g,b]=(0,a.useState)([]),[f,y]=(0,a.useState)(!1),[v,N]=(0,a.useState)(!1),[w,k]=(0,a.useState)(null),[C,S]=(0,a.useState)(!1),[E,U]=(0,a.useState)(""),[O,M]=(0,a.useState)(!1),[L,B]=(0,a.useState)(null),[z,H]=(0,a.useState)(!1),[_,K]=(0,a.useState)("CASH"),[Q,Y]=(0,a.useState)(""),J=(0,a.useRef)(""),W=(0,a.useRef)(0),G=(0,a.useRef)(null),[$,X]=(0,a.useState)(null),[Z,ee]=(0,a.useState)(!1),[et,er]=(0,a.useState)(""),[es,ea]=(0,a.useState)([]),[eo,en]=(0,a.useState)(!1),[el,ei]=(0,a.useState)(!1),[ec,ed]=(0,a.useState)(""),[eu,em]=(0,a.useState)(""),[ex,ep]=(0,a.useState)(!1),[eh,eg]=(0,a.useState)(!1),eb=(0,a.useCallback)(()=>{try{G.current&&"closed"!==G.current.state||(G.current=new(window.AudioContext||window.webkitAudioContext));let e=G.current;"suspended"===e.state&&e.resume();let t=e.createOscillator(),r=e.createGain();t.connect(r),r.connect(e.destination),t.frequency.setValueAtTime(1200,e.currentTime),t.frequency.exponentialRampToValueAtTime(1400,e.currentTime+.04),t.type="sine",r.gain.setValueAtTime(0,e.currentTime),r.gain.linearRampToValueAtTime(.15,e.currentTime+.01),r.gain.exponentialRampToValueAtTime(.01,e.currentTime+.04),t.start(e.currentTime),t.stop(e.currentTime+.04)}catch(e){console.warn("No se pudo reproducir el sonido:",e)}},[]),[ef,ey]=(0,a.useState)(null),[ev,eN]=(0,a.useState)(!1),[ej,ew]=(0,a.useState)(!1),[ek,eC]=(0,a.useState)(null),[eP,eA]=(0,a.useState)("PERCENT"),[eS,eE]=(0,a.useState)(""),[eT,eR]=(0,a.useState)(0),[eD,eF]=(0,a.useState)(!1),[eI,eU]=(0,a.useState)("PERCENT"),[eO,eM]=(0,a.useState)(""),[eV,eq]=(0,a.useState)(null),[eL,eB]=(0,a.useState)("CASHIER"),[ez,eH]=(0,a.useState)(""),[e_,eK]=(0,a.useState)(null),[eQ,eY]=(0,a.useState)(!1),eJ=(0,a.useRef)(null),[eW,eG]=(0,a.useState)(0),[e$,eX]=(0,a.useState)(!1),{isOn:eZ,isLoading:e0}=(0,F.D0)(),e1=eZ("ENABLE_ADVANCED_UNITS");eZ("ENABLE_CONVERSIONS");let e2=eZ("ENABLE_SERVICES"),[e5,e4]=(0,a.useState)([]),[e3,e6]=(0,a.useState)(!1),[e7,e8]=(0,a.useState)("products"),e9=(0,a.useCallback)(async()=>{if(e2)try{e6(!0);let e=await fetch("/api/services?active=true");if(e.ok){let t=await e.json();e4(t.services||[])}}catch(e){console.error("Error loading services:",e)}finally{e6(!1)}},[e2]),te=(0,a.useCallback)(e=>{let t={id:"service-".concat(e.id),price:Number(e.price),stock:null,active:!0,product:{id:e.id,name:e.name,brand:null,content:"(Servicio)",category:"Servicio",unitType:"UNIT",barcode:null,internalSku:"SRV-".concat(e.id.slice(-6)),imageUrl:null}};b(r=>{let s=r.findIndex(t=>{var r;return t.isService&&(null===(r=t.service)||void 0===r?void 0:r.id)===e.id});return s>=0?r.map((e,t)=>t===s?{...e,quantity:e.quantity+1}:e):[...r,{storeProduct:t,quantity:1,isService:!0,service:e}]}),R.oR.success('Servicio "'.concat(e.name,'" agregado'))},[]),tt=(0,a.useCallback)((e,t,r,s,a,o)=>{b(n=>n.map(n=>n.storeProduct.id!==e?n:{...n,quantity:s,quantityOriginal:t,quantityBase:s,unitIdUsed:r,unitCodeUsed:o,conversionFactorUsed:a}))},[]);!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(0,D.usePathname)(),{enabled:s=!0,isCheckoutModalOpen:o=!1,hasOpenShift:n=!1}=t,l=(0,a.useRef)(0);(0,a.useEffect)(()=>{if(!s||"/pos"!==r)return;let t=t=>{["F1","F2","F4","F5","F6","F7","F8"].includes(t.key)&&t.preventDefault();let r=t.target,s=r instanceof HTMLInputElement,a=r instanceof HTMLTextAreaElement,l=r.isContentEditable;if(s||a||l){"Enter"===t.key&&s&&"product-search"===r.id&&(t.preventDefault(),e.addFirstSearchResult());return}if(o){switch(t.key){case"Escape":e.closeModal();break;case"F5":e.selectCash();break;case"F6":e.selectYape();break;case"F7":e.selectPlin();break;case"F8":e.selectCard()}return}switch(t.key){case"F1":e.focusSearch();break;case"+":case"=":t.preventDefault(),e.incrementSelectedItem();break;case"-":case"_":t.preventDefault(),e.decrementSelectedItem();break;case"Delete":t.preventDefault(),e.removeSelectedItem();break;case"F2":e.focusCart();break;case"F4":n&&e.openCheckout();break;case"Escape":e.closeModal()}};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[r,s,o,n,e]),l.current,e=>{l.current=e}}({focusSearch:()=>{var e;null===(e=eJ.current)||void 0===e||e.focus()},addFirstSearchResult:()=>{r.length>0&&(tm(r[0]),p([]),t(""))},incrementSelectedItem:()=>{if(g.length>0&&g[eW]){let e=g[eW];tp(e.storeProduct.id,e.quantity+1)}},decrementSelectedItem:()=>{if(g.length>0&&g[eW]){let e=g[eW];tp(e.storeProduct.id,Math.max(0,e.quantity-1))}},removeSelectedItem:()=>{g.length>0&&g[eW]&&(th(g[eW].storeProduct.id),eW>=g.length-1&&eG(Math.max(0,g.length-2)))},focusCart:()=>{g.length>0&&(eG(0),R.oR.info("\xcdtem seleccionado: ".concat(g[0].storeProduct.product.name)))},openCheckout:()=>{g.length>0&&w&&tf()},closeModal:()=>{H(!1),ee(!1),ew(!1),eF(!1),ei(!1)},selectCash:()=>{K("CASH")},selectYape:()=>{K("YAPE")},selectPlin:()=>{K("PLIN")},selectCard:()=>{K("CARD")}},{enabled:!0,isCheckoutModalOpen:z,hasOpenShift:!!w}),function(e){let{onFocusSearch:t,onFinalizeSale:r,onClearCart:s,onAddQuickSell:o,onEscape:n,enabled:l=!0}=e,i=(0,a.useRef)(l);(0,a.useEffect)(()=>{i.current=l},[l]),(0,a.useEffect)(()=>{let e=()=>window.innerWidth>=1024,a=e=>{let t=e.target,r=t.tagName.toLowerCase();return"input"===r||"textarea"===r||"true"===t.contentEditable},l=l=>{if(i.current&&e())try{if("F2"===l.key){l.preventDefault(),null==t||t();return}if("Escape"===l.key){l.preventDefault(),null==n||n();return}if(a(l))return;if(l.ctrlKey&&"Enter"===l.key){l.preventDefault(),null==r||r();return}if(l.ctrlKey&&"Backspace"===l.key){l.preventDefault(),null==s||s();return}if(/^[1-9]$/.test(l.key)&&!l.ctrlKey&&!l.altKey&&!l.metaKey){l.preventDefault();let e=parseInt(l.key,10)-1;null==o||o(e);return}}catch(e){console.error("[usePosHotkeys] Error handling keydown:",e)}};return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l)}},[t,r,s,o,n])}({onFocusSearch:()=>{var e;return null===(e=eJ.current)||void 0===e?void 0:e.focus()},onFinalizeSale:()=>{g.length>0&&w&&tf()},onClearCart:()=>{g.length>0&&tg()},onEscape:()=>{H(!1),ee(!1),ew(!1),eF(!1),ei(!1),eX(!1)},enabled:!0}),(0,a.useEffect)(()=>{tn(),ts(),ta(),to(),tr()},[]),(0,a.useEffect)(()=>{e2&&!e0&&e9()},[e2,e0,e9]),(0,a.useEffect)(()=>{let e=async e=>{let t=e.target;if(!("INPUT"===t.tagName||"TEXTAREA"===t.tagName||["Shift","Control","Alt","Tab","Escape","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key))){if("Enter"===e.key&&J.current.length>=8){let e=J.current;try{let t=await fetch("/api/store-products?barcode=".concat(encodeURIComponent(e)));if(t.ok){let r=await t.json();r.products&&r.products.length>0?(tm(r.products[0]),R.oR.success("Producto escaneado: ".concat(r.products[0].product.name))):R.oR.error("C\xf3digo no encontrado: ".concat(e))}}catch(e){console.error("Error searching barcode:",e),R.oR.error("Error al buscar producto")}J.current="";return}if(/^\d$/.test(e.key)){let t=Date.now();t-W.current>100?J.current=e.key:J.current+=e.key,W.current=t}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);let tr=async()=>{try{let t=await fetch("/api/store");if(t.ok){var e;let r=await t.json();eN((null===(e=r.store)||void 0===e?void 0:e.is_demo_store)||!1)}}catch(e){console.error("Error checking demo mode:",e)}},ts=async()=>{try{let e=await fetch("/api/auth/is-superadmin");if(e.ok){let t=await e.json();eg(t.isSuperAdmin)}}catch(e){console.error("Error checking superadmin:",e)}},ta=async()=>{try{let e=await fetch("/api/auth/me");if(e.ok){let t=await e.json();eB(t.user.role)}}catch(e){console.error("Error fetching user role:",e)}},to=async()=>{try{let e=await fetch("/api/admin/operational-limits");if(e.ok){let t=await e.json();ey(t.limits)}}catch(e){console.error("Error fetching operational limits:",e)}},tn=async()=>{try{let e=await fetch("/api/shifts/current"),t=await e.json();k(t.shift)}catch(e){console.error("Error fetching shift:",e)}},tl=async()=>{let e=parseFloat(E);if(isNaN(e)||e<0){R.oR.error("Ingresa un monto v\xe1lido");return}try{let t=await fetch("/api/shifts/open",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({openingCash:e})});if(!t.ok){let e=await t.json();R.oR.error(e.message);return}R.oR.success("Turno abierto correctamente"),S(!1),U(""),tn()}catch(e){R.oR.error("Error al abrir turno")}};(0,a.useEffect)(()=>{let t=setTimeout(()=>{e.trim().length>=2?ti():0===e.trim().length&&p([])},300);return()=>clearTimeout(t)},[e]);let ti=async()=>{if(!e.trim()){p([]);return}y(!0);try{let t=await fetch("/api/inventory?query=".concat(encodeURIComponent(e),"&active=true")),r=await t.json();p(r.products||[])}catch(e){console.error("Error searching products:",e),R.oR.error("Error al buscar productos")}finally{y(!1)}},tc=()=>{ti()},td=async e=>{try{var t,r,s,a,o,n,l,i,c,d,u,m,x,p,h,g,b,f,y,v,N,j,w,k,C,P;let A=await fetch("/api/promotions/check-all",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:e.storeProduct.product.id,productCategory:e.storeProduct.product.category,quantity:e.quantity,unitPrice:e.storeProduct.price,unitType:e.storeProduct.product.unitType})});if(!A.ok)return e;let S=await A.json();return{...e,promotionType:null!==(p=null===(t=S.promotion)||void 0===t?void 0:t.promotionType)&&void 0!==p?p:null,promotionName:null!==(h=null===(r=S.promotion)||void 0===r?void 0:r.promotionName)&&void 0!==h?h:null,promotionDiscount:null!==(g=null===(s=S.promotion)||void 0===s?void 0:s.promotionDiscount)&&void 0!==g?g:0,categoryPromoName:null!==(b=null===(a=S.categoryPromotion)||void 0===a?void 0:a.categoryPromoName)&&void 0!==b?b:null,categoryPromoType:null!==(f=null===(o=S.categoryPromotion)||void 0===o?void 0:o.categoryPromoType)&&void 0!==f?f:null,categoryPromoDiscount:null!==(y=null===(n=S.categoryPromotion)||void 0===n?void 0:n.categoryPromoDiscount)&&void 0!==y?y:0,volumePromoName:null!==(v=null===(l=S.volumePromotion)||void 0===l?void 0:l.volumePromoName)&&void 0!==v?v:null,volumePromoQty:null!==(N=null===(i=S.volumePromotion)||void 0===i?void 0:i.volumePromoQty)&&void 0!==N?N:null,volumePromoDiscount:null!==(j=null===(c=S.volumePromotion)||void 0===c?void 0:c.volumePromoDiscount)&&void 0!==j?j:0,nthPromoName:null!==(w=null===(d=S.nthPromotion)||void 0===d?void 0:d.nthPromoName)&&void 0!==w?w:null,nthPromoQty:null!==(k=null===(u=S.nthPromotion)||void 0===u?void 0:u.nthPromoQty)&&void 0!==k?k:null,nthPromoPercent:null!==(C=null===(m=S.nthPromotion)||void 0===m?void 0:m.nthPromoPercent)&&void 0!==C?C:null,nthPromoDiscount:null!==(P=null===(x=S.nthPromotion)||void 0===x?void 0:x.nthPromoDiscount)&&void 0!==P?P:0}}catch(t){return console.error("Error checking all promotions:",t),e}},tu=async e=>{let t=r.find(t=>t.product.id===e);if(t){await tm(t);return}try{let t=await fetch("/api/inventory?productId=".concat(e));if(!t.ok)throw Error("Error al cargar producto");let r=await t.json();r.length>0&&await tm(r[0])}catch(e){R.oR.error("Error al agregar producto")}},tm=async e=>{if(null!==e.stock&&e.stock<=0){R.oR.error("".concat(e.product.name,": sin stock disponible"));return}let t=g.find(t=>t.storeProduct.id===e.id);if(t)eb(),await tp(e.id,t.quantity+1);else{if((null==ef?void 0:ef.maxItemsPerSale)!==null&&(null==ef?void 0:ef.maxItemsPerSale)!==void 0&&g.reduce((e,t)=>e+t.quantity,0)>=ef.maxItemsPerSale){R.oR.error("No puedes agregar m\xe1s items. L\xedmite m\xe1ximo: ".concat(ef.maxItemsPerSale," items por venta"));return}let t={storeProduct:e,quantity:1};b(e=>[...e,t]),eb(),R.oR.success("".concat(e.product.name," agregado al carrito")),null!==e.stock&&e.stock<=5&&R.oR.warning("Advertencia: Solo quedan ".concat(e.stock," unidades"),{duration:3e3}),td(t).then(t=>{b(r=>r.map(r=>r.storeProduct.id===e.id?t:r));let r=[];t.promotionName&&r.push("Promo: ".concat(t.promotionName)),t.categoryPromoName&&r.push("Cat: ".concat(t.categoryPromoName)),t.volumePromoName&&r.push("Pack: ".concat(t.volumePromoName)),t.nthPromoName&&r.push("Nth: ".concat(t.nthPromoName)),r.length>0&&R.oR.success("\uD83C\uDF89 ".concat(r.join(" + ")," aplicado!"),{duration:2e3})}).catch(e=>{console.error("Error checking promotions:",e)})}},tx=(0,a.useRef)(null),tp=async(e,t)=>{let r=g.find(t=>t.storeProduct.id===e);if(r){if("UNIT"===r.storeProduct.product.unitType&&!Number.isInteger(t)){R.oR.error("Cantidad debe ser entera para productos por unidad");return}if(t<=0){th(e);return}if((null==ef?void 0:ef.maxItemsPerSale)!==null&&(null==ef?void 0:ef.maxItemsPerSale)!==void 0&&g.reduce((t,r)=>r.storeProduct.id===e?t:t+r.quantity,0)+t>ef.maxItemsPerSale){R.oR.error("No puedes agregar m\xe1s items. L\xedmite m\xe1ximo: ".concat(ef.maxItemsPerSale," items por venta"));return}if(null!==r.storeProduct.stock){if(r.storeProduct.stock<=0){R.oR.error("".concat(r.storeProduct.product.name,": sin stock disponible"));return}if(t>r.storeProduct.stock){R.oR.error("Stock insuficiente (disponible: ".concat(r.storeProduct.stock,")"));return}}b(r=>r.map(r=>r.storeProduct.id===e?{...r,quantity:t}:r)),tx.current&&clearTimeout(tx.current),tx.current=setTimeout(async()=>{let s={...r,quantity:t},a=await td(s);b(t=>t.map(t=>t.storeProduct.id===e?a:t))},300)}},th=e=>{b(g.filter(t=>t.storeProduct.id!==e))},tg=()=>{b([]),eR(0),eK(null),eH(""),N(!1)},tb=()=>{eK(null),eH(""),R.oR.success("Cup\xf3n eliminado")},tf=async()=>{if(0===g.length){R.oR.error("El carrito est\xe1 vac\xedo");return}w||R.oR.warning("No hay turno abierto. Solo puedes vender FIADO."),K(w?"CASH":"FIADO"),Y(""),X(null),H(!0)},ty=e=>{var t;let r=g.find(t=>t.storeProduct.id===e);r&&(eC(e),eA(r.discountType||"PERCENT"),eE((null===(t=r.discountValue)||void 0===t?void 0:t.toString())||""),ew(!0))},tv=()=>{if(!ek)return;let e=parseFloat(eS);if(isNaN(e)||e<=0){R.oR.error("Ingresa un valor v\xe1lido");return}let t=g.find(e=>e.storeProduct.id===ek);if(!t)return;let r=I(t);if("PERCENT"===eP){if(e>100){R.oR.error("El porcentaje no puede ser mayor a 100%");return}if((null==ef?void 0:ef.maxDiscountPercent)!==null&&(null==ef?void 0:ef.maxDiscountPercent)!==void 0&&e>ef.maxDiscountPercent){R.oR.error("El descuento porcentual (".concat(e,"%) excede el l\xedmite permitido (").concat(ef.maxDiscountPercent,"%)"));return}}else if("AMOUNT"===eP){if(e>r){R.oR.error("El descuento no puede ser mayor al subtotal del \xedtem");return}if((null==ef?void 0:ef.maxManualDiscountAmount)!==null&&(null==ef?void 0:ef.maxManualDiscountAmount)!==void 0){let t=g.reduce((e,t)=>t.storeProduct.id!==ek&&t.discountType&&t.discountValue?"AMOUNT"===t.discountType?e+t.discountValue:"PERCENT"===t.discountType?e+Math.round(I(t)*t.discountValue/100*100)/100:e:e,0)+eT+e;if(t>ef.maxManualDiscountAmount){R.oR.error("Descuentos manuales totales (S/ ".concat(t.toFixed(2),") exceder\xedan el l\xedmite permitido (S/ ").concat(ef.maxManualDiscountAmount.toFixed(2),")"));return}}}b(g.map(t=>t.storeProduct.id===ek?{...t,discountType:eP,discountValue:e}:t)),R.oR.success("Descuento aplicado"),ew(!1),eC(null),eE("")},tN=async e=>{if(!e.trim()){ea([]);return}try{en(!0);let t=await fetch("/api/customers?search=".concat(encodeURIComponent(e),"&activeOnly=true"));if(!t.ok)throw Error("Error al buscar clientes");let r=await t.json();ea(r.customers)}catch(e){console.error("Error searching customers:",e),R.oR.error("Error al buscar clientes")}finally{en(!1)}},tj=async()=>{if(!ec.trim()){R.oR.error("El nombre es obligatorio");return}try{ep(!0);let e=await fetch("/api/customers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:ec,phone:eu||null})});if(!e.ok){let t=await e.json();throw Error(t.message)}let t=await e.json();R.oR.success("Cliente creado exitosamente"),X({id:t.customer.id,name:t.customer.name,phone:t.customer.phone,totalBalance:0}),ei(!1),ee(!1),ed(""),em("")}catch(e){console.error("Error creating customer:",e),R.oR.error(e.message||"Error al crear cliente")}finally{ep(!1)}},tw=async()=>{if("undefined"!=typeof navigator&&!navigator.onLine){R.oR.error("Sin conexi\xf3n a internet",{description:"No puedes procesar ventas sin conexi\xf3n. Verifica tu conexi\xf3n e intenta nuevamente.",duration:5e3});return}let e=q(g,eT,e_);if("CASH"===_){let t=parseFloat(Q);if(isNaN(t)||t<=0){R.oR.error("Ingresa un monto v\xe1lido");return}if(Math.round(100*t)/100<Math.round(100*e)/100){R.oR.error("El monto pagado es menor al total");return}}else if("FIADO"===_){if(!$){R.oR.error("Debes seleccionar un cliente para ventas FIADO");return}}else if(!w){R.oR.error("Debes abrir un turno para este m\xe9todo de pago");return}N(!0),H(!1);try{let e="checkout-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),r={items:g.map(e=>{var t;return e.isService&&e.service?{isService:!0,serviceId:e.service.id,serviceName:e.service.name,quantity:e.quantity,unitPrice:Number(e.service.price)}:{storeProductId:e.storeProduct.id,quantity:null!==(t=e.quantityBase)&&void 0!==t?t:e.quantity,unitPrice:e.storeProduct.price,discountType:e.discountType,discountValue:e.discountValue,saleUnitId:e.unitIdUsed}}),paymentMethod:_,discountTotal:eT>0?eT:void 0,couponCode:null==e_?void 0:e_.code};"CASH"===_&&(r.amountPaid=parseFloat(Q)),"FIADO"===_&&(r.customerId=$.id);let s=await fetch("/api/sales/checkout",{method:"POST",headers:{"Content-Type":"application/json","Idempotency-Key":e},body:JSON.stringify(r)}),a=await s.json();if(429===s.status){R.oR.error("Demasiadas solicitudes",{description:"Espera unos segundos antes de intentar nuevamente",duration:5e3}),N(!1);return}if(409===s.status&&"CHECKOUT_IN_PROGRESS"===a.code){R.oR.error("Operaci\xf3n en proceso",{description:"Ya tienes una venta en proceso. Espera a que termine.",duration:5e3}),N(!1);return}if(!s.ok){if("INSUFFICIENT_STOCK"===a.code&&a.details){let{productName:e,available:t,requested:r}=a.details;R.oR.error("".concat(e,": stock insuficiente"),{description:"Disponible: ".concat(t," | Solicitado: ").concat(r),duration:5e3})}else"INVALID_QUANTITY"===a.code&&a.details?R.oR.error(a.message,{description:a.details.productName,duration:4e3}):R.oR.error(a.message||"Error al procesar venta");N(!1);return}if("IDEMPOTENT_REPLAY"===a.code?R.oR.warning("Venta ya procesada",{description:"Esta venta ya fue registrada (Total: S/ ".concat(a.total.toFixed(2),")"),duration:5e3}):"FIADO"===_?R.oR.success("\xa1Venta FIADO registrada!",{description:"Cliente: ".concat($.name," - Total: S/ ").concat(a.total.toFixed(2)),duration:5e3}):R.oR.success("\xa1Venta completada! Total: S/ ".concat(a.total.toFixed(2))),eV&&eV.enabled&&eV.docType)try{let e=await fetch("/api/sunat/emit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({saleId:a.saleId,docType:eV.docType,customerDocType:eV.customerDocType,customerDocNumber:eV.customerDocNumber,customerName:eV.customerName,customerAddress:eV.customerAddress,customerEmail:eV.customerEmail})}),t=await e.json();e.ok?R.oR.success("Comprobante ".concat(eV.docType," encolado para SUNAT"),{description:"N\xfamero: ".concat(t.document.fullNumber),duration:4e3}):R.oR.warning("Venta guardada, pero error al emitir comprobante",{description:t.error||"Puedes emitirlo desde el historial",duration:5e3})}catch(e){console.error("Error emitting SUNAT:",e),R.oR.warning("Venta guardada, pero no se pudo emitir comprobante",{description:"Emite el comprobante desde el historial de ventas",duration:5e3})}B({id:a.saleId,total:a.total}),M(!0),fetch("/api/sales/".concat(a.saleId)).catch(()=>{}),tg(),p([]),t(""),X(null),eq(null)}catch(e){console.error("Checkout error:",e),navigator.onLine?R.oR.error("Error de conexi\xf3n",{description:"No se pudo contactar al servidor. Intenta nuevamente.",duration:4e3}):R.oR.error("Sin conexi\xf3n a internet",{description:"No se pudo procesar la venta. Verifica tu conexi\xf3n e intenta nuevamente.",duration:5e3}),N(!1)}finally{}};return(0,s.jsxs)(m.A,{storeName:"Punto de Venta",children:[(0,s.jsx)(x.A,{}),(0,s.jsx)(R.l$,{position:"top-right",richColors:!0}),eh&&(0,s.jsxs)("a",{href:"/admin/backups",className:"fixed bottom-6 right-6 z-50 bg-purple-600 text-white px-4 py-3 rounded-full shadow-lg hover:bg-purple-700 transition-colors flex items-center gap-2 font-medium",children:[(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"})}),"Admin Backups"]}),(0,s.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:["          ",!w&&(0,s.jsxs)("div",{className:"mb-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(o.A,{className:"w-5 h-5 text-yellow-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-yellow-800",children:"Debes abrir turno para vender"}),(0,s.jsx)("p",{className:"text-sm text-yellow-700",children:"Las ventas requieren un turno activo"})]})]}),(0,s.jsx)("button",{onClick:()=>S(!0),className:"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 font-medium",children:"Abrir Turno"})]}),w&&(0,s.jsxs)("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-3 flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-green-600 rounded-full animate-pulse"}),(0,s.jsxs)("p",{className:"text-sm text-green-800",children:[(0,s.jsx)("span",{className:"font-medium",children:"Turno abierto"})," • ","Caja inicial ",(0,j.up)(w.openingCash)]})]}),ev&&(0,s.jsxs)("div",{className:"mb-6 bg-yellow-100 border-2 border-yellow-500 rounded-lg p-4 flex items-center justify-center gap-3 shadow-lg",children:[(0,s.jsx)(n.A,{className:"w-6 h-6 text-yellow-700"}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xl font-extrabold text-yellow-900 tracking-wider",children:"DEMO MODE ACTIVO"}),(0,s.jsx)("p",{className:"text-sm text-yellow-700 font-medium mt-1",children:"Datos ficticios para demostraci\xf3n"})]}),(0,s.jsx)(n.A,{className:"w-6 h-6 text-yellow-700"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 min-h-[calc(100vh-200px)]",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"mb-3 hidden lg:flex items-center gap-3 text-xs text-gray-500",children:[(0,s.jsx)("span",{className:"px-2 py-1 bg-gray-100 rounded border border-gray-200 font-mono",children:"F2"}),(0,s.jsx)("span",{children:"Buscar"}),(0,s.jsx)("span",{className:"px-2 py-1 bg-gray-100 rounded border border-gray-200 font-mono",children:"Ctrl+Enter"}),(0,s.jsx)("span",{children:"Finalizar"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)("div",{className:"flex-1 relative",children:[(0,s.jsx)(l.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,s.jsx)("input",{ref:eJ,id:"product-search",type:"text",placeholder:"Buscar producto por nombre, c\xf3digo...",value:e,onChange:e=>t(e.target.value),onKeyDown:e=>"Enter"===e.key&&tc(),className:"w-full h-12 md:h-14 pl-10 pr-4 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#16A34A] text-base md:text-sm",style:{fontSize:"16px"}})]}),(0,s.jsx)("button",{onClick:tc,disabled:f,className:"h-12 md:h-14 px-4 md:px-6 bg-[#16A34A] text-white rounded-md font-medium hover:bg-[#15803d] disabled:opacity-50 disabled:cursor-not-allowed transition-colors touch-manipulation",children:f?"Buscando...":"Buscar"})]})]}),e2&&w&&!e.trim()&&(0,s.jsxs)("div",{className:"flex gap-2 bg-white border border-gray-200 rounded-lg p-2",children:[(0,s.jsxs)("button",{onClick:()=>e8("products"),className:"flex-1 flex items-center justify-center gap-2 py-2 px-4 rounded-md font-medium transition-colors ".concat("products"===e7?"bg-emerald-100 text-emerald-700":"text-gray-600 hover:bg-gray-100"),children:[(0,s.jsx)(i.A,{className:"w-4 h-4"}),"Productos"]}),(0,s.jsxs)("button",{onClick:()=>e8("services"),className:"flex-1 flex items-center justify-center gap-2 py-2 px-4 rounded-md font-medium transition-colors ".concat("services"===e7?"bg-indigo-100 text-indigo-700":"text-gray-600 hover:bg-gray-100"),children:[(0,s.jsx)(c.A,{className:"w-4 h-4"}),"Servicios",e5.length>0&&(0,s.jsx)("span",{className:"text-xs bg-indigo-600 text-white px-1.5 py-0.5 rounded-full",children:e5.length})]})]}),w&&!e.trim()&&"products"===e7&&(0,s.jsx)(h,{onAddProduct:tu,disabled:!w}),e2&&w&&!e.trim()&&"services"===e7&&(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[(0,s.jsx)("div",{className:"px-4 py-3 bg-indigo-50 border-b border-indigo-200",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("h3",{className:"text-sm font-medium text-indigo-900 flex items-center gap-2",children:[(0,s.jsx)(c.A,{className:"w-4 h-4"}),"Servicios disponibles (",e5.length,")"]}),(0,s.jsx)("button",{onClick:e9,disabled:e3,className:"text-xs text-indigo-600 hover:text-indigo-800",children:e3?"Cargando...":"Actualizar"})]})}),0===e5.length?(0,s.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,s.jsx)(c.A,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),(0,s.jsx)("p",{children:"No hay servicios configurados"}),(0,s.jsx)("p",{className:"text-xs mt-1",children:"Crea servicios en Inventario > Servicios"})]}):(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 p-4",children:e5.map(e=>(0,s.jsxs)("button",{onClick:()=>te(e),className:"flex flex-col items-center justify-center p-4 bg-indigo-50 hover:bg-indigo-100 border border-indigo-200 rounded-lg transition-colors group",children:[(0,s.jsx)(c.A,{className:"w-8 h-8 text-indigo-600 mb-2 group-hover:scale-110 transition-transform"}),(0,s.jsx)("span",{className:"text-sm font-medium text-indigo-900 text-center line-clamp-2",children:e.name}),(0,s.jsx)("span",{className:"text-lg font-bold text-indigo-700 mt-1",children:(0,j.up)(Number(e.price))})]},e.id))})]}),r.length>0&&(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[(0,s.jsx)("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200",children:(0,s.jsxs)("h3",{className:"text-sm font-medium text-[#1F2A37]",children:["Resultados de b\xfasqueda (",r.length,")"]})}),(0,s.jsx)("div",{className:"divide-y divide-gray-200",children:r.map(e=>(0,s.jsxs)("div",{className:"p-4 hover:bg-gray-50 transition-colors flex items-center gap-3",children:[e.product.imageUrl?(0,s.jsx)("img",{src:e.product.imageUrl,alt:e.product.name,className:"w-16 h-16 object-cover rounded border border-gray-200 flex-shrink-0"}):(0,s.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded border border-gray-200 flex items-center justify-center flex-shrink-0",children:(0,s.jsx)(i.A,{className:"w-6 h-6 text-gray-400"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"font-medium text-[#1F2A37]",children:[e.product.name,e.product.brand&&(0,s.jsxs)("span",{className:"ml-2 text-sm text-gray-500",children:["• ",e.product.brand]}),e.product.content&&(0,s.jsxs)("span",{className:"ml-2 text-sm text-gray-500",children:["• ",e.product.content]})]}),(0,s.jsxs)("div",{className:"mt-1 text-sm text-gray-500",children:[e.product.barcode||e.product.internalSku,null!==e.stock&&(0,s.jsxs)("span",{className:"ml-3 font-medium ".concat(e.stock<=0?"text-red-600":e.stock<=5?"text-orange-600":""),children:["Stock: ",e.stock,e.stock<=0&&" (Sin stock)",e.stock>0&&e.stock<=5&&" (Bajo)"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("div",{className:"text-lg font-semibold text-[#16A34A]",children:["S/ ",e.price.toFixed(2)]}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"UNIT"===e.product.unitType?"por unidad":"por kg"})]}),(0,s.jsxs)("button",{onClick:()=>tm(e),disabled:null!==e.stock&&e.stock<=0,className:"h-10 px-4 bg-[#16A34A] text-white rounded-md text-sm font-medium hover:bg-[#15803d] disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[(0,s.jsx)(d.A,{className:"w-4 h-4"}),null!==e.stock&&e.stock<=0?"Sin stock":"Agregar"]})]})]},e.id))})]}),!f&&e&&0===r.length&&(0,s.jsx)("div",{className:"text-center py-12 text-[#6B7280]",children:"No se encontraron productos"})]}),(0,s.jsx)("div",{className:"lg:col-span-1 h-full",children:(0,s.jsx)(P,{cart:g,onUpdateQuantity:(e,t)=>{let r=g.find(t=>t.storeProduct.id===e);r&&tp(e,r.quantity+t)},onRemoveItem:th,onClearCart:tg,onApplyDiscount:ty,onFinalizeSale:tf,appliedCoupon:e_?{code:e_.code,discount:e_.discount}:null,onRemoveCoupon:tb,processing:v,advancedUnitsEnabled:e1,onUpdateItemUnit:tt})})]}),g.length>0&&(0,s.jsxs)("button",{onClick:()=>eX(!0),className:"md:hidden fixed bottom-6 right-6 z-30 bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-4 rounded-full shadow-2xl flex items-center gap-3 font-semibold transition-all active:scale-95",children:[(0,s.jsx)(i.A,{className:"w-6 h-6"}),(0,s.jsxs)("span",{children:["Carrito (",g.length,")"]}),(0,s.jsxs)("span",{className:"text-emerald-100",children:["• ",(0,j.up)(q(g,eT,e_))]})]}),(0,s.jsx)(A,{isOpen:e$,onClose:()=>eX(!1),cart:g,onUpdateQuantity:(e,t)=>{let r=g.find(t=>t.storeProduct.id===e);r&&tp(e,r.quantity+t)},onRemoveItem:th,onClearCart:()=>{tg(),eX(!1)},onApplyDiscount:e=>{ty(e),eX(!1)},onFinalizeSale:()=>{eX(!1),tf()},appliedCoupon:e_?{code:e_.code,discount:e_.discount}:null,onRemoveCoupon:()=>{tb(),eX(!1)},processing:v,advancedUnitsEnabled:e1})]})}),z&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-md max-h-[95vh] flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b flex-shrink-0",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"M\xe9todo de Pago"}),(0,s.jsx)("button",{onClick:()=>H(!1),className:"text-gray-400 hover:text-gray-600 p-1",children:(0,s.jsx)(u.A,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[(0,s.jsxs)("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-3 border border-green-200",children:[(0,s.jsx)("div",{className:"text-xs text-green-700 mb-0.5",children:"Total a pagar"}),(0,s.jsx)("div",{className:"text-2xl font-bold text-green-800",children:(0,j.up)(q(g,eT,e_))})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"M\xe9todo"}),(0,s.jsxs)("div",{className:"flex items-center gap-1 text-[10px] text-gray-400",children:[(0,s.jsx)("span",{className:"px-1.5 py-0.5 bg-gray-100 rounded font-mono",children:"F5-F8"}),(0,s.jsx)("span",{children:"atajos"})]})]}),(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2",children:[{value:"CASH",label:"Efectivo",icon:"\uD83D\uDCB5"},{value:"YAPE",label:"Yape",icon:"\uD83D\uDCF1"},{value:"PLIN",label:"Plin",icon:"\uD83D\uDCF2"},{value:"CARD",label:"Tarjeta",icon:"\uD83D\uDCB3"},{value:"FIADO",label:"Fiado",icon:"\uD83D\uDCDD"}].map(e=>(0,s.jsxs)("button",{onClick:()=>{K(e.value),"CASH"!==e.value&&Y(""),"FIADO"===e.value&&X(null)},disabled:!w&&"FIADO"!==e.value,className:"py-2 px-2 rounded-lg border-2 text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed ".concat(_===e.value?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:[(0,s.jsx)("span",{className:"text-base",children:e.icon}),(0,s.jsx)("div",{className:"text-xs mt-0.5",children:e.label})]},e.value))})]}),"CASH"===_&&(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Pag\xf3 con (S/)"}),(0,s.jsx)("input",{type:"number",step:"0.01",value:Q,onChange:e=>Y(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00",autoFocus:!0,onKeyDown:e=>"Enter"===e.key&&tw()}),Q&&parseFloat(Q)>=q(g,eT,e_)&&(0,s.jsxs)("div",{className:"mt-2 p-2 bg-green-100 border border-green-300 rounded-lg flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-green-700",children:"Vuelto:"}),(0,s.jsx)("span",{className:"text-xl font-bold text-green-700",children:(0,j.up)(parseFloat(Q)-q(g,eT,e_))})]}),Q&&(()=>{let e=Math.round(100*q(g,eT,e_))/100,t=Math.round(100*parseFloat(Q))/100;return t<e&&t>0})()&&(0,s.jsx)("div",{className:"mt-2 text-xs text-red-600",children:"⚠️ Monto insuficiente"})]}),"CASH"!==_&&"FIADO"!==_&&(0,s.jsx)("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-blue-800",children:["✓ Pago con ",(0,s.jsx)("strong",{children:_})]})}),"FIADO"===_&&(0,s.jsxs)("div",{className:"bg-orange-50 rounded-lg p-3 border border-orange-200",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Cliente ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),$?(0,s.jsxs)("div",{className:"flex justify-between items-center bg-white p-2 rounded border",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium text-gray-900 text-sm",children:$.name}),$.totalBalance>0&&(0,s.jsxs)("div",{className:"text-xs text-red-600",children:["Deuda: S/ ",$.totalBalance.toFixed(2)]})]}),(0,s.jsx)("button",{onClick:()=>X(null),className:"text-red-600 hover:text-red-700 text-xs",children:"Cambiar"})]}):(0,s.jsx)("button",{onClick:()=>{er(""),ea([]),ee(!0)},className:"w-full py-2 px-3 border-2 border-dashed border-orange-300 rounded-lg text-orange-600 hover:border-orange-400 text-sm",children:"+ Seleccionar Cliente"})]}),(0,s.jsx)(T,{userRole:eL,paymentMethod:_,onChange:e=>eq(e)})]}),(0,s.jsxs)("div",{className:"flex gap-3 p-4 border-t flex-shrink-0 bg-gray-50",children:[(0,s.jsx)("button",{onClick:()=>H(!1),className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-100 text-sm",children:"Cancelar"}),(0,s.jsx)("button",{onClick:tw,disabled:v,className:"flex-1 px-4 py-2.5 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:v?"Procesando...":"✓ Confirmar"})]})]})}),C&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Abrir Turno"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Caja inicial (S/)"}),(0,s.jsx)("input",{type:"number",step:"0.01",value:E,onChange:e=>U(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00",autoFocus:!0,onKeyDown:e=>"Enter"===e.key&&tl()})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>{S(!1),U("")},className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancelar"}),(0,s.jsx)("button",{onClick:tl,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Abrir Turno"})]})]})]})}),O&&L&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[(0,s.jsxs)("div",{className:"text-center mb-6",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,s.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"\xa1Venta Completada!"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-green-600",children:(0,j.up)(L.total)})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("button",{onClick:async()=>{var e;let t=null===(e=window)||void 0===e?void 0:e.desktop;if((null==t?void 0:t.isDesktop)&&(null==t?void 0:t.escpos))try{let e=await t.escpos.getConfig();console.log("[POS] ESC/POS config:",e);let r="ESCPOS_NET"===e.mode&&e.netHost,s="ESCPOS_USB"===e.mode&&e.vendorId;if(r||s){R.oR.info("Enviando a impresora...");let e=await t.escpos.printSale(L.id);e.success?R.oR.success("Ticket impreso correctamente"):(R.oR.error(e.error||"Error al imprimir"),window.open("/receipt/".concat(L.id),"_blank"));return}console.log("[POS] ESC/POS not configured, mode:",e.mode),R.oR.info("Abriendo vista previa (configure impresora en Ajustes)")}catch(e){console.error("[POS] ESC/POS print error:",e),R.oR.error("Error de impresi\xf3n ESC/POS")}window.open("/receipt/".concat(L.id),"_blank")},className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"Imprimir Ticket"]}),(0,s.jsx)("button",{onClick:()=>{M(!1),B(null)},className:"w-full px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium",children:"Nueva Venta"})]})]})}),Z&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-md max-h-[80vh] flex flex-col",children:[(0,s.jsxs)("div",{className:"p-4 border-b",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"Seleccionar Cliente"}),(0,s.jsx)("input",{type:"text",value:et,onChange:e=>{er(e.target.value),tN(e.target.value)},placeholder:"Buscar por nombre, tel\xe9fono...",className:"w-full px-3 py-2 border rounded-lg",autoFocus:!0})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:eo?(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:"Buscando..."}):es.length>0?(0,s.jsx)("div",{className:"space-y-2",children:es.map(e=>(0,s.jsxs)("button",{onClick:()=>{if((null==ef?void 0:ef.maxReceivableBalance)!==null&&(null==ef?void 0:ef.maxReceivableBalance)!==void 0){let t=q(g,eT,e_),r=e.totalBalance+t;if(r>ef.maxReceivableBalance){R.oR.error("No se puede procesar. Balance resultante (S/ ".concat(r.toFixed(2),") exceder\xeda el l\xedmite permitido (S/ ").concat(ef.maxReceivableBalance.toFixed(2),")"));return}}X(e),ee(!1)},className:"w-full text-left p-3 border rounded-lg hover:bg-gray-50 transition-colors",children:[(0,s.jsx)("div",{className:"font-medium",children:e.name}),e.phone&&(0,s.jsx)("div",{className:"text-sm text-gray-600",children:e.phone}),e.totalBalance>0&&(0,s.jsxs)("div",{className:"text-sm text-red-600 mt-1",children:["Deuda: S/ ",e.totalBalance.toFixed(2)]})]},e.id))}):et?(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No se encontraron clientes"}):(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:"Escribe para buscar clientes"})}),(0,s.jsxs)("div",{className:"p-4 border-t space-y-2",children:[(0,s.jsx)("button",{onClick:()=>{ee(!1),ei(!0)},className:"w-full py-2 px-4 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"+ Crear Nuevo Cliente"}),(0,s.jsx)("button",{onClick:()=>ee(!1),className:"w-full py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancelar"})]})]})}),el&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-md p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Nuevo Cliente"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Nombre ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:ec,onChange:e=>ed(e.target.value),className:"w-full px-3 py-2 border rounded-lg",autoFocus:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tel\xe9fono"}),(0,s.jsx)("input",{type:"text",value:eu,onChange:e=>em(e.target.value),className:"w-full px-3 py-2 border rounded-lg"})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,s.jsx)("button",{onClick:()=>{ei(!1),ee(!0),ed(""),em("")},className:"flex-1 py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50",disabled:ex,children:"Cancelar"}),(0,s.jsx)("button",{onClick:tj,className:"flex-1 py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",disabled:ex,children:ex?"Creando...":"Crear"})]})]})}),ej&&ek&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-md p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Aplicar Descuento"}),(0,s.jsx)("button",{onClick:()=>{ew(!1),eC(null),eE("")},className:"text-gray-400 hover:text-gray-600",children:(0,s.jsx)(u.A,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de descuento"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsx)("button",{onClick:()=>eA("PERCENT"),className:"py-2 px-4 rounded-lg border-2 font-medium transition-colors ".concat("PERCENT"===eP?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:"Porcentaje (%)"}),(0,s.jsx)("button",{onClick:()=>eA("AMOUNT"),className:"py-2 px-4 rounded-lg border-2 font-medium transition-colors ".concat("AMOUNT"===eP?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-700 hover:border-gray-300"),children:"Monto fijo (S/)"})]})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PERCENT"===eP?"Porcentaje (0-100%)":"Monto (S/)"}),(0,s.jsx)("input",{type:"number",step:"0.01",value:eS,onChange:e=>eE(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00",autoFocus:!0,onKeyDown:e=>"Enter"===e.key&&tv()})]}),eS&&parseFloat(eS)>0&&ek&&(()=>{let e=g.find(e=>e.storeProduct.id===ek);if(!e)return null;let t=I(e),r=0;r="PERCENT"===eP?Math.round(t*parseFloat(eS)/100*100)/100:parseFloat(eS);let a=t-r;return(0,s.jsxs)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,s.jsx)("div",{className:"text-sm text-blue-700 mb-1",children:"Vista previa"}),(0,s.jsxs)("div",{className:"text-xs text-blue-600 space-y-1",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"Subtotal:"}),(0,s.jsxs)("span",{children:["S/ ",t.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between font-medium",children:[(0,s.jsx)("span",{children:"Descuento:"}),(0,s.jsxs)("span",{children:["-S/ ",r.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between font-bold text-blue-700 pt-1 border-t border-blue-300",children:[(0,s.jsx)("span",{children:"Total:"}),(0,s.jsxs)("span",{children:["S/ ",a.toFixed(2)]})]})]})]})})(),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:()=>{ew(!1),eC(null),eE("")},className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50",children:"Cancelar"}),(0,s.jsx)("button",{onClick:tv,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700",children:"Aplicar"})]})]})}),eD&&(()=>{let e=g.reduce((e,t)=>e+I(t),0)-V(g),t=()=>{let t;let r=parseFloat(eO);if(isNaN(r)||r<=0){R.oR.error("Ingresa un valor v\xe1lido");return}if("PERCENT"===eI){if(r>100){R.oR.error("El porcentaje no puede ser mayor a 100%");return}t=e*r/100}else t=r;if(t>e){R.oR.error("El descuento excede el total disponible");return}if((null==ef?void 0:ef.maxManualDiscountAmount)!==null&&(null==ef?void 0:ef.maxManualDiscountAmount)!==void 0){let e=V(g)+t;if(e>ef.maxManualDiscountAmount){R.oR.error("Descuentos manuales totales (S/ ".concat(e.toFixed(2),") exceder\xedan el l\xedmite permitido (S/ ").concat(ef.maxManualDiscountAmount.toFixed(2),")"));return}}eR(t),eF(!1),eM(""),R.oR.success("Descuento global aplicado")};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Descuento Global"}),(0,s.jsx)("button",{onClick:()=>{eF(!1),eM("")},className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-3",children:(0,s.jsxs)("p",{className:"text-sm text-orange-800",children:[(0,s.jsx)("span",{className:"font-medium",children:"M\xe1ximo disponible:"})," S/ ",e.toFixed(2)]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de descuento"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>{eU("PERCENT"),eM("")},className:"flex-1 py-2 px-4 rounded-lg font-medium transition-colors ".concat("PERCENT"===eI?"bg-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Porcentaje (%)"}),(0,s.jsx)("button",{onClick:()=>{eU("AMOUNT"),eM("")},className:"flex-1 py-2 px-4 rounded-lg font-medium transition-colors ".concat("AMOUNT"===eI?"bg-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Monto fijo (S/)"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PERCENT"===eI?"Porcentaje (0-100%)":"Monto del descuento (S/)"}),(0,s.jsx)("input",{type:"number",value:eO,onChange:e=>eM(e.target.value),onKeyDown:e=>{"Enter"===e.key&&t()},placeholder:"0.00",step:"PERCENT"===eI?"1":"0.01",min:"0",max:"PERCENT"===eI?100:e,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-lg",autoFocus:!0})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Este descuento se aplicar\xe1 al total de la venta despu\xe9s de los descuentos por \xedtem."})]}),(0,s.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,s.jsx)("button",{onClick:()=>{eF(!1),eM("")},className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50",children:"Cancelar"}),(0,s.jsx)("button",{onClick:t,className:"flex-1 px-4 py-3 bg-orange-600 text-white rounded-lg font-medium hover:bg-orange-700",children:"Aplicar"})]})]})})})})()]})}},8761:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var s=r(5155),a=r(2115),o=r(6046),n=r(1594),l=r(9053),i=r(767);function c(){let e=(0,o.useRouter)(),[t,r]=(0,a.useState)(!1),[c,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{u()},[]);let u=async()=>{try{let e=await fetch("/api/settings/onboarding");if(!e.ok){d(!1);return}let t=await e.json(),s=!t.completedAt&&!t.dismissedAt;r(s)}catch(e){console.error("Error checking onboarding status:",e)}finally{d(!1)}},m=async()=>{try{await fetch("/api/settings/onboarding",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({dismissed:!0})}),r(!1)}catch(e){console.error("Error dismissing banner:",e)}};return c||!t?null:(0,s.jsx)("div",{className:"bg-yellow-50 border-b border-yellow-200 print:hidden",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,s.jsx)(n.A,{className:"w-5 h-5 text-yellow-600 flex-shrink-0"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-yellow-900",children:"Configuraci\xf3n inicial pendiente"}),(0,s.jsx)("p",{className:"text-xs text-yellow-700 mt-0.5",children:"Completa la configuraci\xf3n de tu tienda para empezar a vender (menos de 30 minutos)"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("button",{onClick:()=>{e.push("/onboarding")},className:"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 font-medium text-sm flex items-center gap-2 whitespace-nowrap",children:["Continuar configuraci\xf3n",(0,s.jsx)(l.A,{className:"w-4 h-4"})]}),(0,s.jsx)("button",{onClick:m,className:"p-2 text-yellow-600 hover:text-yellow-800 hover:bg-yellow-100 rounded-lg",title:"Recordarme despu\xe9s",children:(0,s.jsx)(i.A,{className:"w-5 h-5"})})]})]})})})}},5273:(e,t,r)=>{"use strict";r.d(t,{D0:()=>i}),r(5155);var s=r(2115);let a={flags:{},isLoading:!1,error:null,lastFetched:null},o=new Set;function n(){o.forEach(e=>e())}async function l(){let e=await fetch("/api/flags",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error al cargar feature flags");let t=await e.json(),r={};return Array.isArray(t.flags)&&t.flags.forEach(e=>{r[e.key]=e.enabled}),r}function i(){let[,e]=(0,s.useState)({});(0,s.useEffect)(()=>{let t=()=>e({});return o.add(t),()=>{o.delete(t)}},[]),(0,s.useEffect)(()=>{(!a.lastFetched||Date.now()-a.lastFetched>3e5)&&!a.isLoading&&t()},[]);let t=(0,s.useCallback)(async()=>{if(!a.isLoading){a={...a,isLoading:!0,error:null},n();try{a={flags:await l(),isLoading:!1,error:null,lastFetched:Date.now()}}catch(e){a={...a,isLoading:!1,error:e instanceof Error?e.message:"Error desconocido"}}n()}},[]),r=(0,s.useCallback)(e=>{var t;return null!==(t=a.flags[e])&&void 0!==t&&t},[]),i=(0,s.useCallback)(e=>!r(e),[r]),c=(0,s.useCallback)(async()=>{a={...a,lastFetched:null},await t()},[t]);return{isOn:r,isOff:i,isLoading:a.isLoading,error:a.error,refetch:c,allFlags:a.flags}}},3666:(e,t,r)=>{"use strict";function s(e){if(null==e||isNaN(e))return"S/ 0.00";let t="string"==typeof e?parseFloat(e):e;return"S/ ".concat(t.toFixed(2))}r.d(t,{up:()=>s})}},e=>{var t=t=>e(e.s=t);e.O(0,[814,8173,9121,4110,9445,8441,1517,7358],()=>t(464)),_N_E=e.O()}]);