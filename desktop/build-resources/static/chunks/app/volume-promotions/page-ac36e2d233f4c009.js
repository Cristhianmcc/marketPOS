(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4578],{5321:(e,r,a)=>{Promise.resolve().then(a.bind(a,8233))},3473:(e,r,a)=>{"use strict";a.d(r,{A:()=>s});let s=(0,a(7401).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},8233:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>m});var s=a(5155),t=a(2115),o=a(6046),n=a(9445),l=a(719),c=a(3473),i=a(767),d=a(814);function m(){(0,o.useRouter)();let[e,r]=(0,t.useState)([]),[a,m]=(0,t.useState)([]),[x,u]=(0,t.useState)(!0),[p,g]=(0,t.useState)(!1),[h,y]=(0,t.useState)(!1),[b,j]=(0,t.useState)(null),[f,v]=(0,t.useState)(!1),[N,w]=(0,t.useState)(null),[k,A]=(0,t.useState)({name:"",productId:"",requiredQty:3,packPrice:"",startsAt:"",endsAt:""});(0,t.useEffect)(()=>{E(),C()},[]);let E=async()=>{try{let e=await fetch("/api/volume-promotions");if(!e.ok)throw Error("Error al cargar promociones");let a=await e.json();r(a.volumePromotions||[])}catch(e){console.error(e),d.oR.error("Error al cargar promociones por volumen")}finally{u(!1)}},C=async()=>{try{let e=await fetch("/api/products");if(!e.ok)throw Error("Error al cargar productos");let r=await e.json();m((r.products||[]).filter(e=>"UNIT"===e.unitType))}catch(e){console.error(e),d.oR.error("Error al cargar productos")}},P=async e=>{if(e.preventDefault(),!k.name.trim()){d.oR.error("Ingresa un nombre para la promoci\xf3n");return}if(!k.productId){d.oR.error("Selecciona un producto");return}if(k.requiredQty<2){d.oR.error("La cantidad requerida debe ser al menos 2");return}let r=parseFloat(k.packPrice);if(isNaN(r)||r<=0){d.oR.error("Ingresa un precio v\xe1lido para el pack");return}y(!0);try{let e=await fetch("/api/volume-promotions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:k.name.trim(),productId:k.productId,requiredQty:k.requiredQty,packPrice:r,startsAt:k.startsAt||null,endsAt:k.endsAt||null})});if(!e.ok){let r=await e.json();throw Error(r.message||"Error al crear promoci\xf3n")}d.oR.success("Promoci\xf3n por volumen creada"),g(!1),A({name:"",productId:"",requiredQty:3,packPrice:"",startsAt:"",endsAt:""}),E()}catch(e){d.oR.error(e.message||"Error al crear promoci\xf3n")}finally{y(!1)}},S=e=>{w(e),v(!0)},q=()=>{w(null),v(!1)},I=async e=>{j(e);try{let r=await fetch("/api/volume-promotions/".concat(e),{method:"DELETE"});if(!r.ok){let e=await r.json();throw Error(e.message||"Error al eliminar")}d.oR.success("Promoci\xf3n eliminada"),E()}catch(e){d.oR.error(e.message||"Error al eliminar promoci\xf3n")}finally{j(null),q()}},R=async(e,r)=>{try{if(!(await fetch("/api/volume-promotions/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({active:!r})})).ok)throw Error("Error al actualizar");d.oR.success(r?"Promoci\xf3n desactivada":"Promoci\xf3n activada"),E()}catch(e){d.oR.error("Error al actualizar promoci\xf3n")}},D=e=>{if(!e.active)return{text:"Inactiva",color:"text-gray-500"};let r=new Date;return e.startsAt&&r<new Date(e.startsAt)?{text:"Programada",color:"text-blue-600"}:e.endsAt&&r>new Date(e.endsAt)?{text:"Expirada",color:"text-red-600"}:{text:"Activa",color:"text-green-600"}};return x?(0,s.jsx)(n.A,{children:(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)("div",{className:"text-gray-500",children:"Cargando..."})})}):(0,s.jsxs)(n.A,{children:[(0,s.jsx)(d.l$,{position:"top-right",richColors:!0}),(0,s.jsxs)("div",{className:"container mx-auto px-4 py-6 max-w-6xl",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[(0,s.jsx)(l.A,{className:"w-7 h-7"}),"Promociones por Volumen"]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:'Ej: "3 unidades por S/ 5.00" - Solo productos UNIT'})]}),(0,s.jsxs)("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:[(0,s.jsx)(c.A,{className:"w-5 h-5"}),"Nueva Promoci\xf3n"]})]}),0===e.length?(0,s.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[(0,s.jsx)(l.A,{className:"w-16 h-16 mx-auto text-gray-400 mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"No hay promociones por volumen"}),(0,s.jsx)("button",{onClick:()=>g(!0),className:"mt-4 text-orange-600 hover:text-orange-700 font-medium",children:"Crear la primera promoci\xf3n"})]}):(0,s.jsx)("div",{className:"grid gap-4",children:e.map(e=>{let r=D(e);return(0,s.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),(0,s.jsx)("span",{className:"text-sm font-medium ".concat(r.color),children:r.text})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Producto:"}),(0,s.jsxs)("p",{className:"font-medium text-gray-900",children:[e.product.name,e.product.barcode&&(0,s.jsxs)("span",{className:"text-gray-500 ml-2",children:["(",e.product.barcode,")"]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Pack:"}),(0,s.jsxs)("p",{className:"font-medium text-gray-900",children:[e.requiredQty," unidades por S/ ",Number(e.packPrice).toFixed(2)]})]}),(e.startsAt||e.endsAt)&&(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Vigencia:"}),(0,s.jsxs)("p",{className:"font-medium text-gray-900",children:[e.startsAt?new Date(e.startsAt).toLocaleDateString("es-PE"):"---"," â†’ ",e.endsAt?new Date(e.endsAt).toLocaleDateString("es-PE"):"---"]})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>R(e.id,e.active),className:"px-3 py-1.5 text-sm rounded ".concat(e.active?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.active?"Activa":"Inactiva"}),(0,s.jsx)("button",{onClick:()=>S(e),disabled:b===e.id,className:"p-2 text-red-600 hover:bg-red-50 rounded transition-colors disabled:opacity-50",children:(0,s.jsx)(i.A,{className:"w-5 h-5"})})]})]})},e.id)})}),p&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Nueva Promoci\xf3n por Volumen"}),(0,s.jsx)("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-600",children:(0,s.jsx)(i.A,{className:"w-6 h-6"})})]}),(0,s.jsxs)("form",{onSubmit:P,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre de la promoci\xf3n *"}),(0,s.jsx)("input",{type:"text",value:k.name,onChange:e=>A({...k,name:e.target.value}),placeholder:"Ej: Pack 3x5",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Producto (solo UNIT) *"}),(0,s.jsxs)("select",{value:k.productId,onChange:e=>A({...k,productId:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",required:!0,children:[(0,s.jsx)("option",{value:"",children:"Seleccionar producto..."}),a.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," ",e.barcode&&"(".concat(e.barcode,")")]},e.id))]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cantidad requerida *"}),(0,s.jsx)("input",{type:"number",value:k.requiredQty,onChange:e=>A({...k,requiredQty:parseInt(e.target.value)||0}),min:"2",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio del pack (S/) *"}),(0,s.jsx)("input",{type:"number",step:"0.01",value:k.packPrice,onChange:e=>A({...k,packPrice:e.target.value}),placeholder:"0.00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",required:!0})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha inicio (opcional)"}),(0,s.jsx)("input",{type:"date",value:k.startsAt,onChange:e=>A({...k,startsAt:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha fin (opcional)"}),(0,s.jsx)("input",{type:"date",value:k.endsAt,onChange:e=>A({...k,endsAt:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>g(!1),className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),(0,s.jsx)("button",{type:"submit",disabled:h,className:"flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50",children:h?"Creando...":"Crear Promoci\xf3n"})]})]})]})})}),f&&N&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Confirmar Eliminaci\xf3n"}),(0,s.jsx)("button",{onClick:q,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"\xbfEst\xe1s seguro de que deseas eliminar esta promoci\xf3n?"}),(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Nombre:"}),(0,s.jsx)("p",{className:"font-medium text-gray-900",children:N.name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Producto:"}),(0,s.jsx)("p",{className:"font-medium text-gray-900",children:N.product.name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Pack:"}),(0,s.jsxs)("p",{className:"font-medium text-gray-900",children:[N.requiredQty," x S/ ",Number(N.packPrice).toFixed(2)]})]})]}),(0,s.jsx)("p",{className:"text-sm text-red-600",children:"Esta acci\xf3n no se puede deshacer."})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{type:"button",onClick:q,className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),(0,s.jsx)("button",{type:"button",onClick:()=>I(N.id),className:"flex-1 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Eliminar"})]})]})})})]})]})}}},e=>{var r=r=>e(e.s=r);e.O(0,[814,8173,9121,9445,8441,1517,7358],()=>r(5321)),_N_E=e.O()}]);