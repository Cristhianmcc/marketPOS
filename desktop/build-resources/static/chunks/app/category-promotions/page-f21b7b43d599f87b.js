(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4304],{8879:(e,r,t)=>{Promise.resolve().then(t.bind(t,3275))},2423:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(7401).A)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},3473:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(7401).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},3275:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>x});var a=t(5155),s=t(2115),o=t(6046),l=t(9445),c=t(5471),n=t(3473),i=t(767),d=t(2423),m=t(814);function x(){(0,o.useRouter)();let[e,r]=(0,s.useState)([]),[t,x]=(0,s.useState)(!0),[p,u]=(0,s.useState)(!1),[g,h]=(0,s.useState)(!1),[y,b]=(0,s.useState)(null),[j,f]=(0,s.useState)(!1),[N,v]=(0,s.useState)(null),[w,C]=(0,s.useState)([]),[E,k]=(0,s.useState)(!1),[A,P]=(0,s.useState)({name:"",category:"",type:"PERCENT",value:"",startsAt:"",endsAt:"",maxDiscountPerItem:""});(0,s.useEffect)(()=>{D(),S()},[]);let D=async()=>{try{let e=await fetch("/api/category-promotions");if(e.ok){let t=await e.json();r(t.categoryPromotions||[])}}catch(e){console.error("Error fetching category promotions:",e),m.oR.error("Error al cargar promociones por categor\xeda")}finally{x(!1)}},S=async()=>{k(!0);try{let e=await fetch("/api/products");if(e.ok){let r=await e.json(),t=[...new Set(r.products.map(e=>e.category))].filter(Boolean);C(t.sort())}}catch(e){console.error("Error fetching categories:",e)}finally{k(!1)}},R=async e=>{if(e.preventDefault(),!A.name||!A.category||!A.value){m.oR.error("Completa los campos requeridos");return}let r=parseFloat(A.value);if(isNaN(r)||r<=0){m.oR.error("Valor inv\xe1lido");return}if("PERCENT"===A.type&&r>100){m.oR.error("El porcentaje no puede ser mayor a 100");return}h(!0);try{let e={name:A.name,category:A.category,type:A.type,value:r};if(A.startsAt&&(e.startsAt=A.startsAt),A.endsAt&&(e.endsAt=A.endsAt),A.maxDiscountPerItem){let r=parseFloat(A.maxDiscountPerItem);!isNaN(r)&&r>0&&(e.maxDiscountPerItem=r)}let t=await fetch("/api/category-promotions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();t.ok?(m.oR.success("Promoci\xf3n por categor\xeda creada"),u(!1),P({name:"",category:"",type:"PERCENT",value:"",startsAt:"",endsAt:"",maxDiscountPerItem:""}),D()):m.oR.error(a.message||"Error al crear promoci\xf3n")}catch(e){console.error("Error creating category promotion:",e),m.oR.error("Error al crear promoci\xf3n por categor\xeda")}finally{h(!1)}},T=async(e,r)=>{try{let t=await fetch("/api/category-promotions/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({active:!r})});if(t.ok)m.oR.success(r?"Promoci\xf3n desactivada":"Promoci\xf3n activada"),D();else{let e=await t.json();m.oR.error(e.message||"Error al actualizar promoci\xf3n")}}catch(e){console.error("Error toggling category promotion:",e),m.oR.error("Error al actualizar promoci\xf3n")}},I=async e=>{b(e);try{let r=await fetch("/api/category-promotions/".concat(e),{method:"DELETE"});if(r.ok)m.oR.success("Promoci\xf3n eliminada"),D();else{let e=await r.json();m.oR.error(e.message||"Error al eliminar promoci\xf3n")}}catch(e){console.error("Error deleting category promotion:",e),m.oR.error("Error al eliminar promoci\xf3n")}finally{b(null),f(!1),v(null)}},M=e=>{v(e),f(!0)},F=()=>{f(!1),v(null)},L=e=>{if(!e.active)return{label:"Inactiva",color:"gray"};let r=new Date;return e.startsAt&&new Date(e.startsAt)>r?{label:"Pendiente",color:"yellow"}:e.endsAt&&new Date(e.endsAt)<r?{label:"Expirada",color:"red"}:{label:"Activa",color:"green"}};return(0,a.jsxs)(l.A,{children:[(0,a.jsx)(m.l$,{position:"top-right"}),(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-3 bg-purple-100 rounded-lg",children:(0,a.jsx)(c.A,{className:"w-6 h-6 text-purple-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Promociones por Categor\xeda"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"Descuentos autom\xe1ticos por categor\xeda de producto"})]})]}),(0,a.jsxs)("button",{onClick:()=>u(!0),className:"flex items-center gap-2 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[(0,a.jsx)(n.A,{className:"w-5 h-5"}),"Nueva Promoci\xf3n"]})]}),t?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})}):0===e.length?(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[(0,a.jsx)(c.A,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No hay promociones por categor\xeda"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Crea tu primera promoci\xf3n autom\xe1tica por categor\xeda"}),(0,a.jsx)("button",{onClick:()=>u(!0),className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Crear Promoci\xf3n"})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>{let r=L(e);return(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border-2 transition-all ".concat(e.active?"border-purple-200":"border-gray-200 opacity-75"),children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-1",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-purple-600 font-medium",children:["Categor\xeda: ",e.category]})]}),(0,a.jsx)("button",{onClick:()=>M(e),disabled:y===e.id,className:"text-red-600 hover:text-red-700 disabled:opacity-50",children:(0,a.jsx)(i.A,{className:"w-5 h-5"})})]}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat("green"===r.color?"bg-green-100 text-green-800":"yellow"===r.color?"bg-yellow-100 text-yellow-800":"red"===r.color?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:r.label})}),(0,a.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Descuento:"}),(0,a.jsx)("span",{className:"font-bold text-purple-700",children:"PERCENT"===e.type?"".concat(Number(e.value),"%"):"S/ ".concat(Number(e.value).toFixed(2))})]}),e.maxDiscountPerItem&&(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"M\xe1x por \xedtem:"}),(0,a.jsxs)("span",{className:"font-medium text-gray-900",children:["S/ ",Number(e.maxDiscountPerItem).toFixed(2)]})]}),e.startsAt&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[(0,a.jsx)(d.A,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["Inicia: ",new Date(e.startsAt).toLocaleDateString()]})]}),e.endsAt&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[(0,a.jsx)(d.A,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["Expira: ",new Date(e.endsAt).toLocaleDateString()]})]})]}),(0,a.jsx)("div",{className:"pt-4 border-t border-gray-200",children:(0,a.jsx)("button",{onClick:()=>T(e.id,e.active),className:"w-full py-2 px-4 rounded-lg font-medium transition-colors ".concat(e.active?"bg-gray-100 text-gray-700 hover:bg-gray-200":"bg-purple-600 text-white hover:bg-purple-700"),children:e.active?"Desactivar":"Activar"})})]})},e.id)})})]})}),p&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Nueva Promoci\xf3n por Categor\xeda"}),(0,a.jsx)("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(i.A,{className:"w-6 h-6"})})]}),(0,a.jsxs)("form",{onSubmit:R,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre de la Promoci\xf3n *"}),(0,a.jsx)("input",{type:"text",value:A.name,onChange:e=>P({...A,name:e.target.value}),placeholder:"Ej: Descuento Bebidas",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Categor\xeda *"}),(0,a.jsxs)("select",{value:A.category,onChange:e=>P({...A,category:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0,disabled:E,children:[(0,a.jsx)("option",{value:"",children:E?"Cargando categor\xedas...":"Selecciona una categor\xeda"}),w.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Selecciona la categor\xeda de productos a aplicar descuento"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo *"}),(0,a.jsxs)("select",{value:A.type,onChange:e=>P({...A,type:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"PERCENT",children:"Porcentaje (%)"}),(0,a.jsx)("option",{value:"AMOUNT",children:"Monto Fijo (S/)"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor *"}),(0,a.jsx)("input",{type:"number",step:"0.01",value:A.value,onChange:e=>P({...A,value:e.target.value}),placeholder:"PERCENT"===A.type?"10":"5.00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descuento M\xe1ximo por \xcdtem (opcional)"}),(0,a.jsx)("input",{type:"number",step:"0.01",value:A.maxDiscountPerItem,onChange:e=>P({...A,maxDiscountPerItem:e.target.value}),placeholder:"Ej: 10.00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Tope de descuento por \xedtem (S/)"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha Inicio (opcional)"}),(0,a.jsx)("input",{type:"datetime-local",value:A.startsAt,onChange:e=>P({...A,startsAt:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha Fin (opcional)"}),(0,a.jsx)("input",{type:"datetime-local",value:A.endsAt,onChange:e=>P({...A,endsAt:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>u(!1),className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),(0,a.jsx)("button",{type:"submit",disabled:g,className:"flex-1 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50",children:g?"Creando...":"Crear Promoci\xf3n"})]})]})]})})}),j&&N&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Confirmar Eliminaci\xf3n"}),(0,a.jsx)("button",{onClick:F,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,a.jsx)("p",{className:"text-gray-600",children:"\xbfEst\xe1s seguro de que deseas eliminar esta promoci\xf3n?"}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Nombre:"}),(0,a.jsx)("p",{className:"font-medium text-gray-900",children:N.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Categor\xeda:"}),(0,a.jsx)("p",{className:"font-medium text-gray-900",children:N.category})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Descuento:"}),(0,a.jsx)("p",{className:"font-medium text-gray-900",children:"PERCENT"===N.type?"".concat(Number(N.value).toFixed(0),"%"):"S/ ".concat(Number(N.value).toFixed(2))})]})]}),(0,a.jsx)("p",{className:"text-sm text-red-600",children:"Esta acci\xf3n no se puede deshacer."})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:F,className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),(0,a.jsx)("button",{type:"button",onClick:()=>I(N.id),className:"flex-1 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Eliminar"})]})]})})})]})}}},e=>{var r=r=>e(e.s=r);e.O(0,[814,8173,9121,9445,8441,1517,7358],()=>r(8879)),_N_E=e.O()}]);