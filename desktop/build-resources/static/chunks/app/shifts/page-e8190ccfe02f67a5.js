(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4234],{8225:(e,t,r)=>{Promise.resolve().then(r.bind(r,2395))},2395:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var s=r(5155),a=r(2115),l=r(6046),o=r(9445),i=r(3666),n=r(814);function c(){(0,l.useRouter)();let[e,t]=(0,a.useState)(null),[r,c]=(0,a.useState)([]),[d,x]=(0,a.useState)(!0),[m,h]=(0,a.useState)(!1),[u,p]=(0,a.useState)(!1),[g,b]=(0,a.useState)(""),[y,f]=(0,a.useState)(""),[j,N]=(0,a.useState)(""),[v,w]=(0,a.useState)(0),[C,k]=(0,a.useState)({});(0,a.useEffect)(()=>{S(),E()},[]),(0,a.useEffect)(()=>{if(e){A();let e=setInterval(()=>{A()},5e3);return()=>clearInterval(e)}},[e]);let S=async()=>{try{let e=await fetch("/api/shifts/current"),r=await e.json();t(r.shift)}catch(e){n.oR.error("Error al cargar turno actual")}finally{x(!1)}},E=async()=>{try{let e=await fetch("/api/shifts/history"),t=await e.json();c(t.shifts||[])}catch(e){n.oR.error("Error al cargar historial")}},A=async()=>{if(e)try{let t=await fetch("/api/sales?shiftId=".concat(e.id));if(t.ok){let e=(await t.json()).sales||[],r=e.filter(e=>"CASH"===e.paymentMethod&&e.total>0).reduce((e,t)=>e+parseFloat(t.total||0),0);w(r);let s={};e.filter(e=>e.total>0).forEach(e=>{let t=e.paymentMethod;s[t]||(s[t]={total:0,count:0}),s[t].total+=parseFloat(e.total||0),s[t].count+=1}),k(s)}}catch(e){console.error("Error fetching cash sales:",e)}},T=async()=>{let e=parseFloat(g);if(isNaN(e)||e<0){n.oR.error("Ingresa un monto v\xe1lido");return}try{let t=await fetch("/api/shifts/open",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({openingCash:e})});if(!t.ok){let e=await t.json();n.oR.error(e.message);return}n.oR.success("Turno abierto correctamente"),h(!1),b(""),S(),E()}catch(e){n.oR.error("Error al abrir turno")}},F=async()=>{if(!e)return;let t=parseFloat(y);if(isNaN(t)||t<0){n.oR.error("Ingresa un monto v\xe1lido");return}try{let r=await fetch("/api/shifts/".concat(e.id,"/close"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({closingCash:t,notes:j})});if(!r.ok){let e=await r.json();n.oR.error(e.message);return}n.oR.success("Turno cerrado correctamente"),p(!1),f(""),N(""),S(),E()}catch(e){n.oR.error("Error al cerrar turno")}};if(d)return(0,s.jsx)(o.A,{storeName:"Turnos / Caja",children:(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})});let R=e?e.openingCash+v:0;return(0,s.jsxs)(o.A,{storeName:"Turnos / Caja",children:[(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-gray-900 mb-6",children:"Estado Actual"}),e?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"bg-gray-50/30 p-5 rounded-lg border border-gray-200",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:"Hora de apertura"}),(0,s.jsx)("p",{className:"text-base font-semibold text-gray-900",suppressHydrationWarning:!0,children:new Date(e.openedAt).toLocaleString("es-PE")})]}),(0,s.jsxs)("div",{className:"bg-green-50/30 p-5 rounded-lg border border-gray-200",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:"Caja inicial"}),(0,s.jsx)("p",{className:"text-base font-semibold text-gray-900",children:(0,i.up)(e.openingCash)})]}),(0,s.jsxs)("div",{className:"bg-purple-50/30 p-5 rounded-lg border border-gray-200",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:"Ventas en efectivo"}),(0,s.jsx)("p",{className:"text-base font-semibold text-gray-900",children:(0,i.up)(v)})]})]}),(0,s.jsxs)("div",{className:"bg-yellow-50/40 p-6 rounded-lg border border-gray-200",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Efectivo esperado"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(0,i.up)(R)}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["Caja inicial (",(0,i.up)(e.openingCash),") + Ventas (",(0,i.up)(v),")"]})]}),Object.keys(C).length>0&&(0,s.jsxs)("div",{className:"border border-gray-200 rounded-lg p-5",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-4",children:"Ventas por M\xe9todo de Pago"}),(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Object.entries(C).map(e=>{let[t,r]=e;return(0,s.jsxs)("div",{className:"bg-gray-50/50 p-4 rounded-lg",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"CASH"===t?"Efectivo":"YAPE"===t?"Yape":"PLIN"===t?"Plin":"CARD"===t?"Tarjeta":"Fiado"}),(0,s.jsx)("p",{className:"text-base font-bold text-gray-900",children:(0,i.up)(r.total)}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:[r.count," ticket",1!==r.count?"s":""]})]},t)})})]}),(0,s.jsx)("button",{onClick:()=>p(!0),className:"w-full px-5 py-2.5 bg-white text-gray-700 border-2 border-[#2bee79] rounded-lg hover:bg-[#2bee79] hover:text-[#0d1b13] font-medium transition-colors",children:"Cerrar Turno"})]}):(0,s.jsx)("div",{className:"text-center py-12",children:(0,s.jsxs)("div",{className:"max-w-sm mx-auto",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"No hay turno abierto"}),(0,s.jsx)("button",{onClick:()=>h(!0),className:"px-6 py-2.5 bg-[#2bee79] text-[#0d1b13] rounded-lg hover:bg-[#25c765] font-medium transition-colors",children:"Abrir Turno"})]})})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-gray-900 mb-6",children:"Historial de Turnos"}),0===r.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,s.jsx)("p",{className:"text-gray-600",children:"No hay turnos cerrados"})]}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Apertura"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cierre"}),(0,s.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Caja inicial"}),(0,s.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Esperado"}),(0,s.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Caja final"}),(0,s.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Diferencia"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Abierto por"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map(e=>{let t=e.difference||0,r=t>0?"text-green-600":t<0?"text-red-600":"text-gray-600";return(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"px-4 py-3 text-sm",children:new Date(e.openedAt).toLocaleString("es-PE",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}),(0,s.jsx)("td",{className:"px-4 py-3 text-sm",children:e.closedAt?new Date(e.closedAt).toLocaleString("es-PE",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}),(0,s.jsx)("td",{className:"px-4 py-3 text-sm text-right",children:(0,i.up)(e.openingCash)}),(0,s.jsx)("td",{className:"px-4 py-3 text-sm text-right",children:(0,i.up)(e.expectedCash||0)}),(0,s.jsx)("td",{className:"px-4 py-3 text-sm text-right",children:(0,i.up)(e.closingCash||0)}),(0,s.jsxs)("td",{className:"px-4 py-3 text-sm text-right font-medium ".concat(r),children:[t>0?"+":"",(0,i.up)(t)]}),(0,s.jsx)("td",{className:"px-4 py-3 text-sm",children:e.openedBy.name})]},e.id)})})]})})]})]}),m&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-md",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-5",children:"Abrir Turno"}),(0,s.jsxs)("div",{className:"space-y-5",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Caja inicial (S/)"}),(0,s.jsx)("input",{type:"number",step:"0.01",value:g,onChange:e=>b(e.target.value),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2bee79] focus:border-[#2bee79] transition-colors",placeholder:"0.00",autoFocus:!0})]}),(0,s.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,s.jsx)("button",{onClick:()=>h(!1),className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium transition-colors",children:"Cancelar"}),(0,s.jsx)("button",{onClick:T,className:"flex-1 px-4 py-2.5 bg-[#2bee79] text-[#0d1b13] rounded-lg hover:bg-[#25c765] font-medium transition-colors",children:"Abrir Turno"})]})]})]})}),u&&e&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-md",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-5",children:"Cerrar Turno"}),(0,s.jsxs)("div",{className:"bg-yellow-50/40 p-5 rounded-lg mb-5 border border-gray-200",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Efectivo esperado"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(0,i.up)(R)})]}),(0,s.jsxs)("div",{className:"space-y-5",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Caja final (S/)"}),(0,s.jsx)("input",{type:"number",step:"0.01",value:y,onChange:e=>f(e.target.value),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2bee79] focus:border-[#2bee79] transition-colors",placeholder:"0.00",autoFocus:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notas (opcional)"}),(0,s.jsx)("textarea",{value:j,onChange:e=>N(e.target.value),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2bee79] focus:border-[#2bee79] transition-colors",rows:3,placeholder:"Ej: Faltaron S/ 5 por error en cambio"})]}),y&&(0,s.jsxs)("div",{className:"bg-gray-50/50 p-5 rounded-lg border border-gray-200",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Diferencia"}),(0,s.jsxs)("p",{className:"text-xl font-bold ".concat(parseFloat(y)-R>0?"text-green-600":parseFloat(y)-R<0?"text-red-600":"text-gray-700"),children:[parseFloat(y)-R>0?"+":"",(0,i.up)(parseFloat(y)-R)]})]}),(0,s.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,s.jsx)("button",{onClick:()=>{p(!1),f(""),N("")},className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium transition-colors",children:"Cancelar"}),(0,s.jsx)("button",{onClick:F,className:"flex-1 px-4 py-2.5 bg-red-500 text-white rounded-lg hover:bg-red-600 font-medium transition-colors",children:"Cerrar Turno"})]})]})]})})]})}},3666:(e,t,r)=>{"use strict";function s(e){if(null==e||isNaN(e))return"S/ 0.00";let t="string"==typeof e?parseFloat(e):e;return"S/ ".concat(t.toFixed(2))}r.d(t,{up:()=>s})}},e=>{var t=t=>e(e.s=t);e.O(0,[814,8173,9121,9445,8441,1517,7358],()=>t(8225)),_N_E=e.O()}]);