(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4530],{3156:(e,t,s)=>{Promise.resolve().then(s.bind(s,7221))},3518:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(7401).A)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},7221:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var a=s(5155),l=s(2115),r=s(9445),i=s(814),d=s(853),n=s(767),c=s(3518),o=s(6967);function x(){let[e,t]=(0,l.useState)([]),[s,x]=(0,l.useState)({limit:25,offset:0,total:0}),[m,p]=(0,l.useState)(!0),[h,u]=(0,l.useState)(null),[g,j]=(0,l.useState)(!1),[y,f]=(0,l.useState)(""),[N,b]=(0,l.useState)(""),[v,S]=(0,l.useState)(""),[w,E]=(0,l.useState)(""),[A,R]=(0,l.useState)(""),[O,k]=(0,l.useState)("");(0,l.useEffect)(()=>{C()},[]),(0,l.useEffect)(()=>{T()},[s.offset]);let C=async()=>{try{let e=await fetch("/api/auth/is-superadmin");if(e.ok){let t=await e.json();j(t.isSuperAdmin)}}catch(e){console.error("Error checking superadmin:",e)}},T=async()=>{p(!0);try{let e=new URLSearchParams({limit:s.limit.toString(),offset:s.offset.toString()});y&&e.append("store_id",y),N&&e.append("severity",N),v&&e.append("action",v),w&&e.append("entityType",w),A&&e.append("dateFrom",A),O&&e.append("dateTo",O);let a=await fetch("/api/audit-logs?".concat(e.toString()));if(!a.ok){let e=await a.json();i.oR.error(e.message||"Error al cargar logs");return}let l=await a.json();t(l.data),x(l.pagination)}catch(e){i.oR.error("Error al cargar logs de auditor\xeda")}finally{p(!1)}},I=e=>(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat({INFO:"bg-blue-100 text-blue-800",WARN:"bg-yellow-100 text-yellow-800",ERROR:"bg-red-100 text-red-800"}[e]),children:e}),U=e=>new Date(e).toLocaleString("es-PE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});return(0,a.jsxs)(r.A,{children:[(0,a.jsx)(i.l$,{position:"top-right"}),(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 p-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-2",children:[(0,a.jsx)("button",{onClick:()=>window.history.back(),className:"text-gray-600 hover:text-gray-900",children:"â† Volver"}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Logs de Auditor\xeda"})]}),(0,a.jsx)("p",{className:"text-gray-600",children:"Historial completo de operaciones cr\xedticas del sistema"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Desde"}),(0,a.jsx)("input",{type:"date",value:A,onChange:e=>R(e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hasta"}),(0,a.jsx)("input",{type:"date",value:O,onChange:e=>k(e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Severidad"}),(0,a.jsxs)("select",{value:N,onChange:e=>b(e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2",children:[(0,a.jsx)("option",{value:"",children:"Todas"}),(0,a.jsx)("option",{value:"INFO",children:"INFO"}),(0,a.jsx)("option",{value:"WARN",children:"WARN"}),(0,a.jsx)("option",{value:"ERROR",children:"ERROR"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Acci\xf3n"}),(0,a.jsx)("input",{type:"text",value:v,onChange:e=>S(e.target.value),placeholder:"Buscar acci\xf3n...",className:"w-full border border-gray-300 rounded-md px-3 py-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Entidad"}),(0,a.jsxs)("select",{value:w,onChange:e=>E(e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2",children:[(0,a.jsx)("option",{value:"",children:"Todas"}),(0,a.jsx)("option",{value:"SALE",children:"VENTA"}),(0,a.jsx)("option",{value:"SHIFT",children:"TURNO"}),(0,a.jsx)("option",{value:"RECEIVABLE",children:"FIADO"}),(0,a.jsx)("option",{value:"USER",children:"USUARIO"}),(0,a.jsx)("option",{value:"COUPON",children:"CUP\xd3N"}),(0,a.jsx)("option",{value:"PROMOTION",children:"PROMOCI\xd3N"}),(0,a.jsx)("option",{value:"PRODUCT",children:"PRODUCTO"}),(0,a.jsx)("option",{value:"STORE",children:"TIENDA"}),(0,a.jsx)("option",{value:"SYSTEM",children:"SISTEMA"}),(0,a.jsx)("option",{value:"RESTORE",children:"RESTORE"})]})]}),g&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Store ID"}),(0,a.jsx)("input",{type:"text",value:y,onChange:e=>f(e.target.value),placeholder:"Store ID...",className:"w-full border border-gray-300 rounded-md px-3 py-2"})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,a.jsxs)("button",{onClick:()=>{x({...s,offset:0}),T()},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:[(0,a.jsx)(d.A,{size:16}),"Aplicar Filtros"]}),(0,a.jsxs)("button",{onClick:()=>{f(""),b(""),S(""),E(""),R(""),k(""),x({...s,offset:0})},className:"flex items-center gap-2 px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300",children:[(0,a.jsx)(n.A,{size:16}),"Limpiar"]})]})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:m?(0,a.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Cargando logs..."}):0===e.length?(0,a.jsx)("div",{className:"p-8 text-center text-gray-500",children:"No se encontraron registros"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50 border-b",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fecha"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Usuario"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acci\xf3n"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Entidad"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Severidad"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"IP"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:e.map(e=>(0,a.jsxs)(l.Fragment,{children:[(0,a.jsxs)("tr",{onClick:()=>u(h===e.id?null:e.id),className:"hover:bg-gray-50 cursor-pointer",children:[(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:U(e.createdAt)}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.user?(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.user.name}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.user.email})]}):(0,a.jsx)("span",{className:"text-gray-400",children:"Sistema"})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.action}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.entityType}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm",children:I(e.severity)}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-500",children:e.ip||"-"})]}),h===e.id&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"px-4 py-4 bg-gray-50",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"Entity ID:"})," ",e.entityId||"N/A"]}),e.store&&(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"Tienda:"})," ",e.store.name," (",e.store.id,")"]}),e.userAgent&&(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"User Agent:"})," ",(0,a.jsx)("span",{className:"text-gray-600 text-xs",children:e.userAgent})]}),e.meta&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("div",{className:"font-medium text-sm mb-1",children:"Metadata:"}),(0,a.jsx)("pre",{className:"bg-white border rounded p-2 text-xs overflow-x-auto max-h-64",children:JSON.stringify(e.meta,null,2)})]})]})})})]},e.id))})]})}),(0,a.jsxs)("div",{className:"bg-gray-50 px-4 py-3 border-t flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-700",children:["Mostrando ",s.offset+1," - ",Math.min(s.offset+s.limit,s.total)," de ",s.total," registros"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:()=>{s.offset>0&&x({...s,offset:Math.max(0,s.offset-s.limit)})},disabled:0===s.offset,className:"px-3 py-1 border rounded-md hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",children:[(0,a.jsx)(c.A,{size:16}),"Anterior"]}),(0,a.jsxs)("button",{onClick:()=>{s.offset+s.limit<s.total&&x({...s,offset:s.offset+s.limit})},disabled:s.offset+s.limit>=s.total,className:"px-3 py-1 border rounded-md hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",children:["Siguiente",(0,a.jsx)(o.A,{size:16})]})]})]})]})})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[814,8173,9121,9445,8441,1517,7358],()=>t(3156)),_N_E=e.O()}]);