(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8286],{7842:(e,s,t)=>{Promise.resolve().then(t.bind(t,8363))},6046:(e,s,t)=>{"use strict";var a=t(6658);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(s,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(s,{useSearchParams:function(){return a.useSearchParams}})},8363:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>n});var a=t(5155),l=t(2115),i=t(6046),r=t(814);function n(){var e,s,t,n,d,o;let c=(0,i.useRouter)(),[x,m]=(0,l.useState)(!0),[u,h]=(0,l.useState)(null),[g,p]=(0,l.useState)(null),[j,y]=(0,l.useState)(null),[v,N]=(0,l.useState)(null),[f,b]=(0,l.useState)(!1);async function w(){m(!0);try{await Promise.all([S(),D(),k(),E()])}catch(e){console.error("Error loading system data:",e),r.oR.error("Error al cargar datos del sistema")}finally{m(!1)}}async function S(){let e=await fetch("/api/system/health");e.ok&&h(await e.json())}async function D(){let e=await fetch("/api/system/store-status");e.ok&&p(await e.json())}async function k(){let e=await fetch("/api/system/config-snapshot");e.ok&&y(await e.json())}async function E(){let e=await fetch("/api/system/backups/status");e.ok&&N(await e.json())}async function R(){if(!f){b(!0);try{let e=await fetch("/api/system/diagnostic/export");if(!e.ok){let s=await e.json();403===e.status?r.oR.error("Solo SUPERADMIN puede exportar diagn\xf3stico"):r.oR.error(s.message||"Error al exportar");return}let s=await e.blob(),t=window.URL.createObjectURL(s),a=document.createElement("a");a.href=t;let l=e.headers.get("Content-Disposition"),i=null==l?void 0:l.match(/filename="(.+)"/),n=(null==i?void 0:i[1])||"diagnostic-export.zip";a.download=n,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(t),document.body.removeChild(a),r.oR.success("Diagn\xf3stico exportado correctamente")}catch(e){console.error("Error exporting diagnostic:",e),r.oR.error("Error al exportar diagn\xf3stico")}finally{b(!1)}}}function P(e){return null==e?"N/A":"$".concat(e.toFixed(2))}return((0,l.useEffect)(()=>{w();let e=setInterval(()=>{S()},3e4);return()=>clearInterval(e)},[]),x)?(0,a.jsx)("div",{className:"min-h-screen bg-gray-100 p-4 flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-gray-600",children:"Cargando..."})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-100 p-4",suppressHydrationWarning:!0,children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"\uD83D\uDD0D Observabilidad del Sistema"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Monitoreo en tiempo real del estado operativo"})]}),(0,a.jsx)("button",{onClick:R,disabled:f,className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:f?"Exportando...":"\uD83D\uDCE6 Exportar Diagn\xf3stico"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Estado del Sistema"}),(0,a.jsx)("div",{className:"w-4 h-4 rounded-full ".concat((d=null==u?void 0:u.status)?"OK"===d?"bg-green-500":"DEGRADED"===d?"bg-yellow-500":"bg-red-500":"bg-gray-400")})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Estado"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:(null==u?void 0:u.status)||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Base de Datos"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:(null==u?void 0:u.database.status)||"N/A"}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[null==u?void 0:u.database.latencyMs,"ms"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Uptime"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:function(e){if(!e)return"N/A";let s=Math.floor(e/3600),t=Math.floor(e%3600/60);return"".concat(s,"h ").concat(t,"m")}(null==u?void 0:u.uptime)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Versi\xf3n"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:(null==u?void 0:u.appVersion)||"N/A"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Estado de la Tienda"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Tienda"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:(null==g?void 0:g.storeName)||"N/A"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:null==g?void 0:g.storeStatus})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Turno"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:(null==g?void 0:g.currentShift.open)?"\uD83D\uDFE2 Abierto":"\uD83D\uDD34 Cerrado"}),(null==g?void 0:g.currentShift.open)&&(0,a.jsx)("p",{className:"text-xs text-gray-500",children:g.currentShift.openedBy})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Ventas Hoy"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:(null==g?void 0:g.today.salesCount)||0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Total Hoy"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:P(null==g?void 0:g.today.salesTotal)})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Configuraci\xf3n Activa"}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Feature Flags"}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:(null==j?void 0:j.featureFlags)&&Object.entries(j.featureFlags).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("span",{className:t?"text-green-600":"text-gray-400",children:t?"✓":"✗"}),(0,a.jsx)("span",{className:"text-gray-700",children:s})]},s)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:"L\xedmites Operativos"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Descuento M\xe1x."}),(0,a.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:(null==j?void 0:null===(e=j.operationalLimits)||void 0===e?void 0:e.maxDiscountPercent)!==null?"".concat(null==j?void 0:null===(s=j.operationalLimits)||void 0===s?void 0:s.maxDiscountPercent,"%"):"Sin l\xedmite"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Venta M\xe1x."}),(0,a.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:P(null==j?void 0:null===(t=j.operationalLimits)||void 0===t?void 0:t.maxSaleTotal)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Items M\xe1x."}),(0,a.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:(null==j?void 0:null===(n=j.operationalLimits)||void 0===n?void 0:n.maxItemsPerSale)||"Sin l\xedmite"})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Estado de Backups"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Total Backups"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:(null==v?void 0:v.totalBackups)||0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"\xdaltimo Backup"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:(o=null==v?void 0:v.lastBackup.timestamp)?new Date(o).toLocaleString("es-MX",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Puede Restaurar"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:(null==v?void 0:v.canRestore)?"✅ S\xed":"❌ No"})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("button",{onClick:()=>c.push("/admin"),className:"px-4 py-2 text-gray-700 hover:text-gray-900",children:"← Volver al Panel"}),(0,a.jsx)("button",{onClick:w,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"\uD83D\uDD04 Refrescar"})]})]})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[814,8441,1517,7358],()=>s(7842)),_N_E=e.O()}]);