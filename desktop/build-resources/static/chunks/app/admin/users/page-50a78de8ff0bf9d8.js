(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8733],{3247:(e,s,r)=>{Promise.resolve().then(r.bind(r,2342))},6046:(e,s,r)=>{"use strict";var a=r(6658);r.o(a,"useParams")&&r.d(s,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(s,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(s,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(s,{useSearchParams:function(){return a.useSearchParams}})},2342:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>l});var a=r(5155),t=r(2115),n=r(6046),o=r(814);function l(){let e=(0,n.useRouter)(),[s,r]=(0,t.useState)([]),[l,i]=(0,t.useState)(!0),[c,d]=(0,t.useState)(!1),[u,x]=(0,t.useState)(!1),[m,h]=(0,t.useState)(""),[p,g]=(0,t.useState)(!1),[b,y]=(0,t.useState)(""),[j,f]=(0,t.useState)(""),[N,v]=(0,t.useState)(""),[w,k]=(0,t.useState)(!1),[C,S]=(0,t.useState)(!1),[E,L]=(0,t.useState)({name:"",email:"",password:""});async function P(){try{let s=await fetch("/api/admin/users");if(403===s.status){e.push("/");return}if(!s.ok)throw Error("Error al cargar usuarios");let a=await s.json();r(a.users)}catch(e){h("Error al cargar usuarios")}finally{i(!1)}}async function R(e){e.preventDefault(),h(""),d(!0);try{let e=await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)}),s=await e.json();if(!e.ok){h(s.message||"Error al crear usuario");return}P(),L({name:"",email:"",password:""}),x(!1),o.oR.success("Usuario creado exitosamente")}catch(e){h("Error de red")}finally{d(!1)}}async function M(e){try{let s=await fetch("/api/admin/users/".concat(e,"/toggle"),{method:"PATCH"});if(!s.ok){let e=await s.json();o.oR.error(e.message||"Error al actualizar usuario");return}P()}catch(e){o.oR.error("Error de red")}}async function A(e,s){y(e),f(s),v(""),g(!0)}async function O(){if(!N||N.length<6){o.oR.error("La contrase\xf1a debe tener al menos 6 caracteres");return}try{let e=await fetch("/api/admin/users/".concat(b,"/reset-password"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:N})});if(!e.ok){let s=await e.json();o.oR.error(s.message||"Error al resetear contrase\xf1a");return}g(!1),v(""),o.oR.success("Contrase\xf1a actualizada correctamente")}catch(e){o.oR.error("Error de red")}}return((0,t.useEffect)(()=>{P()},[]),l)?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 p-8",children:(0,a.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,a.jsx)("p",{children:"Cargando..."})})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 p-8",children:[(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Gesti\xf3n de Usuarios"}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:"Administrar cajeros y permisos"})]}),(0,a.jsx)("button",{onClick:()=>e.push("/"),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Volver"})]}),p&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-md w-full mx-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Cambiar Contrase\xf1a"}),(0,a.jsxs)("p",{className:"text-gray-600 mb-4",children:["Usuario: ",(0,a.jsx)("span",{className:"font-semibold",children:j})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nueva Contrase\xf1a"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:C?"text":"password",value:N,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",placeholder:"M\xednimo 6 caracteres",autoFocus:!0}),(0,a.jsx)("button",{type:"button",onClick:()=>S(!C),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:C?(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):(0,a.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:O,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Cambiar"}),(0,a.jsx)("button",{onClick:function(){g(!1),v(""),y(""),f(""),S(!1)},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"Cancelar"})]})]})}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("button",{onClick:()=>x(!u),className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:u?"Cancelar":"Nuevo Cajero"})}),u&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Crear Nuevo Cajero"}),m&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4",children:m}),(0,a.jsxs)("form",{onSubmit:R,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre Completo"}),(0,a.jsx)("input",{type:"text",required:!0,value:E.name,onChange:e=>L({...E,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",required:!0,value:E.email,onChange:e=>L({...E,email:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contrase\xf1a"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:w?"text":"password",required:!0,minLength:6,value:E.password,onChange:e=>L({...E,password:e.target.value}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",placeholder:"M\xednimo 6 caracteres"}),(0,a.jsx)("button",{type:"button",onClick:()=>k(!w),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:w?(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):(0,a.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{type:"submit",disabled:c,className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400",children:c?"Creando...":"Crear Cajero"}),(0,a.jsx)("button",{type:"button",onClick:()=>x(!1),className:"px-6 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"Cancelar"})]})]})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-100 border-b",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Usuario"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Rol"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Estado"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Creado"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Acciones"})]})}),(0,a.jsx)("tbody",{children:0===s.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,className:"px-6 py-8 text-center text-gray-500",children:"No hay usuarios registrados"})}):s.map(e=>(0,a.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:e.email})]})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat("OWNER"===e.role?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"),children:e.role})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat(e.active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.active?"Activo":"Inactivo"})}),(0,a.jsx)("td",{className:"px-6 py-4 text-gray-500 text-sm",children:new Date(e.createdAt).toLocaleDateString("es-PE")}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("div",{className:"flex gap-2",children:"OWNER"!==e.role&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>M(e.id),className:"px-3 py-1 text-xs font-medium rounded ".concat(e.active?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"),children:e.active?"Desactivar":"Activar"}),(0,a.jsx)("button",{onClick:()=>A(e.id,e.name),className:"px-3 py-1 text-xs font-medium rounded bg-gray-100 text-gray-700 hover:bg-gray-200",children:"Resetear Pass"})]})})})]},e.id))})]})})]}),(0,a.jsx)(o.l$,{position:"top-right",richColors:!0})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[814,8441,1517,7358],()=>s(3247)),_N_E=e.O()}]);