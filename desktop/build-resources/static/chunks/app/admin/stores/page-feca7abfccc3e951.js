(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7769],{5141:(e,s,r)=>{Promise.resolve().then(r.bind(r,3892))},6046:(e,s,r)=>{"use strict";var t=r(6658);r.o(t,"useParams")&&r.d(s,{useParams:function(){return t.useParams}}),r.o(t,"usePathname")&&r.d(s,{usePathname:function(){return t.usePathname}}),r.o(t,"useRouter")&&r.d(s,{useRouter:function(){return t.useRouter}}),r.o(t,"useSearchParams")&&r.d(s,{useSearchParams:function(){return t.useSearchParams}})},3892:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>i});var t=r(5155),a=r(2115),n=r(6046),o=r(814);function i(){var e;let s=(0,n.useRouter)(),[r,i]=(0,a.useState)([]),[l,d]=(0,a.useState)(!0),[c,u]=(0,a.useState)(!1),[x,m]=(0,a.useState)(!1),[h,p]=(0,a.useState)(""),[g,f]=(0,a.useState)(!1),[b,y]=(0,a.useState)(!1),[j,N]=(0,a.useState)(null),[v,w]=(0,a.useState)([]),[C,P]=(0,a.useState)(null),[k,E]=(0,a.useState)({storeName:"",storeRuc:"",storeAddress:"",storePhone:"",ownerName:"",ownerEmail:"",ownerPassword:"",businessProfile:"BODEGA"});async function R(){try{let e=await fetch("/api/admin/business-profiles");if(e.ok){let s=await e.json();w(s.profiles)}}catch(e){console.error("Error cargando perfiles:",e)}}async function S(){try{let e=await fetch("/api/admin/stores?showArchived=".concat(b));if(403===e.status){s.push("/");return}if(!e.ok)throw Error("Error al cargar tiendas");let r=await e.json();i(r.stores)}catch(e){p("Error al cargar tiendas")}finally{d(!1)}}async function A(e){if(confirm("\xbfSeguro que quieres archivar esta tienda? Los usuarios no podr\xe1n acceder a las operaciones.")){N(e);try{let s=await fetch("/api/admin/stores/".concat(e,"/archive"),{method:"POST"}),r=await s.json();if(!s.ok){o.oR.error(r.error||"Error al archivar tienda");return}o.oR.success(r.message),S()}catch(e){o.oR.error("Error de red")}finally{N(null)}}}async function T(e){if(confirm("\xbfSeguro que quieres reactivar esta tienda?")){N(e);try{let s=await fetch("/api/admin/stores/".concat(e,"/reactivate"),{method:"POST"}),r=await s.json();if(!s.ok){o.oR.error(r.error||"Error al reactivar tienda");return}o.oR.success(r.message),S()}catch(e){o.oR.error("Error de red")}finally{N(null)}}}async function O(e){e.preventDefault(),p(""),u(!0);try{var r,t;let e=await fetch("/api/admin/stores",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)}),a=await e.json();if(!e.ok){o.oR.error(a.message||"Error al crear tienda");return}if(o.oR.success("Tienda creada exitosamente"),null===(r=a.store)||void 0===r?void 0:r.id)try{if((await fetch("/api/setup/switch-store",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storeId:a.store.id,userId:null===(t=a.owner)||void 0===t?void 0:t.id})})).ok){let e=await fetch("/api/setup/seed-products",{method:"POST"});if(e.ok){let s=await e.json();o.oR.success("".concat(s.productsCreated," productos de ejemplo creados"))}s.push("/"),s.refresh();return}}catch(e){console.warn("Error al configurar tienda:",e)}S(),E({storeName:"",storeRuc:"",storeAddress:"",storePhone:"",ownerName:"",ownerEmail:"",ownerPassword:"",businessProfile:"BODEGA"}),m(!1)}catch(e){o.oR.error("Error de red")}finally{u(!1)}}(0,a.useEffect)(()=>{S(),R()},[b]);let D=r.filter(e=>"ARCHIVED"===e.status).length;async function I(e,s){P(e);try{let r=await fetch("/api/admin/stores/".concat(e,"/set-profile"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({businessProfile:s})}),t=await r.json();if(!r.ok){o.oR.error(t.message||"Error al cambiar perfil");return}o.oR.success("Perfil cambiado a ".concat(s)),S()}catch(e){o.oR.error("Error de red")}finally{P(null)}}function L(e){return v.find(s=>s.profile===e)||{icon:"\uD83C\uDFEA",name:e}}return l?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 p-8",children:(0,t.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,t.jsx)("p",{children:"Cargando..."})})}):(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50 p-8",children:[(0,t.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Administraci\xf3n de Tiendas"}),(0,t.jsx)("p",{className:"text-gray-600 mt-2",children:"SUPERADMIN Panel"})]}),(0,t.jsx)("button",{onClick:()=>s.push("/"),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Volver"})]}),(0,t.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,t.jsx)("button",{onClick:()=>m(!x),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium",children:x?"Cancelar":"+ Nueva Tienda"}),(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:b,onChange:e=>y(e.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),(0,t.jsxs)("span",{className:"text-sm text-gray-700",children:["Mostrar archivadas ",D>0&&"(".concat(D,")")]})]})]}),x&&(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Crear Nueva Tienda"}),h&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4",children:h}),(0,t.jsxs)("form",{onSubmit:O,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre de la Tienda *"}),(0,t.jsx)("input",{type:"text",required:!0,value:k.storeName,onChange:e=>E({...k,storeName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rubro / Perfil de Negocio *"}),(0,t.jsx)("select",{required:!0,value:k.businessProfile,onChange:e=>E({...k,businessProfile:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",children:v.map(e=>(0,t.jsxs)("option",{value:e.profile,children:[e.icon," ",e.name]},e.profile))}),v.find(e=>e.profile===k.businessProfile)&&(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:null===(e=v.find(e=>e.profile===k.businessProfile))||void 0===e?void 0:e.description})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"RUC"}),(0,t.jsx)("input",{type:"text",value:k.storeRuc,onChange:e=>E({...k,storeRuc:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Direcci\xf3n"}),(0,t.jsx)("input",{type:"text",value:k.storeAddress,onChange:e=>E({...k,storeAddress:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tel\xe9fono"}),(0,t.jsx)("input",{type:"text",value:k.storePhone,onChange:e=>E({...k,storePhone:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre del Owner *"}),(0,t.jsx)("input",{type:"text",required:!0,value:k.ownerName,onChange:e=>E({...k,ownerName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email del Owner *"}),(0,t.jsx)("input",{type:"email",required:!0,value:k.ownerEmail,onChange:e=>E({...k,ownerEmail:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contrase\xf1a del Owner *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{type:g?"text":"password",required:!0,minLength:6,value:k.ownerPassword,onChange:e=>E({...k,ownerPassword:e.target.value}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",placeholder:"M\xednimo 6 caracteres"}),(0,t.jsx)("button",{type:"button",onClick:()=>f(!g),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:g?(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):(0,t.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{type:"submit",disabled:c,className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400",children:c?"Creando...":"Crear Tienda"}),(0,t.jsx)("button",{type:"button",onClick:()=>m(!1),className:"px-6 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"Cancelar"})]})]})]}),(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-gray-100 border-b",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Tienda"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Rubro"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"RUC"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Estado"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Usuarios"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Productos"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Creada"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Acciones"})]})}),(0,t.jsx)("tbody",{children:0===r.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:8,className:"px-6 py-8 text-center text-gray-500",children:b?"No hay tiendas archivadas":"No hay tiendas activas"})}):r.map(e=>(0,t.jsxs)("tr",{className:"border-b hover:bg-gray-50 ".concat("ARCHIVED"===e.status?"bg-gray-50":""),children:[(0,t.jsx)("td",{className:"px-6 py-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium ".concat("ARCHIVED"===e.status?"text-gray-500":"text-gray-900"),children:e.name}),e.address&&(0,t.jsx)("p",{className:"text-sm text-gray-500",children:e.address})]})}),(0,t.jsx)("td",{className:"px-6 py-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-lg",children:L(e.businessProfile).icon}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-700",children:L(e.businessProfile).name}),"ACTIVE"===e.status&&(0,t.jsx)("select",{value:e.businessProfile,onChange:s=>I(e.id,s.target.value),disabled:C===e.id,className:"text-xs text-blue-600 bg-transparent border-none cursor-pointer hover:underline p-0 focus:ring-0",children:v.map(e=>(0,t.jsxs)("option",{value:e.profile,children:[e.icon," ",e.name]},e.profile))})]})]})}),(0,t.jsx)("td",{className:"px-6 py-4 text-gray-700",children:e.ruc||"-"}),(0,t.jsx)("td",{className:"px-6 py-4",children:"ACTIVE"===e.status?(0,t.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"ACTIVA"}):(0,t.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"ARCHIVADA"})}),(0,t.jsx)("td",{className:"px-6 py-4 text-gray-700",children:e._count.users}),(0,t.jsx)("td",{className:"px-6 py-4 text-gray-700",children:e._count.storeProducts}),(0,t.jsx)("td",{className:"px-6 py-4 text-gray-500 text-sm",children:new Date(e.createdAt).toLocaleDateString("es-PE")}),(0,t.jsx)("td",{className:"px-6 py-4",children:"ACTIVE"===e.status?(0,t.jsx)("button",{onClick:()=>A(e.id),disabled:j===e.id,className:"px-3 py-1 text-sm bg-orange-100 text-orange-700 rounded hover:bg-orange-200 disabled:opacity-50",children:j===e.id?"Archivando...":"Archivar"}):(0,t.jsx)("button",{onClick:()=>T(e.id),disabled:j===e.id,className:"px-3 py-1 text-sm bg-green-100 text-green-700 rounded hover:bg-green-200 disabled:opacity-50",children:j===e.id?"Reactivando...":"Reactivar"})})]},e.id))})]})})]}),(0,t.jsx)(o.l$,{position:"top-right",richColors:!0})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[814,8441,1517,7358],()=>s(5141)),_N_E=e.O()}]);