(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5398],{9084:(e,t,a)=>{Promise.resolve().then(a.bind(a,8812))},7401:(e,t,a)=>{"use strict";a.d(t,{A:()=>u});var s=a(2115);let r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase()),n=e=>{let t=l(e);return t.charAt(0).toUpperCase()+t.slice(1)},i=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim()},o=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let d=(0,s.forwardRef)((e,t)=>{let{color:a="currentColor",size:r=24,strokeWidth:l=2,absoluteStrokeWidth:n,className:d="",children:u,iconNode:m,...x}=e;return(0,s.createElement)("svg",{ref:t,...c,width:r,height:r,stroke:a,strokeWidth:n?24*Number(l)/Number(r):l,className:i("lucide",d),...!u&&!o(x)&&{"aria-hidden":"true"},...x},[...m.map(e=>{let[t,a]=e;return(0,s.createElement)(t,a)}),...Array.isArray(u)?u:[u]])}),u=(e,t)=>{let a=(0,s.forwardRef)((a,l)=>{let{className:o,...c}=a;return(0,s.createElement)(d,{ref:l,iconNode:t,className:i("lucide-".concat(r(n(e))),"lucide-".concat(e),o),...c})});return a.displayName=n(e),a}},1594:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7401).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},6336:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7401).A)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},2970:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7401).A)("cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]])},1476:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7401).A)("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]])},7581:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7401).A)("hard-drive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]])},8684:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(7401).A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},6046:(e,t,a)=>{"use strict";var s=a(6658);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},1956:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});let s=a(306)._(a(580));function r(e,t){var a;let r={};"function"==typeof e&&(r.loader=e);let l={...r,...t};return(0,s.default)({...l,modules:null==(a=l.loadableGenerated)?void 0:a.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},9827:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return r}});let s=a(3719);function r(e){let{reason:t,children:a}=e;if("undefined"==typeof window)throw new s.BailoutToCSRError(t);return a}},580:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return c}});let s=a(5155),r=a(2115),l=a(9827),n=a(9214);function i(e){return{default:e&&"default"in e?e.default:e}}let o={loader:()=>Promise.resolve(i(()=>null)),loading:null,ssr:!0},c=function(e){let t={...o,...e},a=(0,r.lazy)(()=>t.loader().then(i)),c=t.loading;function d(e){let i=c?(0,s.jsx)(c,{isLoading:!0,pastDelay:!0,error:null}):null,o=!t.ssr||!!t.loading,d=o?r.Suspense:r.Fragment,u=t.ssr?(0,s.jsxs)(s.Fragment,{children:["undefined"==typeof window?(0,s.jsx)(n.PreloadChunks,{moduleIds:t.modules}):null,(0,s.jsx)(a,{...e})]}):(0,s.jsx)(l.BailoutToCSR,{reason:"next/dynamic",children:(0,s.jsx)(a,{...e})});return(0,s.jsx)(d,{...o?{fallback:i}:{},children:u})}return d.displayName="LoadableComponent",d}},9214:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return i}});let s=a(5155),r=a(7650),l=a(5861),n=a(8284);function i(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let a=l.workAsyncStorage.getStore();if(void 0===a)return null;let i=[];if(a.reactLoadableManifest&&t){let e=a.reactLoadableManifest;for(let a of t){if(!e[a])continue;let t=e[a].files;i.push(...t)}}return 0===i.length?null:(0,s.jsx)(s.Fragment,{children:i.map(e=>{let t=a.assetPrefix+"/_next/"+(0,n.encodeURIPath)(e);return e.endsWith(".css")?(0,s.jsx)("link",{precedence:"dynamic",href:t,rel:"stylesheet",as:"style"},e):((0,r.preload)(t,{as:"script",fetchPriority:"low"}),null)})})}},8812:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var s=a(5155),r=a(2115),l=a(6046),n=a(1476),i=a(7581),o=a(2970),c=a(8684),d=a(1594),u=a(6336),m=a(814),x=a(1956);let h=a.n(x)()(()=>a.e(4899).then(a.bind(a,4899)),{loadableGenerated:{webpack:()=>[4899]},loading:()=>(0,s.jsx)("div",{className:"p-4 text-center text-gray-500",children:"Cargando..."})});function p(){let e=(0,l.useRouter)(),[t,a]=(0,r.useState)(!0),[x,p]=(0,r.useState)("local"),[f,g]=(0,r.useState)(!1),[b,y]=(0,r.useState)(null),[j,N]=(0,r.useState)(null);async function v(){try{if(!(await fetch("/api/auth/me")).ok){e.push("/login");return}a(!1)}catch(t){e.push("/login")}}async function k(){if(!b){m.oR.error("Selecciona un archivo de backup");return}g(!0),m.oR.info("Restaurando backup...");try{let e=new FormData;e.append("backup",b);let t=await fetch("/api/backups/restore/new-store",{method:"POST",body:e}),a=await t.json();if(!t.ok){m.oR.error(a.message||"Error al restaurar backup");return}N(a),m.oR.success("Backup restaurado exitosamente"),y(null)}catch(e){console.error(e),m.oR.error("Error al restaurar backup")}finally{g(!1)}}return(0,r.useEffect)(()=>{v()},[]),t?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-gray-600",children:"Verificando acceso..."})}):(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 p-6",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("button",{onClick:()=>e.push("/pos"),className:"text-purple-600 hover:text-purple-800 mb-4",children:"← Volver al POS"}),(0,s.jsxs)("h1",{className:"text-3xl font-bold text-gray-800 flex items-center gap-3",children:[(0,s.jsx)(n.A,{className:"w-8 h-8"}),"Administraci\xf3n de Backups"]}),(0,s.jsx)("p",{className:"text-gray-600 mt-2",children:"Panel exclusivo para SUPERADMIN"})]}),(0,s.jsxs)("div",{className:"flex gap-2 mb-6",children:[(0,s.jsxs)("button",{onClick:()=>p("local"),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ".concat("local"===x?"bg-purple-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"),children:[(0,s.jsx)(i.A,{className:"w-4 h-4"}),"Restaurar Local"]}),(0,s.jsxs)("button",{onClick:()=>p("cloud"),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ".concat("cloud"===x?"bg-purple-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"),children:[(0,s.jsx)(o.A,{className:"w-4 h-4"}),"Backups en la Nube"]})]}),"cloud"===x&&(0,s.jsx)(h,{}),"local"===x&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,s.jsxs)("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[(0,s.jsx)(c.A,{className:"w-5 h-5"}),"Restaurar Backup a Nueva Tienda"]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Seleccionar archivo de backup (.zip)"}),(0,s.jsx)("input",{type:"file",accept:".zip",onChange:function(e){var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){if(!a.name.endsWith(".zip")){m.oR.error("Solo se permiten archivos .zip");return}y(a),N(null)}},disabled:f,className:"block w-full text-sm text-gray-500   file:mr-4 file:py-2 file:px-4   file:rounded-md file:border-0   file:text-sm file:font-semibold   file:bg-purple-50 file:text-purple-700   hover:file:bg-purple-100   disabled:opacity-50 disabled:cursor-not-allowed"}),b&&(0,s.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["Archivo seleccionado: ",(0,s.jsx)("span",{className:"font-medium",children:b.name})]})]}),(0,s.jsxs)("button",{onClick:k,disabled:!b||f,className:"w-full bg-purple-600 text-white py-3 px-4 rounded-lg font-semibold   hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed   flex items-center justify-center gap-2",children:[(0,s.jsx)(c.A,{className:"w-5 h-5"}),f?"Restaurando...":"Restaurar como Nueva Tienda"]}),(0,s.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(d.A,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,s.jsx)("p",{className:"font-semibold mb-1",children:"Qu\xe9 hace esta operaci\xf3n:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside space-y-1",children:[(0,s.jsx)("li",{children:"Crea una nueva tienda con los datos del backup"}),(0,s.jsx)("li",{children:"Genera un OWNER con contrase\xf1a temporal"}),(0,s.jsx)("li",{children:"Preserva todo el historial (ventas, turnos, cuentas)"}),(0,s.jsx)("li",{children:"NO afecta ninguna tienda existente"})]})]})]})}),(0,s.jsx)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(d.A,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"text-sm text-orange-800",children:[(0,s.jsx)("p",{className:"font-semibold mb-1",children:"Seguridad:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside space-y-1",children:[(0,s.jsx)("li",{children:"Valida integridad con checksum SHA-256"}),(0,s.jsx)("li",{children:"Si el email del OWNER ya existe, genera uno alternativo autom\xe1ticamente"}),(0,s.jsx)("li",{children:"El backup NO contiene contrase\xf1as del sistema original"})]})]})]})})]})]}),j&&(0,s.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6 mt-6",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3 mb-4",children:[(0,s.jsx)(u.A,{className:"w-6 h-6 text-green-600 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-green-800",children:"Backup Restaurado Exitosamente"}),(0,s.jsx)("p",{className:"text-sm text-green-700 mt-1",children:j.message})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg p-4 space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Nueva Tienda:"}),(0,s.jsx)("p",{className:"text-lg font-bold text-gray-900",children:j.store.name}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["ID: ",j.store.id]})]}),(0,s.jsxs)("div",{className:"border-t pt-3",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Credenciales del OWNER:"}),(0,s.jsxs)("div",{className:"bg-gray-50 rounded p-3 space-y-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-600",children:"Email:"}),(0,s.jsx)("p",{className:"font-mono text-sm font-semibold text-gray-900",children:j.owner.email})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-600",children:"Contrase\xf1a Temporal:"}),(0,s.jsx)("p",{className:"font-mono text-sm font-semibold text-red-600",children:j.owner.temporaryPassword})]})]})]}),(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded p-3",children:[(0,s.jsx)("p",{className:"text-xs font-semibold text-red-800 mb-1",children:"⚠️ IMPORTANTE:"}),(0,s.jsxs)("p",{className:"text-xs text-red-700",children:[j.warning," Esta informaci\xf3n solo se muestra una vez. Gu\xe1rdala en un lugar seguro y entr\xe9gala al due\xf1o de la tienda para que cambie la contrase\xf1a inmediatamente."]})]})]})]})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[814,8441,1517,7358],()=>t(9084)),_N_E=e.O()}]);