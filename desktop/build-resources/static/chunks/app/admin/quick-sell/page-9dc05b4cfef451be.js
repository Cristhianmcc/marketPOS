(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8161],{8473:(e,r,s)=>{Promise.resolve().then(s.bind(s,8704))},8704:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>h});var a=s(5155),l=s(2115),t=s(9445),o=s(814),i=s(4505),d=s(8474),c=s(1949),n=s(7530),m=s(865),x=s(4055);function h(){let[e,r]=(0,l.useState)([]),[s,h]=(0,l.useState)(!0),[p,u]=(0,l.useState)(!1),[g,b]=(0,l.useState)(8);(0,l.useEffect)(()=>{j()},[]);let j=async()=>{try{h(!0);let e=await fetch("/api/admin/quick-sell");if(!e.ok)throw Error("Error al cargar productos");let s=await e.json();r(s.products)}catch(e){o.oR.error("Error al cargar productos"),console.error(e)}finally{h(!1)}},f=async(s,a)=>{let l=e.filter(e=>e.isQuickSell).length;if(!a&&l>=g){o.oR.error("L\xedmite alcanzado: m\xe1ximo ".concat(g," productos r\xe1pidos"));return}try{if(u(!0),!(await fetch("/api/admin/quick-sell",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:s,isQuickSell:!a})})).ok)throw Error("Error al actualizar");r(e=>e.map(e=>e.id===s?{...e,isQuickSell:!a}:e)),o.oR.success(a?"Producto removido de Quick Sell":"Producto agregado a Quick Sell")}catch(e){o.oR.error("Error al actualizar producto"),console.error(e)}finally{u(!1)}},y=async s=>{if(!s.destination)return;let a=Array.from(e.filter(e=>e.isQuickSell)),[l]=a.splice(s.source.index,1);a.splice(s.destination.index,0,l);let t=a.map((e,r)=>({...e,quickSellOrder:r+1}));r(e=>[...t,...e.filter(e=>!e.isQuickSell)]);try{if(u(!0),!(await fetch("/api/admin/quick-sell/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:t.map(e=>({id:e.id,order:e.quickSellOrder}))})})).ok)throw Error("Error al actualizar orden");o.oR.success("Orden actualizado correctamente")}catch(e){o.oR.error("Error al actualizar orden"),console.error(e),j()}finally{u(!1)}},N=e.filter(e=>e.isQuickSell).sort((e,r)=>null===e.quickSellOrder?1:null===r.quickSellOrder?-1:e.quickSellOrder-r.quickSellOrder),v=e.filter(e=>!e.isQuickSell).sort((e,r)=>r.totalSold-e.totalSold);return s?(0,a.jsx)(t.A,{children:(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)(i.A,{className:"w-8 h-8 animate-spin text-green-600"})})}):(0,a.jsx)(t.A,{children:(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)(d.A,{className:"w-6 h-6 text-green-600"}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Productos R\xe1pidos (Quick Sell)"})]}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Configura los productos que aparecer\xe1n como botones r\xe1pidos en el POS. M\xe1ximo ",g," productos."]}),(0,a.jsx)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Tip:"})," Arrastra los productos marcados para cambiar el orden. Los productos m\xe1s vendidos se sugieren autom\xe1ticamente."]})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["Productos R\xe1pidos (",N.length,"/",g,")"]}),p&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[(0,a.jsx)(i.A,{className:"w-4 h-4 animate-spin"}),(0,a.jsx)("span",{children:"Guardando..."})]})]}),0===N.length?(0,a.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,a.jsx)(c.A,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),(0,a.jsx)("p",{children:"No hay productos marcados como r\xe1pidos"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"Marca productos desde la lista de abajo"})]}):(0,a.jsx)(x.JY,{onDragEnd:y,children:(0,a.jsx)(x.gL,{droppableId:"quick-sell",children:e=>(0,a.jsxs)("div",{...e.droppableProps,ref:e.innerRef,className:"space-y-2",children:[N.map((e,r)=>(0,a.jsx)(x.sx,{draggableId:e.id,index:r,children:(s,l)=>(0,a.jsxs)("div",{ref:s.innerRef,...s.draggableProps,className:"\n                                flex items-center gap-4 p-4 rounded-lg border-2 transition-all\n                                ".concat(l.isDragging?"border-green-500 bg-green-50 shadow-lg":"border-gray-200 bg-white hover:border-gray-300","\n                              "),children:[(0,a.jsx)("div",{...s.dragHandleProps,children:(0,a.jsx)(n.A,{className:"w-5 h-5 text-gray-400 cursor-grab active:cursor-grabbing"})}),(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-green-100 text-green-700 font-bold flex items-center justify-center text-sm",children:r+1}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["S/ ",Number(e.price).toFixed(2)," • ",e.category," • ",e.totalSold," ventas"]})]}),(0,a.jsxs)("button",{onClick:()=>f(e.id,!0),disabled:p,className:"flex items-center gap-2 px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors disabled:opacity-50",children:[(0,a.jsx)(c.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Remover"})]})]})},e.id)),e.placeholder]})})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Productos Disponibles"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Ordenados por cantidad de ventas. Los m\xe1s vendidos est\xe1n primero."}),0===v.length?(0,a.jsx)("div",{className:"text-center py-12 text-gray-500",children:(0,a.jsx)("p",{children:"Todos los productos est\xe1n marcados como r\xe1pidos"})}):(0,a.jsx)("div",{className:"space-y-2 max-h-[500px] overflow-y-auto",children:v.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-4 p-4 rounded-lg border border-gray-200 hover:border-gray-300 transition-all",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["S/ ",Number(e.price).toFixed(2)," • ",e.category," • ",e.totalSold," ventas"]})]}),(0,a.jsxs)("button",{onClick:()=>f(e.id,!1),disabled:p||N.length>=g,className:"flex items-center gap-2 px-4 py-2 bg-green-50 text-green-600 rounded-lg hover:bg-green-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(m.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Marcar"})]})]},e.id))})]})]})})})}}},e=>{var r=r=>e(e.s=r);e.O(0,[1309,814,8173,9121,9027,9445,8441,1517,7358],()=>r(8473)),_N_E=e.O()}]);