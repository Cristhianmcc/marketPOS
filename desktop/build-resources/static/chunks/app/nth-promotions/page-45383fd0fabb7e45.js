(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9524],{3491:(e,r,t)=>{Promise.resolve().then(t.bind(t,7165))},2423:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(7401).A)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},3473:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(7401).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},7165:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>x});var a=t(5155),s=t(2115),o=t(6046),l=t(9445),n=t(3473),c=t(5471);let i=(0,t(7401).A)("percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);var d=t(2423),m=t(767),u=t(814);function x(){(0,o.useRouter)();let[e,r]=(0,s.useState)([]),[t,x]=(0,s.useState)([]),[p,h]=(0,s.useState)(!0),[g,b]=(0,s.useState)(!1),[y,f]=(0,s.useState)(!1),[j,N]=(0,s.useState)(null),[v,w]=(0,s.useState)(!1),[k,E]=(0,s.useState)(null),[A,C]=(0,s.useState)({name:"",productId:"",nthQty:2,percentOff:50,startsAt:"",endsAt:""});(0,s.useEffect)(()=>{S(),P()},[]);let S=async()=>{try{let e=await fetch("/api/nth-promotions");if(!e.ok)throw Error("Error al cargar promociones");let t=await e.json();r(t.promotions||[])}catch(e){console.error(e),u.oR.error("Error al cargar promociones n-\xe9simo")}finally{h(!1)}},P=async()=>{try{let e=await fetch("/api/products");if(!e.ok)throw Error("Error al cargar productos");let r=await e.json();x((r.products||[]).filter(e=>"UNIT"===e.unitType))}catch(e){console.error(e),u.oR.error("Error al cargar productos")}},O=async e=>{if(e.preventDefault(),!A.name.trim()){u.oR.error("Ingresa un nombre para la promoci\xf3n");return}if(!A.productId){u.oR.error("Selecciona un producto");return}if(A.nthQty<2){u.oR.error("El N-\xe9simo debe ser al menos 2");return}if(A.percentOff<=0||A.percentOff>100){u.oR.error("El descuento debe estar entre 0 y 100%");return}f(!0);try{let e=await fetch("/api/nth-promotions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:A.name.trim(),productId:A.productId,nthQty:A.nthQty,percentOff:A.percentOff,startsAt:A.startsAt||null,endsAt:A.endsAt||null})});if(!e.ok){let r=await e.json();throw Error(r.error||"Error al crear promoci\xf3n")}u.oR.success("Promoci\xf3n n-\xe9simo creada"),b(!1),C({name:"",productId:"",nthQty:2,percentOff:50,startsAt:"",endsAt:""}),S()}catch(e){u.oR.error(e.message||"Error al crear promoci\xf3n")}finally{f(!1)}},R=async(e,r)=>{try{if(!(await fetch("/api/nth-promotions/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({active:!r})})).ok)throw Error("Error al actualizar promoci\xf3n");u.oR.success(r?"Promoci\xf3n desactivada":"Promoci\xf3n activada"),S()}catch(e){u.oR.error("Error al actualizar promoci\xf3n")}},I=async()=>{if(k){N(k.id);try{if(!(await fetch("/api/nth-promotions/".concat(k.id),{method:"DELETE"})).ok)throw Error("Error al eliminar promoci\xf3n");u.oR.success("Promoci\xf3n eliminada"),w(!1),E(null),S()}catch(e){u.oR.error("Error al eliminar promoci\xf3n")}finally{N(null)}}},Q=e=>2===e?"2do":3===e?"3ro":4===e?"4to":"".concat(e,"to");return(0,a.jsxs)(l.A,{children:[(0,a.jsx)(u.l$,{position:"top-center",richColors:!0}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Promociones N-\xe9simo"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:'Gestiona promociones tipo "2do al 50%", "3ro gratis", etc.'})]}),(0,a.jsxs)("button",{onClick:()=>b(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,a.jsx)(n.A,{className:"w-5 h-5"}),"Nueva Promoci\xf3n"]})]}),p?(0,a.jsx)("div",{className:"text-center py-12 text-gray-500",children:"Cargando..."}):0===e.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(c.A,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay promociones n-\xe9simo"}),(0,a.jsx)("p",{className:"text-gray-500 mb-6",children:'Crea tu primera promoci\xf3n tipo "2do al 50%" o "3ro gratis"'}),(0,a.jsx)("button",{onClick:()=>b(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Crear Promoci\xf3n"})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>(0,a.jsxs)("div",{className:"p-6 border rounded-lg transition-all ".concat(e.active?"bg-white border-yellow-300 shadow-sm":"bg-gray-50 border-gray-200"),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(c.A,{className:"w-5 h-5 ".concat(e.active?"text-yellow-600":"text-gray-400")}),(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name})]}),(0,a.jsx)("button",{onClick:()=>R(e.id,e.active),className:"px-3 py-1 text-xs rounded-full font-medium ".concat(e.active?"bg-green-100 text-green-700":"bg-gray-200 text-gray-600"),children:e.active?"Activa":"Inactiva"})]}),(0,a.jsxs)("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Producto:"})," ",e.product.name]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-yellow-700 font-semibold text-base",children:[(0,a.jsx)(i,{className:"w-4 h-4"}),Q(e.nthQty)," al ",e.percentOff,"% de descuento"]}),e.startsAt&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(d.A,{className:"w-4 h-4"}),"Desde: ",new Date(e.startsAt).toLocaleDateString()]}),e.endsAt&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(d.A,{className:"w-4 h-4"}),"Hasta: ",new Date(e.endsAt).toLocaleDateString()]})]}),(0,a.jsx)("button",{onClick:()=>{E(e),w(!0)},className:"w-full py-2 text-sm border border-red-300 text-red-600 rounded hover:bg-red-50 transition-colors",children:"Eliminar"})]},e.id))}),g&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Nueva Promoci\xf3n N-\xe9simo"}),(0,a.jsx)("button",{onClick:()=>b(!1),className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(m.A,{className:"w-5 h-5"})})]}),(0,a.jsxs)("form",{onSubmit:O,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre de la promoci\xf3n *"}),(0,a.jsx)("input",{type:"text",value:A.name,onChange:e=>C({...A,name:e.target.value}),placeholder:"Ej: 2do al 50%, 3ro gratis",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Producto (solo UNIT) *"}),(0,a.jsxs)("select",{value:A.productId,onChange:e=>C({...A,productId:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,a.jsx)("option",{value:"",children:"Seleccionar producto"}),t.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," ",e.barcode?"(".concat(e.barcode,")"):""]},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N-\xe9simo (2 = segundo, 3 = tercero, etc.) *"}),(0,a.jsx)("input",{type:"number",min:"2",value:A.nthQty,onChange:e=>C({...A,nthQty:parseInt(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"M\xednimo 2 (segundo producto)"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Porcentaje de descuento (%) *"}),(0,a.jsx)("input",{type:"number",min:"0",max:"100",step:"0.01",value:A.percentOff,onChange:e=>C({...A,percentOff:parseFloat(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"50 = 50% off, 100 = gratis"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vigencia desde (opcional)"}),(0,a.jsx)("input",{type:"date",value:A.startsAt,onChange:e=>C({...A,startsAt:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vigencia hasta (opcional)"}),(0,a.jsx)("input",{type:"date",value:A.endsAt,onChange:e=>C({...A,endsAt:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>b(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",disabled:y,children:"Cancelar"}),(0,a.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-blue-400",disabled:y,children:y?"Creando...":"Crear"})]})]})]})}),v&&k&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Eliminar Promoci\xf3n"}),(0,a.jsxs)("p",{className:"text-gray-600 mb-6",children:['\xbfEst\xe1s seguro de eliminar la promoci\xf3n "',k.name,'"? Esta acci\xf3n no se puede deshacer.']}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>{w(!1),E(null)},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",disabled:null!==j,children:"Cancelar"}),(0,a.jsx)("button",{onClick:I,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-red-400",disabled:null!==j,children:j?"Eliminando...":"Eliminar"})]})]})})]})]})}}},e=>{var r=r=>e(e.s=r);e.O(0,[814,8173,9121,9445,8441,1517,7358],()=>r(3491)),_N_E=e.O()}]);