(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[693],{918:(e,t,r)=>{Promise.resolve().then(r.bind(r,2893))},9053:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(7401).A)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},1594:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(7401).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},8617:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(7401).A)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},4505:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(7401).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},3473:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(7401).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},2118:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(7401).A)("power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]])},1773:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(7401).A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},7780:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(7401).A)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},5381:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(7401).A)("scale",[["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"m19 8 3 8a5 5 0 0 1-6 0zV7",key:"zcdpyk"}],["path",{d:"M3 7h1a17 17 0 0 0 8-2 17 17 0 0 0 8 2h1",key:"1yorad"}],["path",{d:"m5 8 3 8a5 5 0 0 1-6 0zV7",key:"eua70x"}],["path",{d:"M7 21h10",key:"1b0cd5"}]])},6764:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(7401).A)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},6878:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(7401).A)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]])},3950:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(7401).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},8684:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(7401).A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},2792:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(7401).A)("wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]])},2893:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>J});var a=r(5155),s=r(2115),o=r(6046),n=r(9445),i=r(8761),l=r(2792),c=r(7401);let d=(0,c.A)("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),u=(0,c.A)("folder-tree",[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]]);var m=r(3473),x=r(853),p=r(719);let h=(0,c.A)("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);var g=r(6764),b=r(5381),y=r(5471),f=r(6878),j=r(2118),N=r(767),v=r(4505),k=r(3950),w=r(8684);function A(e){let{isOpen:t,onClose:r,onSuccess:o}=e,[n,i]=(0,s.useState)("with-code"),[l,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1),[m,x]=(0,s.useState)(""),[p,h]=(0,s.useState)([]),[g,b]=(0,s.useState)(!1),[y,f]=(0,s.useState)([]),[j,A]=(0,s.useState)(!1),S=(0,s.useRef)(null),[C,E]=(0,s.useState)([]),[T,U]=(0,s.useState)("BODEGA"),[P,F]=(0,s.useState)([]),[I,M]=(0,s.useState)({name:"",unitType:"UNIT",baseUnitId:"",category:"",brand:"",content:"",barcode:"",price:"",stock:"",minStock:"",imageUrl:""}),O=C.length>0?C:["Abarrotes","Bebidas","L\xe1cteos","Carnes","Frutas y Verduras","Panader\xeda","Snacks","Limpieza","Cuidado Personal","Otros"];(0,s.useEffect)(()=>{let e=async()=>{try{var e,t,r;let a=await fetch("/api/store/profile");if(a.ok){let r=await a.json();E(r.categories||[]),U((null===(e=r.store)||void 0===e?void 0:e.businessProfile)||"BODEGA"),(null===(t=r.categories)||void 0===t?void 0:t.length)>0&&!I.category&&M(e=>({...e,category:r.categories[0]}))}let s=await fetch("/api/units?kind=GOODS");if(s.ok){let e=await s.json();if(F(e.units||[]),(null===(r=e.units)||void 0===r?void 0:r.length)>0&&!I.baseUnitId){let t=e.units.find(e=>"UNIT"===e.code)||e.units[0];M(e=>({...e,baseUnitId:t.id,unitType:"KG"===t.code?"KG":"UNIT"}))}}}catch(e){console.error("Error loading store data:",e)}};t&&e()},[t]),(0,s.useEffect)(()=>{t&&"with-code"===n&&S.current&&setTimeout(()=>{var e;null===(e=S.current)||void 0===e||e.focus()},100)},[t,n]),(0,s.useEffect)(()=>{let e=setTimeout(async()=>{if("with-code"===n&&I.barcode&&I.barcode.length>=8)try{let e=await fetch("/api/products/suggest?barcode=".concat(encodeURIComponent(I.barcode)));if(e.ok){let t=await e.json();h(t.suggestions||[]),t.suggestions&&t.suggestions.length>0&&b(!0)}}catch(e){console.error("Error checking duplicates:",e)}else h([]),b(!1)},500);return()=>clearTimeout(e)},[I.barcode,n]),(0,s.useEffect)(()=>{let e=setTimeout(async()=>{if("without-code"===n&&I.name&&I.name.length>=3)try{A(!0);let e=await fetch("/api/products/suggest-fuzzy?q=".concat(encodeURIComponent(I.name),"&limit=5"));if(e.ok){let t=await e.json();f(t||[])}}catch(e){console.error("Error checking fuzzy:",e)}finally{A(!1)}else f([])},700);return()=>clearTimeout(e)},[I.name,n]);let z=async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){if(!["image/jpeg","image/png","image/webp"].includes(r.type)){x("Solo se permiten im\xe1genes JPG, PNG o WEBP");return}if(r.size>5242880){x("La imagen no debe superar 5MB");return}try{u(!0),x("");let e=new FormData;e.append("image",r);let t=await fetch("/api/uploads/product-image",{method:"POST",body:e});if(!t.ok){let e=await t.json();throw Error(e.error||"Error al subir imagen")}let a=await t.json();M(e=>({...e,imageUrl:a.url}))}catch(e){console.error("Error uploading image:",e),x(e instanceof Error?e.message:"Error al subir imagen")}finally{u(!1)}}},D=async e=>{c(!0),x("");try{let t=await fetch("/api/store-products?productId=".concat(e.id));if((await t.json()).exists){x("Este producto ya existe en tu tienda"),c(!1);return}let a=parseFloat(I.price);if(isNaN(a)||a<=0){x("Debes ingresar un precio de venta para tu tienda"),c(!1);return}let s=I.stock&&""!==I.stock.trim()?parseFloat(I.stock):null,n=I.minStock&&""!==I.minStock.trim()?parseFloat(I.minStock):null,i={productId:e.id,price:a,stock:s,minStock:n,active:!0},l=await fetch("/api/store-products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok){let e=await l.json();x(e.error||"Error al configurar producto en tienda"),c(!1);return}o(),r(),L()}catch(e){console.error("Error using fuzzy suggestion:",e),x("Error de conexi\xf3n"),c(!1)}},R=async e=>{e.preventDefault(),c(!0),x("");try{let e=p.find(e=>"exact_barcode"===e.matchType);if(e&&!e.alreadyInStore){let t=parseFloat(I.price);if(isNaN(t)||t<=0){x("El precio debe ser mayor a 0"),c(!1);return}let a=I.stock&&""!==I.stock.trim()?parseFloat(I.stock):null,s=I.minStock&&""!==I.minStock.trim()?parseFloat(I.minStock):null,n={productId:e.id,price:t,stock:a,minStock:s,active:!0},i=await fetch("/api/store-products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok){let e=await i.json();x(e.error||"Error al configurar producto en tienda"),c(!1);return}o(),r(),L();return}if(e&&e.alreadyInStore){x("Este producto ya existe en tu tienda"),c(!1);return}let t=parseFloat(I.price);if(isNaN(t)||t<=0){x("El precio debe ser mayor a 0"),c(!1);return}if("UNIT"===I.unitType&&I.stock){let e=parseFloat(I.stock);if(!Number.isInteger(e)){x("El stock para productos por UNIDAD debe ser un n\xfamero entero"),c(!1);return}}let a={name:I.name,unitType:I.unitType,baseUnitId:I.baseUnitId||null,category:I.category,barcode:"with-code"===n&&I.barcode?I.barcode:null,brand:I.brand||null,content:I.content||null,imageUrl:I.imageUrl||null},s=await fetch("/api/products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),i=await s.json();if(!s.ok){x(i.error||"Error al crear producto"),c(!1);return}let l=I.stock&&""!==I.stock.trim()?parseFloat(I.stock):null,d=I.minStock&&""!==I.minStock.trim()?parseFloat(I.minStock):null,u={productId:i.product.id,price:t,stock:l,minStock:d,active:!0},m=await fetch("/api/store-products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!m.ok){let e=await m.json();x(e.error||"Error al configurar producto en tienda"),c(!1);return}o(),r(),L()}catch(e){console.error("Error creating product:",e),x("Error de conexi\xf3n"),c(!1)}},L=()=>{let e=P.find(e=>"UNIT"===e.code)||P[0];M({name:"",unitType:"UNIT",baseUnitId:(null==e?void 0:e.id)||"",category:O[0]||"Otros",brand:"",content:"",barcode:"",price:"",stock:"",minStock:"",imageUrl:""}),x(""),h([]),b(!1),f([]),A(!1)};return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-[#1F2A37]",children:"Nuevo Producto"}),(0,a.jsx)("button",{onClick:r,className:"p-1 hover:bg-gray-100 rounded-md transition-colors",children:(0,a.jsx)(N.A,{className:"w-5 h-5 text-gray-500"})})]}),(0,a.jsxs)("div",{className:"flex border-b border-gray-200",children:[(0,a.jsx)("button",{onClick:()=>i("with-code"),className:"flex-1 px-4 py-3 text-sm font-medium transition-colors ".concat("with-code"===n?"text-[#16A34A] border-b-2 border-[#16A34A]":"text-gray-500 hover:text-gray-700"),children:"Con c\xf3digo de barras"}),(0,a.jsx)("button",{onClick:()=>i("without-code"),className:"flex-1 px-4 py-3 text-sm font-medium transition-colors ".concat("without-code"===n?"text-[#16A34A] border-b-2 border-[#16A34A]":"text-gray-500 hover:text-gray-700"),children:"Sin c\xf3digo"})]}),(0,a.jsxs)("form",{onSubmit:R,className:"p-4 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-[#1F2A37] mb-2",children:"Nombre *"}),(0,a.jsx)("input",{type:"text",value:I.name,onChange:e=>M({...I,name:e.target.value}),required:!0,className:"w-full h-10 px-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#16A34A]",placeholder:"Ej: Arroz Extra"})]}),"without-code"===n&&I.name.length>=3&&(0,a.jsx)("div",{children:j?(0,a.jsx)("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-md",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(v.A,{className:"w-4 h-4 animate-spin text-gray-600"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Buscando coincidencias..."})]})}):y.length>0?(0,a.jsxs)("div",{className:"p-3 bg-purple-50 border border-purple-200 rounded-md",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-purple-900 mb-2",children:"\uD83D\uDCA1 Productos similares encontrados en el cat\xe1logo:"}),(0,a.jsx)("div",{className:"space-y-2",children:y.map(e=>(0,a.jsx)("div",{className:"p-2 bg-white border border-purple-200 rounded-md hover:border-purple-400 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.name}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-600 mt-0.5",children:[e.brand&&(0,a.jsxs)("span",{children:["\uD83C\uDFF7️ ",e.brand]}),e.content&&(0,a.jsxs)("span",{children:["\uD83D\uDCE6 ",e.content]}),(0,a.jsxs)("span",{className:"text-purple-600 font-medium",children:[Math.round(100*e.similarity),"% similar"]})]})]}),(0,a.jsx)("button",{type:"button",onClick:()=>D(e),disabled:l,className:"flex-shrink-0 px-3 py-1 text-xs font-medium bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 transition-colors",children:"Usar"})]})},e.id))}),(0,a.jsx)("p",{className:"text-xs text-purple-700 mt-2",children:"O contin\xfaa creando uno nuevo si ninguno coincide"})]}):null}),"with-code"===n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-[#1F2A37] mb-2",children:["C\xf3digo de barras *",(0,a.jsx)("span",{className:"text-xs text-gray-500 ml-2",children:"(Puedes usar pistola esc\xe1ner)"})]}),(0,a.jsx)("input",{ref:S,type:"text",value:I.barcode,onChange:e=>M({...I,barcode:e.target.value}),required:"with-code"===n,pattern:"[0-9]{8,14}",className:"w-full h-10 px-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#16A34A]",placeholder:"Escanea o escribe el c\xf3digo",autoComplete:"off"})]}),g&&p.length>0&&(0,a.jsx)("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md",children:(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(k.A,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"Producto encontrado en el cat\xe1logo"}),p.map(e=>(0,a.jsxs)("div",{className:"text-sm text-blue-800 mb-2",children:[(0,a.jsx)("p",{className:"font-medium",children:e.name}),e.brand&&(0,a.jsx)("p",{className:"text-xs",children:e.brand}),e.alreadyInStore?(0,a.jsx)("p",{className:"text-xs text-red-600 font-medium mt-1",children:"⚠️ Ya existe en tu tienda"}):(0,a.jsx)("p",{className:"text-xs text-green-600 font-medium mt-1",children:"✓ Se reutilizar\xe1 este producto. Solo configura tu precio y stock."})]},e.id))]})]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-[#1F2A37] mb-2",children:"Imagen del producto"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[I.imageUrl&&(0,a.jsx)("img",{src:I.imageUrl,alt:"Preview",className:"w-16 h-16 object-cover rounded-md border border-gray-300"}),(0,a.jsxs)("label",{className:"flex-1",children:[(0,a.jsx)("div",{className:"flex items-center justify-center gap-2 h-10 px-4 border border-gray-300 rounded-md cursor-pointer hover:bg-gray-50 transition-colors",children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.A,{className:"w-4 h-4 animate-spin text-gray-600"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Subiendo..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.A,{className:"w-4 h-4 text-gray-600"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:I.imageUrl?"Cambiar imagen":"Subir imagen"})]})}),(0,a.jsx)("input",{type:"file",accept:"image/jpeg,image/png,image/webp",onChange:z,disabled:d,className:"hidden"})]})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"JPG, PNG o WEBP. M\xe1ximo 5MB."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-[#1F2A37] mb-2",children:"Unidad de medida *"}),(0,a.jsx)("select",{value:I.baseUnitId,onChange:e=>{let t=P.find(t=>t.id===e.target.value);M({...I,baseUnitId:e.target.value,unitType:(null==t?void 0:t.code)==="KG"?"KG":"UNIT"})},required:!0,className:"w-full h-10 px-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#16A34A]",children:0===P.length?(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("option",{value:"",children:"Cargando..."})}):P.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.sunatCode?"".concat(e.sunatCode," — "):"",e.displayName||e.name," ",e.symbol?"(".concat(e.symbol,")"):""]},e.id))}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[P.length," unidades SUNAT disponibles"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-[#1F2A37] mb-2",children:"Categor\xeda *"}),(0,a.jsx)("select",{value:I.category,onChange:e=>M({...I,category:e.target.value}),required:!0,className:"w-full h-10 px-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#16A34A]",children:O.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-[#1F2A37] mb-2",children:"Marca"}),(0,a.jsx)("input",{type:"text",value:I.brand,onChange:e=>M({...I,brand:e.target.value}),className:"w-full h-10 px-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#16A34A]",placeholder:"Opcional"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-[#1F2A37] mb-2",children:"Contenido"}),(0,a.jsx)("input",{type:"text",value:I.content,onChange:e=>M({...I,content:e.target.value}),className:"w-full h-10 px-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#16A34A]",placeholder:"Ej: 1kg, 500ml"})]}),(0,a.jsxs)("div",{className:"border-t border-gray-200 pt-4 mt-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-[#1F2A37] mb-3",children:"Configuraci\xf3n para tu tienda"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-[#1F2A37] mb-2",children:"Precio de venta (S/) *"}),(0,a.jsx)("input",{type:"number",step:"0.01",min:"0.01",value:I.price,onChange:e=>M({...I,price:e.target.value}),required:!0,className:"w-full h-10 px-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#16A34A]",placeholder:"Ej: 2.50"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-[#1F2A37] mb-2",children:["Stock inicial ","KG"===I.unitType?"(Opcional)":""]}),(0,a.jsx)("input",{type:"number",step:"UNIT"===I.unitType?"1":"0.01",min:"0",value:I.stock,onChange:e=>M({...I,stock:e.target.value}),className:"w-full h-10 px-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#16A34A]",placeholder:"UNIT"===I.unitType?"Ej: 100":"Ej: 25.5"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-[#1F2A37] mb-2",children:"Stock m\xednimo (Opcional)"}),(0,a.jsx)("input",{type:"number",step:"UNIT"===I.unitType?"1":"0.01",min:"0",value:I.minStock,onChange:e=>M({...I,minStock:e.target.value}),className:"w-full h-10 px-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#16A34A]",placeholder:"Para alertas de stock bajo"})]})]})]}),m&&(0,a.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:m})}),(0,a.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"flex-1 h-10 px-4 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"}),(0,a.jsx)("button",{type:"submit",disabled:l,className:"flex-1 h-10 px-4 bg-[#16A34A] text-white rounded-md text-sm font-medium hover:bg-[#15803d] disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:l?"Creando...":"Crear Producto"})]})]})]})}):null}function S(e){var t;let{isOpen:r,onClose:o,onSuccess:n,storeProduct:i}=e,[l,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(""),[m,x]=(0,s.useState)(i.price.toString()),p=async e=>{e.preventDefault(),c(!0),u("");try{let e=await fetch("/api/store-products/".concat(i.id,"/price"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({price:parseFloat(m)})}),t=await e.json();if(!e.ok){u(t.error||"Error al actualizar precio"),c(!1);return}n(),o()}catch(e){console.error("Error updating price:",e),u("Error de conexi\xf3n"),c(!1)}};return r?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-[#1F2A37]",children:"Editar Precio"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:(null===(t=i.product)||void 0===t?void 0:t.name)||"Producto"})]}),(0,a.jsx)("button",{onClick:o,className:"p-1 hover:bg-gray-100 rounded-md transition-colors",children:(0,a.jsx)(N.A,{className:"w-5 h-5 text-gray-500"})})]}),(0,a.jsxs)("form",{onSubmit:p,className:"p-4 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-[#1F2A37] mb-2",children:"Precio actual"}),(0,a.jsxs)("div",{className:"text-2xl font-semibold text-[#1F2A37]",children:["S/ ",i.price.toFixed(2)]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-[#1F2A37] mb-2",children:"Nuevo precio (S/) *"}),(0,a.jsx)("input",{type:"number",step:"0.01",min:"0.01",value:m,onChange:e=>x(e.target.value),required:!0,className:"w-full h-10 px-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#16A34A]",placeholder:"0.00"})]}),d&&(0,a.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:d})}),(0,a.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,a.jsx)("button",{type:"button",onClick:o,className:"flex-1 h-10 px-4 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"}),(0,a.jsx)("button",{type:"submit",disabled:l,className:"flex-1 h-10 px-4 bg-[#16A34A] text-white rounded-md text-sm font-medium hover:bg-[#15803d] disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:l?"Guardando...":"Guardar"})]})]})]})}):null}function C(e){var t,r;let{isOpen:o,onClose:n,onSuccess:i,storeProduct:l}=e,[c,d]=(0,s.useState)(!1),[u,m]=(0,s.useState)(""),[x,p]=(0,s.useState)("PURCHASE"),[h,g]=(0,s.useState)(""),[b,y]=(0,s.useState)(""),[f,j]=(0,s.useState)(""),v=async e=>{e.preventDefault(),d(!0),m("");try{let e=parseFloat(h),t={type:x,quantity:e,unitPrice:b?parseFloat(b):null,total:b&&h?parseFloat(b)*parseFloat(h):null,notes:f||null},r=await fetch("/api/store-products/".concat(l.id,"/stock"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await r.json();if(!r.ok){m(a.error||"Error al actualizar stock"),d(!1);return}i(),n(),k()}catch(e){console.error("Error updating stock:",e),m("Error de conexi\xf3n"),d(!1)}},k=()=>{p("PURCHASE"),g(""),y(""),j(""),m("")};if(!o)return null;let w=(null===(t=l.product)||void 0===t?void 0:t.unitType)==="UNIT";return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-[#1F2A37]",children:"Movimiento de Stock"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:(null===(r=l.product)||void 0===r?void 0:r.name)||"Producto"})]}),(0,a.jsx)("button",{onClick:n,className:"p-1 hover:bg-gray-100 rounded-md transition-colors",children:(0,a.jsx)(N.A,{className:"w-5 h-5 text-gray-500"})})]}),(0,a.jsxs)("form",{onSubmit:v,className:"p-4 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-[#1F2A37] mb-2",children:"Stock actual"}),(0,a.jsx)("div",{className:"text-2xl font-semibold text-[#1F2A37]",children:null!==l.stock?(0,a.jsxs)(a.Fragment,{children:[l.stock," ",w?"unidades":"kg"]}):"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-[#1F2A37] mb-2",children:"Tipo de movimiento *"}),(0,a.jsxs)("select",{value:x,onChange:e=>p(e.target.value),required:!0,className:"w-full h-10 px-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#16A34A]",children:[(0,a.jsx)("option",{value:"PURCHASE",children:"Entrada (Compra)"}),(0,a.jsx)("option",{value:"ADJUSTMENT",children:"Ajuste"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"PURCHASE"===x?"Ingreso de mercader\xeda nueva":"Correcci\xf3n de stock (positivo/negativo)"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-[#1F2A37] mb-2",children:"Cantidad *"}),(0,a.jsx)("input",{type:"number",step:w?"1":"0.01",value:h,onChange:e=>g(e.target.value),required:!0,className:"w-full h-10 px-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#16A34A]",placeholder:"ADJUSTMENT"===x?"Positivo o negativo":w?"1":"0.00"}),w&&(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Productos por unidad deben ser enteros"})]}),"PURCHASE"===x&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-[#1F2A37] mb-2",children:"Precio unitario (S/)"}),(0,a.jsx)("input",{type:"number",step:"0.01",min:"0",value:b,onChange:e=>y(e.target.value),className:"w-full h-10 px-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#16A34A]",placeholder:"Opcional"})]}),b&&h&&(0,a.jsx)("div",{className:"p-3 bg-gray-50 rounded-md",children:(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Total:"}),(0,a.jsxs)("span",{className:"font-semibold text-[#1F2A37]",children:["S/ ",(parseFloat(b)*parseFloat(h)).toFixed(2)]})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-[#1F2A37] mb-2",children:"Notas"}),(0,a.jsx)("textarea",{value:f,onChange:e=>j(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#16A34A] resize-none",placeholder:"Observaciones opcionales"})]}),u&&(0,a.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:u})}),(0,a.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,a.jsx)("button",{type:"button",onClick:n,className:"flex-1 h-10 px-4 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"}),(0,a.jsx)("button",{type:"submit",disabled:c,className:"flex-1 h-10 px-4 bg-[#16A34A] text-white rounded-md text-sm font-medium hover:bg-[#15803d] disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:c?"Guardando...":"Aplicar"})]})]})]})})}var E=r(1773);let T=(0,c.A)("toggle-right",[["circle",{cx:"15",cy:"12",r:"3",key:"1afu0r"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]]),U=(0,c.A)("toggle-left",[["circle",{cx:"9",cy:"12",r:"3",key:"u3jwor"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]]);var P=r(5686);function F(e){var t;let{isOpen:r,onClose:o,productId:n,productName:i}=e,[l,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!0),[x,p]=(0,s.useState)(""),[h,g]=(0,s.useState)(""),[y,f]=(0,s.useState)([]),[j,k]=(0,s.useState)([]),[w,A]=(0,s.useState)(null),[S,C]=(0,s.useState)("UNIT"),[F,I]=(0,s.useState)(""),[M,O]=(0,s.useState)("");(0,s.useEffect)(()=>{r&&n&&z()},[r,n]);let z=async()=>{u(!0),p("");try{let e=await fetch("/api/units");if(e.ok){let t=await e.json();f(t.units||[])}let t=await fetch("/api/units/products/".concat(n,"/conversions"));if(t.ok){let e=await t.json();k(e.conversions||[]),A(e.baseUnit||null),C(e.baseUnitCode||"UNIT")}let r=await fetch("/api/units/products/".concat(n,"/base-unit"));if(r.ok){let e=await r.json();e.baseUnit&&A(e.baseUnit)}}catch(e){console.error("Error loading data:",e),p("Error al cargar datos")}finally{u(!1)}},D=async e=>{c(!0),p(""),g("");try{let t=await fetch("/api/units/products/".concat(n,"/base-unit"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({baseUnitId:e})});if(!t.ok){let e=await t.json();throw Error(e.error||"Error al actualizar unidad base")}let r=await t.json();A(r.baseUnit),g("Unidad base actualizada"),z()}catch(e){p(e instanceof Error?e.message:"Error al actualizar")}finally{c(!1)}},R=async e=>{if(e.preventDefault(),!F||!M){p("Selecciona una unidad y escribe el factor");return}let t=parseFloat(M);if(isNaN(t)||t<=0){p("El factor debe ser un n\xfamero positivo");return}c(!0),p(""),g("");try{let e=await fetch("/api/units/products/".concat(n,"/conversions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromUnitId:F,factor:t})});if(!e.ok){let t=await e.json();throw Error(t.error||"Error al crear conversi\xf3n")}g("Conversi\xf3n creada"),I(""),O(""),z()}catch(e){p(e instanceof Error?e.message:"Error al crear conversi\xf3n")}finally{c(!1)}},L=async(e,t)=>{c(!0),p("");try{let r=await fetch("/api/units/products/".concat(n,"/conversions"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversionId:e,active:t})});if(!r.ok){let e=await r.json();throw Error(e.error||"Error al actualizar")}z()}catch(e){p(e instanceof Error?e.message:"Error")}finally{c(!1)}},G=async e=>{if(window.confirm("\xbfEliminar esta conversi\xf3n?")){c(!0),p("");try{let t=await fetch("/api/units/products/".concat(n,"/conversions?conversionId=").concat(e),{method:"DELETE"});if(!t.ok){let e=await t.json();throw Error(e.error||"Error al eliminar")}g("Conversi\xf3n eliminada"),z()}catch(e){p(e instanceof Error?e.message:"Error")}finally{c(!1)}}},q=y.filter(e=>e.id!==(null==w?void 0:w.id));return r?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(b.A,{className:"w-5 h-5 text-indigo-600"}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Unidades y Conversiones"})]}),(0,a.jsx)("button",{onClick:o,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:(0,a.jsx)(N.A,{className:"w-5 h-5 text-gray-500"})})]}),(0,a.jsxs)("div",{className:"p-4 space-y-6",children:[(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-3",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Producto:"}),(0,a.jsx)("p",{className:"font-medium text-gray-900 dark:text-white",children:i})]}),d?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsx)(v.A,{className:"w-6 h-6 animate-spin text-gray-400"})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Unidad Base (stock)"}),(0,a.jsxs)("select",{value:(null==w?void 0:w.id)||"",onChange:e=>D(e.target.value),disabled:l,className:"w-full h-10 px-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[(0,a.jsx)("option",{value:"",children:"Seleccionar unidad base"}),y.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," (",e.code,")"]},e.id))]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["El stock se medir\xe1 en esta unidad. Actual: ",S]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Conversiones"}),(0,a.jsx)("button",{onClick:z,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",title:"Refrescar",children:(0,a.jsx)(E.A,{className:"w-4 h-4 text-gray-500"})})]}),0===j.length?(0,a.jsx)("p",{className:"text-sm text-gray-500 italic py-4 text-center",children:"No hay conversiones configuradas"}):(0,a.jsx)("div",{className:"space-y-2",children:j.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border ".concat(e.active?"border-indigo-200 bg-indigo-50 dark:border-indigo-800 dark:bg-indigo-950":"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-900 opacity-60"),children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("p",{className:"font-medium text-gray-900 dark:text-white",children:["1 ",e.fromUnit.code," = ",e.factor," ",e.toUnit.code]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[e.fromUnit.name," → ",e.toUnit.name]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>L(e.id,!e.active),disabled:l,className:"p-1 hover:bg-white dark:hover:bg-gray-800 rounded transition-colors",title:e.active?"Desactivar":"Activar",children:e.active?(0,a.jsx)(T,{className:"w-5 h-5 text-indigo-600"}):(0,a.jsx)(U,{className:"w-5 h-5 text-gray-400"})}),(0,a.jsx)("button",{onClick:()=>G(e.id),disabled:l,className:"p-1 hover:bg-red-100 dark:hover:bg-red-900 rounded transition-colors",title:"Eliminar",children:(0,a.jsx)(P.A,{className:"w-4 h-4 text-red-600"})})]})]},e.id))})]}),w&&(0,a.jsxs)("form",{onSubmit:R,className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Agregar Conversi\xf3n"}),(0,a.jsxs)("div",{className:"flex items-end gap-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"De unidad"}),(0,a.jsxs)("select",{value:F,onChange:e=>I(e.target.value),disabled:l,className:"w-full h-9 px-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[(0,a.jsx)("option",{value:"",children:"Seleccionar..."}),q.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.code," - ",e.name]},e.id))]})]}),(0,a.jsxs)("div",{className:"w-20",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Factor"}),(0,a.jsx)("input",{type:"number",step:"any",min:"0.001",value:M,onChange:e=>O(e.target.value),disabled:l,className:"w-full h-9 px-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"12"})]}),(0,a.jsxs)("div",{className:"w-24",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"A unidad"}),(0,a.jsx)("div",{className:"h-9 px-2 flex items-center text-sm bg-gray-100 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-md text-gray-600 dark:text-gray-400",children:w.code})]}),(0,a.jsx)("button",{type:"submit",disabled:l||!F||!M,className:"h-9 px-3 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,a.jsx)(m.A,{className:"w-4 h-4"})})]}),F&&M&&(0,a.jsxs)("div",{className:"mt-2 p-2 bg-indigo-50 dark:bg-indigo-950 rounded-md text-sm text-indigo-700 dark:text-indigo-300",children:["1 ",(null===(t=y.find(e=>e.id===F))||void 0===t?void 0:t.code)||"?"," = ",M," ",w.code]})]})]}),x&&(0,a.jsx)("div",{className:"p-3 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-md text-sm text-red-700 dark:text-red-300",children:x}),h&&(0,a.jsx)("div",{className:"p-3 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded-md text-sm text-green-700 dark:text-green-300",children:h})]}),(0,a.jsx)("div",{className:"flex justify-end p-4 border-t border-gray-200 dark:border-gray-700",children:(0,a.jsx)("button",{onClick:o,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:"Cerrar"})})]})}):null}var I=r(8617),M=r(1594),O=r(7780),z=r(4807);function D(e){let{productMasterId:t,productName:r,baseUnit:o,basePrice:n,onClose:i,compact:l=!1}=e,[c,d]=(0,s.useState)([]),[u,m]=(0,s.useState)([]),[x,p]=(0,s.useState)(!0),[h,g]=(0,s.useState)(null),[b,f]=(0,s.useState)(null),[j,v]=(0,s.useState)(null),[k,w]=(0,s.useState)(""),[A,S]=(0,s.useState)(""),C=(0,s.useCallback)(async()=>{try{let e=await fetch("/api/units/conversions?productMasterId=".concat(t));if(!e.ok){if(403===e.status){d([]);return}throw Error("Error al cargar conversiones")}let r=await e.json();d((r.conversions||[]).filter(e=>e.active))}catch(e){console.error("Error loading conversions:",e)}},[t]),T=(0,s.useCallback)(async()=>{try{p(!0),f(null);let e=await fetch("/api/units/sell-prices?productMasterId=".concat(t));if(!e.ok){if(403===e.status){f("Los precios por unidad de venta no est\xe1n habilitados");return}throw Error("Error al cargar precios")}let r=await e.json();m(r.prices||[])}catch(e){f(e.message)}finally{p(!1)}},[t]);(0,s.useEffect)(()=>{C(),T()},[C,T]);let U=(0,s.useMemo)(()=>{let e=new Map;return u.forEach(t=>e.set(t.sellUnitId,t)),e},[u]),P=(0,s.useCallback)(e=>Math.round(e*n*100)/100,[n]),F=async e=>{let r=parseFloat(k);if(isNaN(r)||r<0){f("Ingresa un precio v\xe1lido");return}try{g(e),f(null);let a=U.get(e);if(a){let e=await fetch("/api/units/sell-prices/".concat(a.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({price:r,notes:A.trim()||null,active:r>0})});if(!e.ok){let t=await e.json();throw Error(t.error||"Error al actualizar")}}else{let a=await fetch("/api/units/sell-prices",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productMasterId:t,sellUnitId:e,price:r,notes:A.trim()||null})});if(!a.ok){let e=await a.json();throw Error(e.error||"Error al crear")}}await T(),v(null),w(""),S("")}catch(e){f(e.message)}finally{g(null)}},D=async e=>{let t=U.get(e);if(t)try{g(e),f(null);let r=await fetch("/api/units/sell-prices/".concat(t.id),{method:"DELETE"});if(!r.ok){let e=await r.json();throw Error(e.error||"Error al eliminar")}await T()}catch(e){f(e.message)}finally{g(null)}},R=(e,t,r)=>{v(e),w((null==t?void 0:t.toString())||""),S(r||"")};return x?(0,a.jsxs)("div",{className:"p-4 text-center text-gray-500",children:[(0,a.jsx)(E.A,{className:"w-5 h-5 animate-spin mx-auto mb-2"}),"Cargando precios..."]}):0===c.length?(0,a.jsxs)("div",{className:"".concat(l?"":"bg-white rounded-lg border border-gray-200 p-4"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-amber-600 mb-2",children:[(0,a.jsx)(I.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"Sin unidades alternativas"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Primero configura conversiones de unidades para poder asignar precios por presentaci\xf3n."}),i&&(0,a.jsx)("button",{onClick:i,className:"mt-3 px-3 py-1.5 text-sm text-gray-600 hover:bg-gray-100 rounded",children:"Cerrar"})]}):(0,a.jsxs)("div",{className:"".concat(l?"":"bg-white rounded-lg border border-gray-200 p-4"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[(0,a.jsx)(y.A,{className:"w-5 h-5 text-green-600"}),"Precios por Presentaci\xf3n"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[r," — Precio base: S/ ",n.toFixed(2)," / ",(null==o?void 0:o.symbol)||"und"]})]}),i&&(0,a.jsx)("button",{onClick:i,className:"p-1 hover:bg-gray-100 rounded",children:(0,a.jsx)(N.A,{className:"w-5 h-5 text-gray-500"})})]}),(0,a.jsxs)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-700",children:[(0,a.jsx)("strong",{children:"Precio especial:"})," Define un precio fijo por presentaci\xf3n en lugar del precio calculado. El precio especial aplica ANTES de promociones y descuentos."]}),b&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[(0,a.jsx)(M.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm",children:b}),(0,a.jsx)("button",{onClick:()=>f(null),className:"ml-auto",children:(0,a.jsx)(N.A,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"space-y-2",children:c.map(e=>{let t=U.get(e.fromUnitId),r=P(e.factorToBase),s=t&&t.active,n=j===e.fromUnitId,i=h===e.fromUnitId;return(0,a.jsx)("div",{className:"p-3 rounded-lg border ".concat(s?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"font-medium text-gray-900",children:[e.fromUnit.displayName||e.fromUnit.sunatCode,(0,a.jsxs)("span",{className:"text-gray-400 text-sm ml-2",children:["(",e.factorToBase," ",(null==o?void 0:o.symbol)||"und",")"]})]}),n?(0,a.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-gray-500",children:"S/"}),(0,a.jsx)("input",{type:"number",step:"0.01",min:"0",value:k,onChange:e=>w(e.target.value),className:"w-24 pl-7 pr-2 py-1 border rounded text-sm",placeholder:r.toFixed(2),autoFocus:!0})]}),(0,a.jsx)("input",{type:"text",value:A,onChange:e=>S(e.target.value),className:"flex-1 px-2 py-1 border rounded text-sm",placeholder:"Notas (opcional)",maxLength:100}),(0,a.jsx)("button",{onClick:()=>F(e.fromUnitId),disabled:i,className:"p-1.5 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",children:i?(0,a.jsx)(E.A,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(O.A,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>v(null),className:"p-1.5 text-gray-500 hover:bg-gray-200 rounded",children:(0,a.jsx)(N.A,{className:"w-4 h-4"})})]}):(0,a.jsx)("div",{className:"mt-1 flex items-center gap-3",children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("span",{className:"text-lg font-bold text-green-700",children:["S/ ",Number(t.price).toFixed(2)]}),(0,a.jsxs)("span",{className:"text-sm text-gray-400 line-through",children:["S/ ",r.toFixed(2)]}),r>Number(t.price)&&(0,a.jsxs)("span",{className:"text-xs bg-green-100 text-green-700 px-1.5 py-0.5 rounded",children:["Ahorro: S/ ",(r-Number(t.price)).toFixed(2)]}),t.notes&&(0,a.jsx)("span",{className:"text-xs text-gray-500 italic",children:t.notes})]}):(0,a.jsxs)("span",{className:"text-gray-600",children:["S/ ",r.toFixed(2),(0,a.jsx)("span",{className:"text-xs text-gray-400 ml-1",children:"(calculado)"})]})})]}),!n&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("button",{onClick:()=>R(e.fromUnitId,s?Number(t.price):void 0,null==t?void 0:t.notes),className:"p-2 text-blue-600 hover:bg-blue-50 rounded",title:s?"Editar precio":"Agregar precio especial",children:(0,a.jsx)(z.A,{className:"w-4 h-4"})}),s&&(0,a.jsx)("button",{onClick:()=>D(e.fromUnitId),disabled:i,className:"p-2 text-red-500 hover:bg-red-50 rounded",title:"Quitar precio especial",children:i?(0,a.jsx)(E.A,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(N.A,{className:"w-4 h-4"})})]})]})},e.id)})}),(0,a.jsxs)("div",{className:"mt-4 pt-3 border-t text-sm text-gray-500",children:[u.filter(e=>e.active).length," de ",c.length," presentaciones con precio especial"]})]})}function R(e){let{isOpen:t,onClose:r,storeProductId:o,productId:n,productName:i,basePrice:l}=e,[c,d]=(0,s.useState)(!0),[u,m]=(0,s.useState)(null);(0,s.useEffect)(()=>{t&&n&&x()},[t,n]);let x=async()=>{d(!0);try{let e=await fetch("/api/units/products/".concat(n,"/base-unit"));if(e.ok){let t=await e.json();m(t.baseUnit||null)}}catch(e){console.error("Error loading base unit:",e)}finally{d(!1)}};return t?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full max-h-[90vh] overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-6 py-4 border-b flex items-center justify-between bg-gradient-to-r from-green-50 to-white",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,a.jsx)(y.A,{className:"w-5 h-5 text-green-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Precios por Presentaci\xf3n"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:i})]})]}),(0,a.jsx)("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,a.jsx)(N.A,{className:"w-5 h-5 text-gray-500"})})]}),(0,a.jsx)("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-80px)]",children:c?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsx)(E.A,{className:"w-6 h-6 animate-spin text-gray-400"})}):(0,a.jsx)(D,{productMasterId:n,productName:i,baseUnit:u,basePrice:l,compact:!0})}),(0,a.jsx)("div",{className:"px-6 py-4 border-t bg-gray-50",children:(0,a.jsx)("button",{onClick:r,className:"w-full py-2 px-4 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition-colors",children:"Cerrar"})})]})}):null}function L(e){let{isOpen:t,onClose:r,onConfirm:s,title:o,message:n,confirmText:i="Aceptar",cancelText:l="Cancelar",confirmColor:c="blue"}=e;return t?(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:r}),(0,a.jsxs)("div",{className:"relative bg-white rounded-lg shadow-xl w-full max-w-md mx-4 p-6 animate-in fade-in zoom-in duration-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:o}),(0,a.jsx)("button",{onClick:r,className:"p-1 hover:bg-gray-100 rounded-md transition-colors",children:(0,a.jsx)(N.A,{className:"w-5 h-5 text-gray-500"})})]}),(0,a.jsx)("p",{className:"text-gray-600 mb-6 whitespace-pre-line",children:n}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,a.jsx)("button",{onClick:r,className:"px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-md transition-colors",children:l}),(0,a.jsx)("button",{onClick:()=>{s(),r()},className:"px-4 py-2 text-sm font-medium text-white rounded-md transition-colors ".concat({blue:"bg-blue-600 hover:bg-blue-700",green:"bg-green-600 hover:bg-green-700",red:"bg-red-600 hover:bg-red-700"}[c]),children:i})]})]})]}):null}var G=r(814),q=r(5273);function J(){let e=(0,o.useRouter)(),[t,r]=(0,s.useState)([]),[c,N]=(0,s.useState)(!0),[v,k]=(0,s.useState)(null),[w,E]=(0,s.useState)(""),[T,U]=(0,s.useState)(""),[P,I]=(0,s.useState)(!1),[M,O]=(0,s.useState)(!0),[z,D]=(0,s.useState)(!1),[J,B]=(0,s.useState)({open:!1}),[H,_]=(0,s.useState)({open:!1}),[V,K]=(0,s.useState)({open:!1}),[W,Y]=(0,s.useState)({open:!1}),[Z,Q]=(0,s.useState)({open:!1}),{isOn:$}=(0,q.D0)(),X=$("ENABLE_ADVANCED_UNITS"),ee=$("ENABLE_CONVERSIONS"),et=$("ENABLE_SELLUNIT_PRICING"),er=$("ENABLE_SERVICES");(0,s.useEffect)(()=>{ea()},[]),(0,s.useEffect)(()=>{v&&es()},[v,w,T,P,M]);let ea=async()=>{try{let e=await fetch("/api/auth/me");if(e.ok){let t=await e.json();k(t.user)}}catch(e){console.error("Error fetching user:",e)}},es=async()=>{try{N(!0);let e=new URLSearchParams;w&&e.append("query",w),T&&e.append("category",T),P&&e.append("lowStock","true"),null!==M&&e.append("active",M.toString());let t=await fetch("/api/inventory?".concat(e.toString())),a=await t.json();r(a.products||[])}catch(e){console.error("Error loading products:",e),G.oR.error("Error al cargar productos")}finally{N(!1)}},eo=async e=>{try{let t=await fetch("/api/store-products/".concat(e.id,"/active"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({active:!e.active})});if(t.ok)G.oR.success(e.active?"Producto desactivado":"Producto activado"),es();else{let e=await t.json();G.oR.error(e.error||"Error al cambiar estado")}}catch(e){console.error("Error toggling active:",e),G.oR.error("Error de conexi\xf3n")}},en=async(e,t)=>{K({open:!0,productId:e,productName:t})},ei=async()=>{let{productId:e,productName:t}=V;if(e)try{let t=await fetch("/api/catalog/publish",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:e})}),r=await t.json();t.ok?(G.oR.success("Producto compartido al cat\xe1logo global"),es()):G.oR.error(r.error||"Error al compartir producto")}catch(e){console.error("Error sharing product:",e),G.oR.error("Error de conexi\xf3n")}},el=Array.from(new Set(t.map(e=>e.product.category))).filter(Boolean),ec=(null==v?void 0:v.role)==="OWNER";return(0,a.jsxs)(n.A,{storeName:"Inventario",children:[(0,a.jsx)(i.A,{}),(0,a.jsx)(G.l$,{position:"top-right",richColors:!0}),(0,a.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-[#1F2A37]",children:"Gesti\xf3n de Inventario"}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[t.length," productos en tu tienda"]})]}),ec&&(0,a.jsxs)("div",{className:"flex gap-2",children:[er&&(0,a.jsxs)("button",{onClick:()=>e.push("/inventory/services"),className:"h-10 px-4 border border-indigo-300 bg-indigo-50 rounded-md text-sm font-medium text-indigo-700 hover:bg-indigo-100 transition-colors flex items-center gap-2",children:[(0,a.jsx)(l.A,{className:"w-4 h-4"}),"Servicios"]}),(0,a.jsxs)("button",{onClick:()=>e.push("/admin/catalog"),className:"h-10 px-4 border border-blue-300 bg-blue-50 rounded-md text-sm font-medium text-blue-700 hover:bg-blue-100 transition-colors flex items-center gap-2",children:[(0,a.jsx)(d,{className:"w-4 h-4"}),"Cat\xe1logo Global"]}),(0,a.jsxs)("button",{onClick:()=>e.push("/inventory/categories"),className:"h-10 px-4 border border-amber-300 bg-amber-50 rounded-md text-sm font-medium text-amber-700 hover:bg-amber-100 transition-colors flex items-center gap-2",children:[(0,a.jsx)(u,{className:"w-4 h-4"}),"Categor\xedas"]}),(0,a.jsx)("button",{onClick:()=>e.push("/inventory/import"),className:"h-10 px-4 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:"Importar CSV"}),(0,a.jsxs)("button",{onClick:()=>D(!0),className:"h-10 px-4 bg-[#16A34A] text-white rounded-md text-sm font-medium hover:bg-[#15803d] transition-colors flex items-center gap-2",children:[(0,a.jsx)(m.A,{className:"w-4 h-4"}),"Nuevo Producto"]})]})]}),(0,a.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 mb-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,a.jsx)("input",{type:"text",value:w,onChange:e=>E(e.target.value),placeholder:"Buscar por nombre, c\xf3digo...",className:"w-full h-10 pl-10 pr-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#16A34A]"})]}),(0,a.jsxs)("select",{value:T,onChange:e=>U(e.target.value),className:"h-10 px-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#16A34A]",children:[(0,a.jsx)("option",{value:"",children:"Todas las categor\xedas"}),el.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"lowStock",checked:P,onChange:e=>I(e.target.checked),className:"w-4 h-4 text-[#16A34A] border-gray-300 rounded focus:ring-[#16A34A]"}),(0,a.jsx)("label",{htmlFor:"lowStock",className:"text-sm text-[#1F2A37]",children:"Stock bajo"})]}),(0,a.jsxs)("select",{value:null===M?"":M.toString(),onChange:e=>O(""===e.target.value?null:"true"===e.target.value),className:"h-10 px-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#16A34A]",children:[(0,a.jsx)("option",{value:"true",children:"Activos"}),(0,a.jsx)("option",{value:"false",children:"Inactivos"}),(0,a.jsx)("option",{value:"",children:"Todos"})]})]})}),c?(0,a.jsx)("div",{className:"text-center py-12 text-gray-500",children:"Cargando productos..."}):0===t.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:w||T||P?"No se encontraron productos con esos filtros":"No tienes productos en tu inventario"}),ec&&(0,a.jsx)("button",{onClick:()=>D(!0),className:"h-10 px-4 bg-[#16A34A] text-white rounded-md text-sm font-medium hover:bg-[#15803d] transition-colors",children:"Crear primer producto"})]}):(0,a.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Producto"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Categor\xeda"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"C\xf3digo"}),(0,a.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Unidad"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Precio"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Stock"}),(0,a.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Estado"}),ec&&(0,a.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:t.map(e=>{let t="UNIT"===e.product.unitType&&null!==e.stock&&null!==e.minStock&&e.stock<=e.minStock;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[e.product.imageUrl?(0,a.jsx)("img",{src:e.product.imageUrl,alt:e.product.name,className:"w-12 h-12 rounded object-cover flex-shrink-0"}):(0,a.jsx)("div",{className:"w-12 h-12 rounded bg-gray-100 flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(p.A,{className:"w-6 h-6 text-gray-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-[#1F2A37]",children:e.product.name}),e.product.brand&&(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[e.product.brand,e.product.content&&" • ".concat(e.product.content)]})]})]})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.product.category}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("div",{className:"text-xs text-gray-600 font-mono",children:e.product.barcode||e.product.internalSku})}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-gray-100 text-xs font-medium text-gray-700",children:"UNIT"===e.product.unitType?"Unidad":"KG"})}),(0,a.jsxs)("td",{className:"px-4 py-3 text-right text-sm font-medium text-[#1F2A37]",children:["S/ ",e.price.toFixed(2)]}),(0,a.jsx)("td",{className:"px-4 py-3 text-right",children:null!==e.stock?(0,a.jsxs)("span",{className:"text-sm font-medium ".concat(t?"text-red-600":"text-[#1F2A37]"),children:[e.stock,null!==e.minStock&&(0,a.jsxs)("span",{className:"text-xs text-gray-500 ml-1",children:["/ ",e.minStock]})]}):(0,a.jsx)("span",{className:"text-sm text-gray-400",children:"—"})}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium ".concat(e.active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"),children:e.active?"Activo":"Inactivo"})}),ec&&(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[!e.product.isGlobal&&(0,a.jsx)("button",{onClick:()=>en(e.product.id,e.product.name),className:"p-1 hover:bg-blue-50 rounded-md transition-colors",title:"Compartir al cat\xe1logo global",children:(0,a.jsx)(h,{className:"w-4 h-4 text-blue-600"})}),e.product.isGlobal&&(0,a.jsx)("div",{className:"px-2 py-1 bg-blue-50 rounded-md",title:"Ya compartido globalmente",children:(0,a.jsx)(d,{className:"w-4 h-4 text-blue-600"})}),(0,a.jsx)("button",{onClick:()=>B({open:!0,storeProduct:e}),className:"p-1 hover:bg-gray-100 rounded-md transition-colors",title:"Editar precio",children:(0,a.jsx)(g.A,{className:"w-4 h-4 text-gray-600"})}),X&&ee&&(0,a.jsx)("button",{onClick:()=>Y({open:!0,productId:e.product.id,productName:e.product.name}),className:"p-1 hover:bg-indigo-50 rounded-md transition-colors",title:"Unidades y conversiones",children:(0,a.jsx)(b.A,{className:"w-4 h-4 text-indigo-600"})}),ee&&et&&(0,a.jsx)("button",{onClick:()=>Q({open:!0,storeProductId:e.id,productId:e.product.id,productName:e.product.name,price:e.price}),className:"p-1 hover:bg-green-50 rounded-md transition-colors",title:"Precios por presentaci\xf3n",children:(0,a.jsx)(y.A,{className:"w-4 h-4 text-green-600"})}),(0,a.jsx)("button",{onClick:()=>_({open:!0,storeProduct:e}),className:"p-1 hover:bg-gray-100 rounded-md transition-colors",title:"Movimiento de stock",children:(0,a.jsx)(f.A,{className:"w-4 h-4 text-gray-600"})}),(0,a.jsx)("button",{onClick:()=>eo(e),className:"p-1 hover:bg-gray-100 rounded-md transition-colors",title:e.active?"Desactivar":"Activar",children:(0,a.jsx)(j.A,{className:"w-4 h-4 ".concat(e.active?"text-green-600":"text-gray-400")})})]})})]},e.id)})})]})})})]})}),(0,a.jsx)(A,{isOpen:z,onClose:()=>D(!1),onSuccess:()=>{G.oR.success("Producto creado exitosamente"),es()}}),J.open&&J.storeProduct&&(0,a.jsx)(S,{isOpen:J.open,onClose:()=>B({open:!1}),onSuccess:()=>{G.oR.success("Precio actualizado"),es()},storeProduct:J.storeProduct}),H.open&&H.storeProduct&&(0,a.jsx)(C,{isOpen:H.open,onClose:()=>_({open:!1}),onSuccess:()=>{G.oR.success("Stock actualizado"),es()},storeProduct:H.storeProduct}),(0,a.jsx)(L,{isOpen:V.open,onClose:()=>K({open:!1}),onConfirm:ei,title:"Compartir al Cat\xe1logo Global",message:'\xbfCompartir "'.concat(V.productName,'" al cat\xe1logo global?\n\nOtras tiendas podr\xe1n importar este producto (solo info b\xe1sica, no tu precio ni stock).'),confirmText:"Compartir",cancelText:"Cancelar",confirmColor:"blue"}),W.open&&W.productId&&(0,a.jsx)(F,{isOpen:W.open,onClose:()=>Y({open:!1}),productId:W.productId,productName:W.productName||""}),Z.open&&Z.productId&&(0,a.jsx)(R,{isOpen:Z.open,onClose:()=>Q({open:!1}),storeProductId:Z.storeProductId||"",productId:Z.productId,productName:Z.productName||"",basePrice:Z.price||0})]})}},8761:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var a=r(5155),s=r(2115),o=r(6046),n=r(1594),i=r(9053),l=r(767);function c(){let e=(0,o.useRouter)(),[t,r]=(0,s.useState)(!1),[c,d]=(0,s.useState)(!0);(0,s.useEffect)(()=>{u()},[]);let u=async()=>{try{let e=await fetch("/api/settings/onboarding");if(!e.ok){d(!1);return}let t=await e.json(),a=!t.completedAt&&!t.dismissedAt;r(a)}catch(e){console.error("Error checking onboarding status:",e)}finally{d(!1)}},m=async()=>{try{await fetch("/api/settings/onboarding",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({dismissed:!0})}),r(!1)}catch(e){console.error("Error dismissing banner:",e)}};return c||!t?null:(0,a.jsx)("div",{className:"bg-yellow-50 border-b border-yellow-200 print:hidden",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,a.jsx)(n.A,{className:"w-5 h-5 text-yellow-600 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-yellow-900",children:"Configuraci\xf3n inicial pendiente"}),(0,a.jsx)("p",{className:"text-xs text-yellow-700 mt-0.5",children:"Completa la configuraci\xf3n de tu tienda para empezar a vender (menos de 30 minutos)"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("button",{onClick:()=>{e.push("/onboarding")},className:"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 font-medium text-sm flex items-center gap-2 whitespace-nowrap",children:["Continuar configuraci\xf3n",(0,a.jsx)(i.A,{className:"w-4 h-4"})]}),(0,a.jsx)("button",{onClick:m,className:"p-2 text-yellow-600 hover:text-yellow-800 hover:bg-yellow-100 rounded-lg",title:"Recordarme despu\xe9s",children:(0,a.jsx)(l.A,{className:"w-5 h-5"})})]})]})})})}},5273:(e,t,r)=>{"use strict";r.d(t,{D0:()=>l}),r(5155);var a=r(2115);let s={flags:{},isLoading:!1,error:null,lastFetched:null},o=new Set;function n(){o.forEach(e=>e())}async function i(){let e=await fetch("/api/flags",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error al cargar feature flags");let t=await e.json(),r={};return Array.isArray(t.flags)&&t.flags.forEach(e=>{r[e.key]=e.enabled}),r}function l(){let[,e]=(0,a.useState)({});(0,a.useEffect)(()=>{let t=()=>e({});return o.add(t),()=>{o.delete(t)}},[]),(0,a.useEffect)(()=>{(!s.lastFetched||Date.now()-s.lastFetched>3e5)&&!s.isLoading&&t()},[]);let t=(0,a.useCallback)(async()=>{if(!s.isLoading){s={...s,isLoading:!0,error:null},n();try{s={flags:await i(),isLoading:!1,error:null,lastFetched:Date.now()}}catch(e){s={...s,isLoading:!1,error:e instanceof Error?e.message:"Error desconocido"}}n()}},[]),r=(0,a.useCallback)(e=>{var t;return null!==(t=s.flags[e])&&void 0!==t&&t},[]),l=(0,a.useCallback)(e=>!r(e),[r]),c=(0,a.useCallback)(async()=>{s={...s,lastFetched:null},await t()},[t]);return{isOn:r,isOff:l,isLoading:s.isLoading,error:s.error,refetch:c,allFlags:s.flags}}}},e=>{var t=t=>e(e.s=t);e.O(0,[814,8173,9121,9445,8441,1517,7358],()=>t(918)),_N_E=e.O()}]);