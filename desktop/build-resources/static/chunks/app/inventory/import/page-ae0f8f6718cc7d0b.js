(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8035],{457:(e,s,r)=>{Promise.resolve().then(r.bind(r,9900))},7364:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(7401).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},1594:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(7401).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},3239:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(7401).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},4857:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(7401).A)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])},1773:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(7401).A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},8684:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(7401).A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},2792:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(7401).A)("wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]])},9900:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>v});var t=r(5155),a=r(2115),l=r(6046),i=r(9445),c=r(2792),d=r(7401);let n=(0,d.A)("shopping-bag",[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]]),o=(0,d.A)("file-spreadsheet",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);var x=r(7364),m=r(4857),h=r(8684),p=r(1773),g=r(4081),u=r(767),y=r(3239),j=r(1594),b=r(814);function v(){let e=(0,l.useRouter)(),s=(0,a.useRef)(null),[r,d]=(0,a.useState)(null),[v,N]=(0,a.useState)(null),[f,w]=(0,a.useState)(null),[k,A]=(0,a.useState)([]),[C,S]=(0,a.useState)(!1),[M,R]=(0,a.useState)(!1),[V,E]=(0,a.useState)(!1),z=[{name:"Ferreter\xeda",file:"/templates/plantilla-ferreteria.csv",icon:c.A,description:"100+ productos de ferreter\xeda con conversiones"},{name:"Bodega",file:"/templates/plantilla-bodega.csv",icon:n,description:"90+ productos de bodega/minimarket"},{name:"Plantilla Vac\xeda",file:"/templates/plantilla-vacia.csv",icon:o,description:"Solo cabeceras, para llenar manualmente"}],P=async e=>{var s;let r=null===(s=e.target.files)||void 0===s?void 0:s[0];if(r){if(!r.name.endsWith(".csv")){b.oR.error("Solo se permiten archivos CSV");return}d(r),await F(r)}},F=async e=>{S(!0),N(null),w(null);try{let s=new FormData;s.append("file",e);let r=await fetch("/api/products/import-csv",{method:"POST",body:s}),t=await r.json();if(!r.ok){b.oR.error(t.error||"Error al procesar el archivo"),S(!1);return}N(t.preview),w(t.summary),A(t.availableUnits||[]),t.summary.errorRows>0?b.oR.warning("".concat(t.summary.errorRows," filas con errores")):b.oR.success("".concat(t.summary.validRows," productos listos para importar"))}catch(e){console.error("Error processing file:",e),b.oR.error("Error al procesar el archivo CSV")}finally{S(!1)}},I=async()=>{if(!v)return;let s=v.filter(e=>0===e.errors.length);if(0===s.length){b.oR.error("No hay productos v\xe1lidos para importar");return}R(!0);try{let r=await fetch("/api/products/import-csv",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({products:s,updateExisting:V})}),t=await r.json();if(!r.ok){b.oR.error(t.error||"Error en la importaci\xf3n"),R(!1);return}let{result:a}=t;b.oR.success("Importaci\xf3n exitosa: ".concat(a.created," creados, ").concat(a.updated," actualizados, ").concat(a.skipped," omitidos")),setTimeout(()=>e.push("/inventory"),1500)}catch(e){console.error("Error importing:",e),b.oR.error("Error de conexi\xf3n")}finally{R(!1)}},O=()=>{d(null),N(null),w(null),s.current&&(s.current.value="")},U=e=>new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(e);return(0,t.jsxs)(i.A,{storeName:"Importar Inventario",children:[(0,t.jsx)(b.l$,{position:"top-right",richColors:!0}),(0,t.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,t.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("button",{onClick:()=>e.push("/inventory"),className:"flex items-center gap-2 text-sm text-gray-600 hover:text-gray-900 mb-4",children:[(0,t.jsx)(x.A,{className:"w-4 h-4"}),"Volver al inventario"]}),(0,t.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Importar desde CSV"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Carga un archivo CSV con tus productos. Soporta unidades de medida y conversiones."})]}),!v&&(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h2",{className:"text-sm font-medium text-gray-700 mb-3",children:"Plantillas de ejemplo (descargar y editar):"}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:z.map(e=>{let s=e.icon;return(0,t.jsxs)("a",{href:e.file,download:!0,className:"flex items-start gap-3 p-4 bg-white border border-gray-200 rounded-lg hover:border-blue-400 hover:shadow-sm transition-all",children:[(0,t.jsx)("div",{className:"p-2 bg-blue-50 rounded-lg",children:(0,t.jsx)(s,{className:"w-5 h-5 text-blue-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:e.description}),(0,t.jsxs)("p",{className:"text-xs text-blue-600 mt-1 flex items-center gap-1",children:[(0,t.jsx)(m.A,{className:"w-3 h-3"}),"Descargar CSV"]})]})]},e.name)})})]}),!v&&(0,t.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-8",children:(0,t.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,t.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-green-400 transition-colors",children:[(0,t.jsx)(h.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-sm text-gray-900 font-medium mb-2",children:"Arrastra tu archivo CSV o haz clic para seleccionar"}),(0,t.jsx)("input",{ref:s,type:"file",accept:".csv",onChange:P,className:"hidden",id:"csv-upload",disabled:C}),(0,t.jsx)("label",{htmlFor:"csv-upload",className:"inline-block mt-4 px-4 py-2 bg-green-600 text-white rounded-md text-sm font-medium cursor-pointer hover:bg-green-700 transition-colors",children:C?(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(p.A,{className:"w-4 h-4 animate-spin"}),"Procesando..."]}):"Seleccionar archivo"})]}),(0,t.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-gray-900 mb-2",children:"Formato del CSV:"}),(0,t.jsx)("p",{className:"text-xs text-gray-600 font-mono break-all",children:"name,category,barcode,brand,content,baseUnitCode,price,stock,minStock,conversions"}),(0,t.jsxs)("ul",{className:"mt-3 text-xs text-gray-600 space-y-1",children:[(0,t.jsxs)("li",{children:["• ",(0,t.jsx)("strong",{children:"name"}),": Nombre del producto (requerido)"]}),(0,t.jsxs)("li",{children:["• ",(0,t.jsx)("strong",{children:"baseUnitCode"}),": UNIT, KG, M, L, M2, etc."]}),(0,t.jsxs)("li",{children:["• ",(0,t.jsx)("strong",{children:"conversions"}),': opcional, formato "BOX:12,PACK:6"']}),(0,t.jsx)("li",{children:"• Separador: coma (,) o punto y coma (;)"})]})]})]})}),v&&f&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between bg-white border border-gray-200 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(g.A,{className:"w-5 h-5 text-gray-400"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900",children:null==r?void 0:r.name}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:[f.totalRows," filas totales"]})]})]}),(0,t.jsx)("button",{onClick:O,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:(0,t.jsx)(u.A,{className:"w-5 h-5"})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,t.jsx)(y.A,{className:"w-5 h-5 text-green-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:f.validRows}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Productos v\xe1lidos"})]})]})}),(0,t.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:(0,t.jsx)(j.A,{className:"w-5 h-5 text-red-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:f.errorRows}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Con errores"})]})]})}),(0,t.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,t.jsx)(p.A,{className:"w-5 h-5 text-blue-600"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:V,onChange:e=>E(e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,t.jsx)("span",{className:"text-sm text-gray-700",children:"Actualizar existentes"})]}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Sobrescribir precio/stock"})]})]})})]}),(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[(0,t.jsxs)("div",{className:"px-4 py-3 border-b border-gray-200 flex justify-between items-center",children:[(0,t.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["Vista previa (primeras ",f.previewRows," filas)",f.hasMore&&(0,t.jsxs)("span",{className:"text-gray-500",children:[" de ",f.totalRows]})]}),k.length>0&&(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:["Unidades: ",k.map(e=>e.code).join(", ")]})]}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Fila"}),(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Nombre"}),(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Categor\xeda"}),(0,t.jsx)("th",{className:"px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase",children:"Unidad"}),(0,t.jsx)("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"Precio"}),(0,t.jsx)("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"Stock"}),(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Conversiones"}),(0,t.jsx)("th",{className:"px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase",children:"Estado"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-gray-200",children:v.map(e=>{let s=e.errors.length>0,r=e.warnings.length>0;return(0,t.jsxs)("tr",{className:s?"bg-red-50":r?"bg-yellow-50":"",children:[(0,t.jsx)("td",{className:"px-4 py-2 text-xs text-gray-500",children:e.row}),(0,t.jsxs)("td",{className:"px-4 py-2",children:[(0,t.jsx)("p",{className:"text-sm text-gray-900",children:e.name||"—"}),e.barcode&&(0,t.jsx)("p",{className:"text-xs text-gray-500 font-mono",children:e.barcode})]}),(0,t.jsx)("td",{className:"px-4 py-2 text-sm text-gray-600",children:e.category}),(0,t.jsx)("td",{className:"px-4 py-2 text-center",children:(0,t.jsx)("span",{className:"inline-flex px-2 py-1 bg-gray-100 rounded-md text-xs text-gray-700",children:e.baseUnitCode})}),(0,t.jsx)("td",{className:"px-4 py-2 text-right text-sm text-gray-900",children:U(e.price)}),(0,t.jsx)("td",{className:"px-4 py-2 text-right text-sm text-gray-600",children:e.stock}),(0,t.jsx)("td",{className:"px-4 py-2",children:e.conversions.length>0?(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:e.conversions.map((e,s)=>(0,t.jsxs)("span",{className:"inline-flex px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs",children:[e.unitCode,":",e.factor]},s))}):(0,t.jsx)("span",{className:"text-xs text-gray-400",children:"—"})}),(0,t.jsx)("td",{className:"px-4 py-2 text-center",children:s?(0,t.jsxs)("div",{className:"group relative",children:[(0,t.jsx)("span",{className:"inline-flex px-2 py-1 bg-red-100 text-red-700 rounded-md text-xs cursor-help",children:"Error"}),(0,t.jsx)("div",{className:"absolute right-0 top-full mt-1 hidden group-hover:block z-10 w-48 p-2 bg-red-800 text-white text-xs rounded shadow-lg",children:e.errors.join(", ")})]}):r?(0,t.jsxs)("div",{className:"group relative",children:[(0,t.jsx)("span",{className:"inline-flex px-2 py-1 bg-yellow-100 text-yellow-700 rounded-md text-xs cursor-help",children:"Aviso"}),(0,t.jsx)("div",{className:"absolute right-0 top-full mt-1 hidden group-hover:block z-10 w-48 p-2 bg-yellow-800 text-white text-xs rounded shadow-lg",children:e.warnings.join(", ")})]}):(0,t.jsx)("span",{className:"inline-flex px-2 py-1 bg-green-100 text-green-700 rounded-md text-xs",children:"OK"})})]},e.row)})})]})})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("button",{onClick:O,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:"Cargar otro archivo"}),(0,t.jsx)("button",{onClick:I,disabled:M||0===f.validRows,className:"px-6 py-2 bg-green-600 text-white rounded-md text-sm font-medium hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:M?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.A,{className:"w-4 h-4 animate-spin"}),"Importando..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.A,{className:"w-4 h-4"}),"Importar ",f.validRows," productos"]})})]})]})]})})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[814,8173,9121,9445,8441,1517,7358],()=>s(457)),_N_E=e.O()}]);